
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#dc2626">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="PATRON">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="manifest" href="/manifest.json?v=2.5.1">
  <link rel="icon" type="image/png" href="lacrimosa.jpg">
  <link rel="apple-touch-icon" href="lacrimosa.jpg">
  <title id="pageTitle">Lacrimosa - Admin Dashboard</title>
  
  <script>
    // Service Worker Registration - Cache kontrolÃ¼ iÃ§in
    // Service worker sadece HTTPS veya localhost'ta Ã§alÄ±ÅŸÄ±r
    const isSecureContext = window.location.protocol === 'https:' || 
                            window.location.hostname === 'localhost' || 
                            window.location.hostname === '127.0.0.1';
    
    if ('serviceWorker' in navigator && isSecureContext) {
      let refreshing = false;
      
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js?v=2.5.1')
          .then((registration) => {
            console.log('[SW] Service Worker registered:', registration.scope);
            
            // Yeni service worker varsa, sadece bir kez gÃ¼ncelle
            let updateChecked = false;
            registration.addEventListener('updatefound', () => {
              if (updateChecked) return; // Zaten kontrol edildi, tekrar kontrol etme
              updateChecked = true;
              
              const newWorker = registration.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed') {
                    if (navigator.serviceWorker.controller) {
                      // Yeni versiyon var ve eski worker aktif
                      console.log('[SW] New version available!');
                      // Sadece bir kez yenile
                      if (!refreshing) {
                        refreshing = true;
                        // 3 saniye bekle, sonra otomatik yenile
                        setTimeout(() => {
                          console.log('[SW] Auto-reloading for update...');
                          window.location.reload(true); // Hard reload
                        }, 3000);
                      }
                    } else {
                      // Ä°lk yÃ¼kleme
                      console.log('[SW] Service Worker installed for the first time');
                    }
                  }
                });
              }
            });
            
            // Ä°lk yÃ¼klemede bir kez kontrol et
            registration.update();
            
            // Her 5 dakikada bir kontrol et (daha az sÄ±k)
            setInterval(() => {
              if (!refreshing) {
                registration.update();
              }
            }, 300000); // 5 dakika
            
            // Sayfa gÃ¶rÃ¼nÃ¼r olduÄŸunda kontrol et (sadece bir kez)
            let visibilityChecked = false;
            document.addEventListener('visibilitychange', () => {
              if (!document.hidden && !visibilityChecked && !refreshing) {
                visibilityChecked = true;
                registration.update();
              }
            });
          })
          .catch((error) => {
            console.warn('[SW] Service Worker registration failed:', error.message);
            // Hata olsa bile uygulama Ã§alÄ±ÅŸmaya devam etsin
          });
        
        // Service worker mesajlarÄ±nÄ± dinle (sadece bir kez)
        let messageListenerAdded = false;
        if (!messageListenerAdded) {
          messageListenerAdded = true;
          navigator.serviceWorker.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'SW_UPDATED') {
              console.log('[SW] Update message received:', event.data.message);
              // MesajÄ± sadece logla, otomatik yenileme yapma (updatefound zaten hallediyor)
            }
          });
        }
      });
    } else {
      if (!isSecureContext) {
        console.log('[SW] Service Worker not supported in this context (requires HTTPS or localhost)');
      } else {
        console.log('[SW] Service Worker not supported in this browser');
      }
    }
  </script>
  
  <!-- Firebase SDK (Compat Version) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <script>
    // Tenant Config Firebase (tÃ¼m tenant'larÄ±n bilgilerini tutar)
    const tenantConfigFirebase = {
      apiKey: "AIzaSyBC6VxvlV3VxDnucAGxPOarYmar1PAItQM",
      authDomain: "adminself-d2c2b.firebaseapp.com",
      projectId: "adminself-d2c2b",
      storageBucket: "adminself-d2c2b.firebasestorage.app",
      messagingSenderId: "814547626980",
      appId: "1:814547626980:web:0a2e8fad7aa1ccdea675f1",
      measurementId: "G-GCRJCCL4K0"
    };

    // Tenant bilgileri (dinamik olarak yÃ¼klenecek)
    let currentTenantInfo = null;
    let businessName = 'PATRON'; // VarsayÄ±lan
    let firebaseConfig = null;
    let tablesFirebaseConfig = null;
    let insideTablesCount = 20; // VarsayÄ±lan
    let outsideTablesCount = 20; // VarsayÄ±lan
    let packageTablesCount = 5; // VarsayÄ±lan
    let themeColor = '#f97316'; // VarsayÄ±lan turuncu
    
    // Global deÄŸiÅŸkenler (Firebase ve PIN iÃ§in)
    let app, db;
    let tablesApp, tablesDb;
    let geceMasalarApp, geceMasalarDb;
    let isAuthenticated = false;
    let realtimeUnsubscribe = null;
    let allSales = []; // TÃ¼m satÄ±ÅŸlarÄ± sakla
    let activeTab = 'sales'; // 'sales', 'reports', 'staff', 'tables', 'cancels'
    let reportDateFilter = 'all'; // 'all', 'yesterday', 'week', 'month', 'custom'
    let salesDateFilter = 'all'; // SatÄ±ÅŸ geÃ§miÅŸi iÃ§in tarih filtresi
    let customDateRange = { start: null, end: null }; // Ã–zel tarih aralÄ±ÄŸÄ±
    let salesCustomDateRange = { start: null, end: null }; // SatÄ±ÅŸ geÃ§miÅŸi iÃ§in Ã¶zel tarih aralÄ±ÄŸÄ±
    let tablesUnsubscribe = null; // Masalar iÃ§in real-time listener
    let activeTablesUnsubscribe = null; // Aktif masa sayÄ±sÄ± iÃ§in real-time listener
    let allStaticTables = {}; // TÃ¼m masalarÄ± sakla (iÃ§, dÄ±ÅŸ, paket)
    let isGeceDonercisi = false; // Gece DÃ¶nercisi tenant'Ä±nda salon/bahÃ§e masalarÄ± gÃ¶sterilir
    let isLacromisa = false; // Lacrimosa Coffee tenant'Ä±nda inside/outside masalar gÃ¶sterilir
    let tenantDbRef = null; // Tenant config Firestore (PIN gÃ¼ncelleme iÃ§in)
    let tenantDocId = null; // Tenant dokÃ¼man ID (PIN gÃ¼ncelleme iÃ§in)
    let saleIdToDelete = null; // Silme onayÄ± iÃ§in
    let editingSaleId = null; // DÃ¼zenleme modalÄ± iÃ§in
    let editingSaleItems = []; // DÃ¼zenlemede Ã¼rÃ¼n listesi (quantity deÄŸiÅŸtirilebilir)

    // Gece DÃ¶nercisi - Åube bazlÄ± stok/fiyat yÃ¶netimi (Admin Dashboard)
    const GECE_TENANT_ID = 'TENANT-1769602125250';
    const MGMT_BRANCH_STORAGE_KEY = 'gece_donercisi_branch';
    const MGMT_DEVICE_ID_STORAGE_KEY = 'gece_donercisi_device_id';
    const GECE_MASALAR_FIREBASE_CONFIG = {
      apiKey: "AIzaSyB9RzR5HMVDTUfduW1ix-871k5gSM55VkU",
      authDomain: "gecedonercisimasalar.firebaseapp.com",
      projectId: "gecedonercisimasalar",
      storageBucket: "gecedonercisimasalar.firebasestorage.app",
      messagingSenderId: "772077442379",
      appId: "1:772077442379:web:cd19d6c85810ceda93c4ce",
      measurementId: "G-689BHMKQ7X"
    };

    // Lacrimosa Coffee - Masalar iÃ§in ayrÄ± Firebase (lacromisamasalar)
    const LACROMISA_TENANT_ID = 'TENANT-1769956051654';
    const LACROMISA_MASALAR_FIREBASE_CONFIG = {
      apiKey: "AIzaSyCXYMcQ_UsUo5tswMt9gKoEoVCWOU5l2zM",
      authDomain: "lacromisamasalar.firebaseapp.com",
      projectId: "lacromisamasalar",
      storageBucket: "lacromisamasalar.firebasestorage.app",
      messagingSenderId: "54584108706",
      appId: "1:54584108706:web:9ab2eaf4486cdd6f66d9fb",
      measurementId: "G-9B8CVKZRZH"
    };
    
    // PIN giriÅŸi (tenant'a gÃ¶re dinamik olarak yÃ¼klenecek)
    let adminPin = '1234'; // VarsayÄ±lan

    // Hex'i RGB'ye Ã§evir (global utility function)
    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }

    // Tenant bilgilerini Firebase'den yÃ¼kle
    async function loadTenantInfo() {
      try {
        // Tenant config Firebase'i baÅŸlat
        let tenantConfigApp;
        try {
          tenantConfigApp = firebase.app('tenant-config');
        } catch (e) {
          tenantConfigApp = firebase.initializeApp(tenantConfigFirebase, 'tenant-config');
        }
        const tenantDb = firebase.firestore(tenantConfigApp);

        // URL'den veya localStorage'dan tenant ID'yi al
        const urlParams = new URLSearchParams(window.location.search);
        let tenantId = urlParams.get('tenantId') || localStorage.getItem('admin_tenant_id');
        // Bu admin dashboard artÄ±k Lacromisa tenant'Ä±na Ã¶zel
        tenantId = LACROMISA_TENANT_ID;
        isGeceDonercisi = false;
        isLacromisa = true;
        
        console.log('ğŸ” Tenant ID kaynaklarÄ±:', {
          url: urlParams.get('tenantId'),
          localStorage: localStorage.getItem('admin_tenant_id'),
          electron: 'kontrol ediliyor...'
        });
        
        // EÄŸer tenant ID yoksa, Electron IPC Ã¼zerinden almayÄ± dene
        if (!tenantId && window.electronAPI && window.electronAPI.getTenantInfo) {
          try {
            const tenantInfo = await window.electronAPI.getTenantInfo();
            console.log('ğŸ“¡ Electron\'dan gelen tenantInfo:', tenantInfo);
            if (tenantInfo && tenantInfo.tenantId) {
              tenantId = tenantInfo.tenantId;
              console.log('âœ… Tenant ID Electron\'dan alÄ±ndÄ±:', tenantId);
            } else {
              console.warn('âš ï¸ Electron tenantInfo\'da tenantId yok');
            }
          } catch (e) {
            console.warn('âŒ Tenant ID Electron\'dan alÄ±namadÄ±:', e);
          }
        }

        console.log('ğŸ” Tenant ID aranÄ±yor:', tenantId || '(yok)');

        // Tenant bilgilerini Firestore'dan al
        const tenantsRef = tenantDb.collection('tenants');
        let tenantDoc = null;
        let tenantData = null;

        // EÄŸer tenant ID varsa, Ã¶nce document ID'ye gÃ¶re dene
        if (tenantId) {
          try {
            tenantDoc = await tenantsRef.doc(tenantId).get();
            if (tenantDoc.exists) {
              tenantData = tenantDoc.data();
              console.log('âœ… Tenant document ID ile bulundu:', tenantId);
            }
          } catch (e) {
            console.log('âš ï¸ Document ID ile bulunamadÄ±:', e);
          }

          // EÄŸer document ID ile bulunamadÄ±ysa, tenantId alanÄ±na gÃ¶re sorgula
          if (!tenantData) {
            const querySnapshot = await tenantsRef.where('tenantId', '==', tenantId).get();
            if (!querySnapshot.empty) {
              tenantDoc = querySnapshot.docs[0];
              tenantData = tenantDoc.data();
              console.log('âœ… Tenant alan sorgusu ile bulundu:', tenantId);
            }
          }
        }

        // EÄŸer hala bulunamadÄ±ysa, tÃ¼m tenant'larÄ± listele ve ilkini kullan
        if (!tenantData) {
          console.log('âš ï¸ Tenant bulunamadÄ±, tÃ¼m tenant\'lar listeleniyor...');
          const allTenantsSnapshot = await tenantsRef.get();
          if (!allTenantsSnapshot.empty) {
            console.log('ğŸ“‹ Mevcut tenant\'lar:');
            allTenantsSnapshot.docs.forEach((doc, index) => {
              const data = doc.data();
              console.log(`  ${index + 1}. Document ID: ${doc.id}, tenantId: ${data.tenantId || 'N/A'}, businessName: ${data.businessName || data.name || 'N/A'}`);
            });
            
            // Ä°lk tenant'Ä± kullan (veya businessName'e gÃ¶re "Yaka" iÃ§ereni bul)
            let selectedDoc = null;
            for (const doc of allTenantsSnapshot.docs) {
              const data = doc.data();
              const businessName = (data.businessName || data.name || '').toLowerCase();
              if (businessName.includes('yaka') || businessName.includes('grill')) {
                selectedDoc = doc;
                console.log('âœ… "Yaka" iÃ§eren tenant bulundu:', doc.id);
                break;
              }
            }
            
            // EÄŸer "Yaka" iÃ§eren bulunamadÄ±ysa, ilk tenant'Ä± kullan
            if (!selectedDoc && allTenantsSnapshot.docs.length > 0) {
              selectedDoc = allTenantsSnapshot.docs[0];
              console.log('âš ï¸ "Yaka" iÃ§eren tenant bulunamadÄ±, ilk tenant kullanÄ±lÄ±yor:', selectedDoc.id);
            }
            
            if (selectedDoc) {
              tenantDoc = selectedDoc;
              tenantData = selectedDoc.data();
              console.log('âœ… Tenant seÃ§ildi:', selectedDoc.id, '-', tenantData.businessName || tenantData.name || 'N/A');
            }
          } else {
            console.warn('âš ï¸ HiÃ§ tenant bulunamadÄ±!');
          }
        }

        if (tenantData) {
          currentTenantInfo = tenantData;
          businessName = tenantData.businessName || tenantData.name || 'Yaka\'s Grill';
          
          // Masa sayÄ±larÄ±nÄ± al
          // 0 deÄŸeri geÃ§erli olduÄŸu iÃ§in null/undefined kontrolÃ¼ yapÄ±yoruz
          insideTablesCount = tenantData.insideTables !== undefined && tenantData.insideTables !== null 
            ? tenantData.insideTables 
            : (tenantData.inside_tables !== undefined && tenantData.inside_tables !== null ? tenantData.inside_tables : 20);
          outsideTablesCount = tenantData.outsideTables !== undefined && tenantData.outsideTables !== null 
            ? tenantData.outsideTables 
            : (tenantData.outside_tables !== undefined && tenantData.outside_tables !== null ? tenantData.outside_tables : 20);
          packageTablesCount = tenantData.packageTables !== undefined && tenantData.packageTables !== null 
            ? tenantData.packageTables 
            : (tenantData.package_tables !== undefined && tenantData.package_tables !== null ? tenantData.package_tables : 5);
          
          // SayÄ±sal deÄŸerlere dÃ¶nÃ¼ÅŸtÃ¼r
          insideTablesCount = typeof insideTablesCount === 'number' ? insideTablesCount : (parseInt(insideTablesCount) || 20);
          outsideTablesCount = typeof outsideTablesCount === 'number' ? outsideTablesCount : (parseInt(outsideTablesCount) || 20);
          packageTablesCount = typeof packageTablesCount === 'number' ? packageTablesCount : (parseInt(packageTablesCount) || 5);

          // Lacrimosa Coffee: sabit 15 iÃ§eri / 15 dÄ±ÅŸarÄ±, paket yok + masalar Firebase'i lacromisamasalar
          if (tenantId === LACROMISA_TENANT_ID) {
            insideTablesCount = 15;
            outsideTablesCount = 15;
            packageTablesCount = 0;
            tablesFirebaseConfig = LACROMISA_MASALAR_FIREBASE_CONFIG;
            isLacromisa = true;
            businessName = 'PATRON';
          }
          
          // Tema rengini al
          themeColor = tenantData.themeColor || '#f97316';
          
          console.log('ğŸ“‹ Tenant verileri:', {
            businessName: businessName,
            hasFirebaseApi1: !!tenantData.firebaseApi1,
            hasFirebaseApi2: !!tenantData.firebaseApi2,
            hasMainFirebaseConfig: !!tenantData.mainFirebaseConfig,
            hasTablesFirebaseConfig: !!tenantData.tablesFirebaseConfig,
            insideTablesCount: insideTablesCount,
            outsideTablesCount: outsideTablesCount,
            packageTablesCount: packageTablesCount
          });
          
          // Firebase config'leri parse et - Ã–NCE firebaseApi1 ve firebaseApi2'yi kontrol et
          if (tenantData.firebaseApi1) {
            try {
              firebaseConfig = typeof tenantData.firebaseApi1 === 'string' 
                ? JSON.parse(tenantData.firebaseApi1) 
                : tenantData.firebaseApi1;
              console.log('âœ… firebaseApi1 yÃ¼klendi:', firebaseConfig.projectId || 'N/A');
            } catch (e) {
              console.error('âŒ firebaseApi1 parse hatasÄ±:', e);
            }
          } else if (tenantData.mainFirebaseConfig) {
            try {
              firebaseConfig = typeof tenantData.mainFirebaseConfig === 'string' 
                ? JSON.parse(tenantData.mainFirebaseConfig) 
                : tenantData.mainFirebaseConfig;
              console.log('âœ… mainFirebaseConfig yÃ¼klendi:', firebaseConfig.projectId || 'N/A');
            } catch (e) {
              console.error('âŒ mainFirebaseConfig parse hatasÄ±:', e);
            }
          }

          if (tenantData.firebaseApi2) {
            try {
              tablesFirebaseConfig = typeof tenantData.firebaseApi2 === 'string' 
                ? JSON.parse(tenantData.firebaseApi2) 
                : tenantData.firebaseApi2;
              console.log('âœ… firebaseApi2 yÃ¼klendi:', tablesFirebaseConfig.projectId || 'N/A');
            } catch (e) {
              console.error('âŒ firebaseApi2 parse hatasÄ±:', e);
            }
          } else if (tenantData.tablesFirebaseConfig) {
            try {
              tablesFirebaseConfig = typeof tenantData.tablesFirebaseConfig === 'string' 
                ? JSON.parse(tenantData.tablesFirebaseConfig) 
                : tenantData.tablesFirebaseConfig;
              console.log('âœ… tablesFirebaseConfig yÃ¼klendi:', tablesFirebaseConfig.projectId || 'N/A');
            } catch (e) {
              console.error('âŒ tablesFirebaseConfig parse hatasÄ±:', e);
            }
          }

          // Admin PIN'i gÃ¼ncelle
          if (tenantData.adminPin) {
            adminPin = tenantData.adminPin;
            console.log('âœ… Admin PIN gÃ¼ncellendi');
          }

          tenantDbRef = tenantDb;
          tenantDocId = tenantDoc.id;

          // UI'Ä± gÃ¼ncelle
          updateUIWithTenantInfo();
          
          console.log('âœ… Tenant bilgileri yÃ¼klendi:', businessName);
          console.log('ğŸ“¦ Final firebaseConfig:', firebaseConfig ? (firebaseConfig.projectId || 'N/A') : 'NULL');
          console.log('ğŸ“¦ Final tablesFirebaseConfig:', tablesFirebaseConfig ? (tablesFirebaseConfig.projectId || 'N/A') : 'NULL');
        } else {
          console.warn('âš ï¸ Tenant bulunamadÄ± (ID:', tenantId, '), varsayÄ±lan deÄŸerler kullanÄ±lÄ±yor');
          console.warn('âš ï¸ TÃ¼m tenant\'larÄ± listeleme...');
          // TÃ¼m tenant'larÄ± listele (debug iÃ§in)
          tenantsRef.get().then(snapshot => {
            console.log('ğŸ“‹ Mevcut tenant\'lar:', snapshot.docs.map(doc => ({
              id: doc.id,
              data: doc.data()
            })));
          }).catch(e => console.error('âŒ Tenant listesi alÄ±namadÄ±:', e));
          
          // VarsayÄ±lan Firebase config (Yaka's Grill iÃ§in)
          firebaseConfig = {
            apiKey: "AIzaSyCdf-c13e0wCafRYHXhIls1epJgD1RjPUA",
            authDomain: "makara-16344.firebaseapp.com",
            projectId: "makara-16344",
            storageBucket: "makara-16344.firebasestorage.app",
            messagingSenderId: "216769654742",
            appId: "1:216769654742:web:16792742d4613f4269be77",
            measurementId: "G-K4XZHP11MM"
          };
        }
      } catch (error) {
        console.error('âŒ Tenant bilgisi yÃ¼klenemedi:', error);
        // VarsayÄ±lan deÄŸerler
        businessName = 'Yaka\'s Grill';
        firebaseConfig = {
          apiKey: "AIzaSyCdf-c13e0wCafRYHXhIls1epJgD1RjPUA",
          authDomain: "makara-16344.firebaseapp.com",
          projectId: "makara-16344",
          storageBucket: "makara-16344.firebasestorage.app",
          messagingSenderId: "216769654742",
          appId: "1:216769654742:web:16792742d4613f4269be77",
          measurementId: "G-K4XZHP11MM"
        };
      }
    }

    // UI'Ä± tenant bilgilerine gÃ¶re gÃ¼ncelle
    function updateUIWithTenantInfo() {
      // Dashboard baÅŸlÄ±ÄŸÄ±: Lacrimosa Admin Dashboard (PATRON marka adÄ± sadece splash/login iÃ§in)
      const dashboardTitle = businessName === 'PATRON' ? 'Lacrimosa' : businessName;
      document.title = `${dashboardTitle} - Admin Dashboard`;

      // Meta tag'leri gÃ¼ncelle
      const appleTitleMeta = document.querySelector('meta[name="apple-mobile-web-app-title"]');
      if (appleTitleMeta) {
        appleTitleMeta.setAttribute('content', businessName);
      }

      // Navbar title: Lacrimosa Admin Dashboard
      const navbarTitle = document.getElementById('navbarBusinessName') || document.querySelector('.navbar-title');
      if (navbarTitle) {
        navbarTitle.textContent = `${dashboardTitle} Admin Dashboard`;
      }

      // Splash screen title gÃ¼ncelle
      const splashTitle = document.getElementById('splashBusinessName') || document.querySelector('.splash-main-text');
      if (splashTitle) {
        splashTitle.textContent = businessName;
      }

      // Login screen business name gÃ¼ncelle
      const loginBusinessName = document.getElementById('loginBusinessName');
      if (loginBusinessName) {
        loginBusinessName.textContent = businessName;
      }

      // Admin PIN'i gÃ¼ncelle (eÄŸer tenant'ta varsa)
      if (currentTenantInfo && currentTenantInfo.adminPin) {
        adminPin = currentTenantInfo.adminPin;
      }

      // Tema rengini gÃ¼ncelle (eÄŸer tenant'ta varsa)
      if (currentTenantInfo && currentTenantInfo.themeColor) {
        themeColor = currentTenantInfo.themeColor;
        const themeColorMeta = document.querySelector('meta[name="theme-color"]');
        if (themeColorMeta) {
          themeColorMeta.setAttribute('content', themeColor);
        }
        // CSS deÄŸiÅŸkenini gÃ¼ncelle
        document.documentElement.style.setProperty('--primary', themeColor);
        // Tema renklerini dinamik olarak uygula
        applyThemeColors(themeColor);
      } else {
        // VarsayÄ±lan tema rengini uygula
        applyThemeColors(themeColor);
      }
    }

    // Tema renklerini dinamik olarak uygula
    function applyThemeColors(primaryColor) {
      // hexToRgb artÄ±k global scope'ta tanÄ±mlÄ±

      // ParlaklÄ±ÄŸÄ± ayarla
      const adjustBrightness = (hex, percent) => {
        const rgb = hexToRgb(hex);
        if (!rgb) return hex;
        const r = Math.max(0, Math.min(255, rgb.r + (rgb.r * percent / 100)));
        const g = Math.max(0, Math.min(255, rgb.g + (rgb.g * percent / 100)));
        const b = Math.max(0, Math.min(255, rgb.b + (rgb.b * percent / 100)));
        return `#${Math.round(r).toString(16).padStart(2, '0')}${Math.round(g).toString(16).padStart(2, '0')}${Math.round(b).toString(16).padStart(2, '0')}`;
      };

      const primary = primaryColor;
      const primaryLight = adjustBrightness(primary, 15);
      const primaryDark = adjustBrightness(primary, -20);
      const primaryDarker = adjustBrightness(primary, -30);
      const rgb = hexToRgb(primary);

      // CSS deÄŸiÅŸkenlerini gÃ¼ncelle
      const root = document.documentElement;
      root.style.setProperty('--theme-primary', primary);
      root.style.setProperty('--theme-primary-light', primaryLight);
      root.style.setProperty('--theme-primary-dark', primaryDark);
      root.style.setProperty('--theme-primary-darker', primaryDarker);
      if (rgb) {
        root.style.setProperty('--theme-rgb', `${rgb.r}, ${rgb.g}, ${rgb.b}`);
      }

      // Dinamik stil ekle veya gÃ¼ncelle
      let styleElement = document.getElementById('dynamic-theme-styles');
      if (!styleElement) {
        styleElement = document.createElement('style');
        styleElement.id = 'dynamic-theme-styles';
        document.head.appendChild(styleElement);
      }

      styleElement.textContent = `
        /* Pembe/Purple renkleri tema rengiyle deÄŸiÅŸtir */
        .stat-card-purple,
        .stat-card-pink {
          border-color: ${primary} !important;
        }
        .stat-card-purple:hover,
        .stat-card-pink:hover {
          border-color: ${primaryDark} !important;
          box-shadow: 0 8px 24px rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.2), 0 0 0 1px rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.1) !important;
        }
        .stat-card-purple .stat-content h3,
        .stat-card-pink .stat-content h3 {
          color: ${primaryDark} !important;
        }
        .stat-card-purple .stat-value,
        .stat-card-pink .stat-value {
          color: ${primary} !important;
        }
        .staff-stat-card.purple {
          border-color: ${primary} !important;
        }
        .staff-stat-card.purple .stat-value {
          color: ${primary} !important;
        }
        .tab-button.active {
          border-bottom: 2px solid ${primary} !important;
          border-color: ${primary} !important;
          color: ${primaryDark} !important;
        }
        .tab-button.active:hover {
          border-color: ${primaryDark} !important;
          background: linear-gradient(135deg, ${primary} 0%, ${primaryDark} 100%) !important;
        }
        .refresh-btn {
          border-color: ${primary} !important;
          color: ${primary} !important;
        }
        .refresh-btn:hover {
          border-color: ${primaryDark} !important;
          background: rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.05) !important;
          box-shadow: 0 4px 16px rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.25) !important;
        }
        .logout-btn {
          border-color: ${primary} !important;
          background: linear-gradient(135deg, ${primary} 0%, ${primaryDark} 100%) !important;
        }
        .logout-btn:hover {
          border-color: ${primaryDark} !important;
          background: linear-gradient(135deg, ${primaryDark} 0%, ${primaryDarker} 100%) !important;
          box-shadow: 0 4px 16px rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.35) !important;
        }
        .table-card.inside-empty {
          background: rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.1) !important;
          border-color: rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.3) !important;
        }
        .table-card.inside-empty .table-status {
          color: ${primary} !important;
        }
        .cancel-item {
          border-left: 4px solid ${primary} !important;
        }
        .cancel-item-header {
          border-color: ${primary} !important;
        }
        .cancel-item-header strong {
          color: ${primaryDark} !important;
        }
        .cancel-reason {
          background: linear-gradient(135deg, ${primary} 0%, ${primaryDark} 100%) !important;
        }
        .date-filter-btn.active {
          border-bottom: 2px solid ${primary} !important;
          border-color: ${primary} !important;
          color: ${primaryDark} !important;
        }
        .date-filter-btn.active:hover {
          background: linear-gradient(90deg, ${primary} 0%, ${primaryDark} 100%) !important;
        }
        .analysis-text-content {
          border-left: 4px solid ${primary} !important;
        }
        .analysis-card:hover {
          border-color: ${primary} !important;
          box-shadow: 0 4px 12px rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.1) !important;
        }
        .admin-splash-screen::before {
          background: radial-gradient(circle, rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.03) 0%, transparent 70%) !important;
        }
        .admin-splash-screen::after {
          background: radial-gradient(circle, rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.02) 0%, transparent 70%) !important;
        }
        .tab-btn.active {
          border-color: ${primary} !important;
          background: linear-gradient(135deg, rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.1) 0%, rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.05) 100%) !important;
          color: ${primaryDark} !important;
          box-shadow: 0 8px 24px rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.2), 0 0 0 1px rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.1) !important;
        }
        .tab-btn.active .tab-btn-text {
          color: ${primaryDark} !important;
        }
        .tab-btn.active .tab-btn-indicator {
          background: linear-gradient(90deg, ${primary} 0%, ${primaryDark} 100%) !important;
        }
        .analyze-btn {
          border-color: ${primary} !important;
          box-shadow: 0 2px 8px rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.15) !important;
        }
        .analyze-btn:hover {
          border-color: ${primaryDark} !important;
          background: linear-gradient(135deg, ${primary} 0%, ${primaryDark} 100%) !important;
          color: #ffffff !important;
        }
        .payment-progress-fill {
          background: linear-gradient(90deg, #6366f1, ${primary}) !important;
        }
      `;
    }

    // Sayfa yÃ¼klendiÄŸinde tenant bilgilerini yÃ¼kle
    document.addEventListener('DOMContentLoaded', async () => {
      await loadTenantInfo();
      initializeFirebase();
    });

    // Firebase yapÄ±landÄ±rmasÄ± (dinamik olarak yÃ¼klenecek)
    function initializeFirebase() {
      console.log('ğŸ”§ initializeFirebase Ã§aÄŸrÄ±ldÄ±');
      console.log('ğŸ“¦ firebaseConfig durumu:', firebaseConfig ? 'âœ… YÃ¼klÃ¼ (' + (firebaseConfig.projectId || 'N/A') + ')' : 'âŒ NULL');
      console.log('ğŸ“¦ tablesFirebaseConfig durumu:', tablesFirebaseConfig ? 'âœ… YÃ¼klÃ¼ (' + (tablesFirebaseConfig.projectId || 'N/A') + ')' : 'âŒ NULL');
      
      // EÄŸer firebaseConfig yÃ¼klenmediyse varsayÄ±lan kullan
      if (!firebaseConfig) {
        console.warn('âš ï¸ firebaseConfig yÃ¼klenmedi, varsayÄ±lan deÄŸerler kullanÄ±lÄ±yor');
        firebaseConfig = {
          apiKey: "AIzaSyCdf-c13e0wCafRYHXhIls1epJgD1RjPUA",
          authDomain: "makara-16344.firebaseapp.com",
          projectId: "makara-16344",
          storageBucket: "makara-16344.firebasestorage.app",
          messagingSenderId: "216769654742",
          appId: "1:216769654742:web:16792742d4613f4269be77",
          measurementId: "G-K4XZHP11MM"
        };
      } else {
        console.log('âœ… Tenant\'tan gelen firebaseConfig kullanÄ±lÄ±yor:', firebaseConfig.projectId || 'N/A');
      }

      try {
        // Ana Firebase zaten baÅŸlatÄ±lmÄ±ÅŸ mÄ± kontrol et
        try {
          app = firebase.app('main');
          firebase.app('main').delete();
        } catch (e) {
          // App yok, devam et
        }
        app = firebase.initializeApp(firebaseConfig, 'main');
        db = firebase.firestore(app);
        console.log('âœ… Ana Firebase baÅŸarÄ±yla baÅŸlatÄ±ldÄ±:', firebaseConfig.projectId);
        
        // Masalar iÃ§in ayrÄ± Firebase baÅŸlat
        if (isLacromisa) {
          // Lacrimosa admin dashboard: masalarÄ± lacromisamasalar projesinden Ã§ek
          tablesFirebaseConfig = LACROMISA_MASALAR_FIREBASE_CONFIG;
          insideTablesCount = 15;
          outsideTablesCount = 15;
          packageTablesCount = 0;
        }
        if (!tablesFirebaseConfig) {
          console.warn('âš ï¸ tablesFirebaseConfig yÃ¼klenmedi, varsayÄ±lan deÄŸerler kullanÄ±lÄ±yor');
          // VarsayÄ±lan masalar Firebase config
          tablesFirebaseConfig = {
            apiKey: "AIzaSyDu_NUrgas4wZ_wdfAYE-DgxqTpb7vKxyo",
            authDomain: "makaramasalar.firebaseapp.com",
            projectId: "makaramasalar",
            storageBucket: "makaramasalar.firebasestorage.app",
            messagingSenderId: "840151572206",
            appId: "1:840151572206:web:0afaf93deea636309e5dff",
            measurementId: "G-2S0J3566ZY"
          };
        } else {
          console.log('âœ… Tenant\'tan gelen tablesFirebaseConfig kullanÄ±lÄ±yor:', tablesFirebaseConfig.projectId || 'N/A');
        }
        
        try {
          try {
            tablesApp = firebase.app('tables');
            firebase.app('tables').delete();
          } catch (e) {
            // App yok, devam et
          }
          tablesApp = firebase.initializeApp(tablesFirebaseConfig, 'tables');
          tablesDb = firebase.firestore(tablesApp);
          console.log('âœ… Masalar Firebase baÅŸarÄ±yla baÅŸlatÄ±ldÄ±:', tablesFirebaseConfig.projectId);
        } catch (tablesError) {
          console.error('âŒ Masalar Firebase baÅŸlatma hatasÄ±:', tablesError);
        }

        // Gece DÃ¶nercisi: ÅŸube bazlÄ± stok/fiyat yÃ¶netimi iÃ§in ayrÄ± Firebase (gecedonercisimasalar)
        if (isGeceDonercisi) {
          try {
            try {
              geceMasalarApp = firebase.app('gece-masalar');
              firebase.app('gece-masalar').delete();
            } catch (e) {
              // App yok, devam et
            }
            geceMasalarApp = firebase.initializeApp(GECE_MASALAR_FIREBASE_CONFIG, 'gece-masalar');
            geceMasalarDb = firebase.firestore(geceMasalarApp);
            console.log('âœ… Gece Masalar Firebase baÅŸarÄ±yla baÅŸlatÄ±ldÄ±:', GECE_MASALAR_FIREBASE_CONFIG.projectId);
          } catch (geceError) {
            console.error('âŒ Gece Masalar Firebase baÅŸlatma hatasÄ±:', geceError);
          }
        }
        
        document.getElementById('errorMessage')?.remove();
      } catch (error) {
        console.error('âŒ Firebase baÅŸlatma hatasÄ±:', error);
        const errorDiv = document.createElement('div');
        errorDiv.id = 'errorMessage';
        errorDiv.style.cssText = 'background: #ff4444; color: white; padding: 20px; text-align: center; margin: 20px; border-radius: 10px;';
        errorDiv.innerHTML = '<h3>âŒ Firebase SDK YÃ¼klenemedi</h3><p>LÃ¼tfen sayfayÄ± yenileyin veya internet baÄŸlantÄ±nÄ±zÄ± kontrol edin.</p>';
        document.body.insertBefore(errorDiv, document.body.firstChild);
      }
    }

    // Gece 03:00'a gÃ¶re gÃ¼nlÃ¼k tarih hesaplama fonksiyonlarÄ±
    // Gece 03:00'tan Ã¶nceki saatler bir Ã¶nceki gÃ¼ne ait sayÄ±lÄ±r
    function getBusinessDayDate() {
      const now = new Date();
      const hour = now.getHours();
      // EÄŸer saat 03:00'tan Ã¶nceyse, bir Ã¶nceki gÃ¼nÃ¼ dÃ¶ndÃ¼r
      if (hour < 3) {
        const yesterday = new Date(now);
        yesterday.setDate(yesterday.getDate() - 1);
        return yesterday;
      }
      return now;
    }

    // Tarihi normalize et - her zaman DD.MM.YYYY formatÄ±nda dÃ¶ndÃ¼r
    function normalizeDateString(date) {
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `${day}.${month}.${year}`;
    }

    function getTodayDateString() {
      const businessDay = getBusinessDayDate();
      // Her zaman normalize edilmiÅŸ format kullan (locale'den baÄŸÄ±msÄ±z)
      return normalizeDateString(businessDay);
    }

    function getYesterdayDateString() {
      const businessDay = getBusinessDayDate();
      const yesterday = new Date(businessDay);
      yesterday.setDate(yesterday.getDate() - 1);
      // Her zaman normalize edilmiÅŸ format kullan (locale'den baÄŸÄ±msÄ±z)
      return normalizeDateString(yesterday);
    }

    // Tarih karÅŸÄ±laÅŸtÄ±rmasÄ± iÃ§in - gece 03:00'a gÃ¶re
    function getBusinessDayStart(date) {
      const d = new Date(date);
      // EÄŸer tarih bugÃ¼nse ve saat 03:00'tan Ã¶nceyse, bir Ã¶nceki gÃ¼nÃ¼n baÅŸlangÄ±cÄ±nÄ± dÃ¶ndÃ¼r
      const now = new Date();
      if (d.toDateString() === now.toDateString() && now.getHours() < 3) {
        d.setDate(d.getDate() - 1);
      }
      d.setHours(3, 0, 0, 0);
      return d;
    }

    function getBusinessDayEnd(date) {
      const d = new Date(date);
      // EÄŸer tarih bugÃ¼nse ve saat 03:00'tan Ã¶nceyse, bir Ã¶nceki gÃ¼nÃ¼n sonunu dÃ¶ndÃ¼r
      const now = new Date();
      if (d.toDateString() === now.toDateString() && now.getHours() < 3) {
        d.setDate(d.getDate() - 1);
      }
      d.setHours(2, 59, 59, 999);
      d.setDate(d.getDate() + 1); // Bir sonraki gÃ¼nÃ¼n 02:59:59'u
      return d;
    }

    function showLogin() {
      const loginSection = document.getElementById('loginSection');
      const dashboard = document.getElementById('dashboard');
      if (loginSection) loginSection.style.display = 'block';
      if (dashboard) dashboard.style.display = 'none';
      if (document.body) document.body.classList.add('login-view');
      applyRememberedPin();
      if (realtimeUnsubscribe) {
        realtimeUnsubscribe();
        realtimeUnsubscribe = null;
      }
    }

    // Masa verilerini Ã§ek (sadece aktif masa sayÄ±sÄ± iÃ§in, render etmeden)
    function loadTablesDataForStats() {
      console.log('ğŸ“Š Masa verileri istatistikler iÃ§in yÃ¼kleniyor...');
      
      if (!tablesDb) {
        console.warn('âš ï¸ tablesDb bulunamadÄ± - sadece statik masalar oluÅŸturulacak');
        allStaticTables = {};
        if (isGeceDonercisi) {
          for (let i = 1; i <= 30; i++) {
            allStaticTables[`salon-${i}`] = { table_id: `salon-${i}`, table_name: `Salon ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
            allStaticTables[`bahce-${i}`] = { table_id: `bahce-${i}`, table_name: `BahÃ§e ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
        } else if (isLacromisa) {
          for (let i = 1; i <= insideTablesCount; i++) {
            allStaticTables[`inside-${i}`] = { table_id: `inside-${i}`, table_name: `Ä°Ã§eri ${i}`, table_type: 'inside', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
          for (let i = 1; i <= outsideTablesCount; i++) {
            allStaticTables[`outside-${i}`] = { table_id: `outside-${i}`, table_name: `DÄ±ÅŸarÄ± ${i}`, table_type: 'outside', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
        } else {
          const totalTablesCount = insideTablesCount + outsideTablesCount;
          for (let i = 1; i <= totalTablesCount; i++) {
            allStaticTables[`masa-${i}`] = { table_id: `masa-${i}`, table_name: `Masa ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
          for (let i = 1; i <= packageTablesCount; i++) {
            allStaticTables[`paket-${i}`] = { table_id: `paket-${i}`, table_name: `Paket ${i}`, table_type: 'package', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
        }
        updateActiveTablesCount(calculateActiveTablesCount());
        return;
      }

      console.log('âœ… tablesDb mevcut, masa verileri Ã§ekiliyor...');

      allStaticTables = {};
      if (isGeceDonercisi) {
        for (let i = 1; i <= 30; i++) {
          allStaticTables[`salon-${i}`] = { table_id: `salon-${i}`, table_name: `Salon ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          allStaticTables[`bahce-${i}`] = { table_id: `bahce-${i}`, table_name: `BahÃ§e ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
      } else if (isLacromisa) {
        for (let i = 1; i <= insideTablesCount; i++) {
          allStaticTables[`inside-${i}`] = { table_id: `inside-${i}`, table_name: `Ä°Ã§eri ${i}`, table_type: 'inside', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
        for (let i = 1; i <= outsideTablesCount; i++) {
          allStaticTables[`outside-${i}`] = { table_id: `outside-${i}`, table_name: `DÄ±ÅŸarÄ± ${i}`, table_type: 'outside', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
      } else {
        const totalTablesCount = insideTablesCount + outsideTablesCount;
        for (let i = 1; i <= totalTablesCount; i++) {
          const tableId = `masa-${i}`;
          allStaticTables[tableId] = { table_id: tableId, table_name: `Masa ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
        for (let i = 1; i <= packageTablesCount; i++) {
          const tableId = `paket-${i}`;
          allStaticTables[tableId] = { table_id: tableId, table_name: `Paket ${i}`, table_type: 'package', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
      }

      console.log(`ğŸ“‹ Toplam ${Object.keys(allStaticTables).length} statik masa oluÅŸturuldu (istatistikler iÃ§in)`);
      
      // Ä°lk aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
      updateActiveTablesCount(calculateActiveTablesCount());

      // Firebase'den masalarÄ± Ã§ek (tek seferlik, listener deÄŸil)
      const tablesRef = tablesDb.collection('tables');
      tablesRef.get().then((snapshot) => {
        console.log(`ğŸ“Š Masalar snapshot alÄ±ndÄ± (istatistikler iÃ§in): ${snapshot.size} Firebase verisi bulundu`);

        // Firebase'den gelen verileri statik masalarla birleÅŸtir
        snapshot.forEach((doc) => {
          const firebaseData = doc.data();
          const tableId = firebaseData.table_id || doc.id;
          
          if (allStaticTables[tableId]) {
            // Firebase'den gelen verileri statik masaya ekle
            allStaticTables[tableId].is_occupied = firebaseData.is_occupied === true || 
                                                   firebaseData.is_occupied === 'true' || 
                                                   firebaseData.is_occupied === 1 ||
                                                   (firebaseData.items && Array.isArray(firebaseData.items) && firebaseData.items.length > 0);
            allStaticTables[tableId].total_amount = parseFloat(firebaseData.total_amount || 0);
            allStaticTables[tableId].items = Array.isArray(firebaseData.items) ? firebaseData.items : [];
            allStaticTables[tableId].order_id = firebaseData.order_id || null;
            allStaticTables[tableId].order_date = firebaseData.order_date || null;
            allStaticTables[tableId].order_time = firebaseData.order_time || null;
            allStaticTables[tableId].order_note = firebaseData.order_note || null;
            // Firebase'den gelen table_name ve table_type'Ä± da gÃ¼ncelle
            if (firebaseData.table_name) {
              allStaticTables[tableId].table_name = firebaseData.table_name;
            }
            if (firebaseData.table_type) {
              allStaticTables[tableId].table_type = firebaseData.table_type;
            }
            console.log(`âœ… Masa gÃ¼ncellendi (istatistikler iÃ§in): ${tableId} - Dolu: ${allStaticTables[tableId].is_occupied}`);
          } else {
            // Firebase'de var ama statik listede yok - yeni masa ekle (dinamik)
            allStaticTables[tableId] = {
              table_id: tableId,
              table_name: firebaseData.table_name || tableId,
              table_type: firebaseData.table_type || 'table',
              table_number: firebaseData.table_number || parseInt(tableId.replace(/\D/g, '')) || 0,
              is_occupied: firebaseData.is_occupied === true || 
                          firebaseData.is_occupied === 'true' || 
                          firebaseData.is_occupied === 1 ||
                          (firebaseData.items && Array.isArray(firebaseData.items) && firebaseData.items.length > 0),
              total_amount: parseFloat(firebaseData.total_amount || 0),
              items: Array.isArray(firebaseData.items) ? firebaseData.items : [],
              order_id: firebaseData.order_id || null,
              order_date: firebaseData.order_date || null,
              order_time: firebaseData.order_time || null,
              order_note: firebaseData.order_note || null
            };
            console.log(`â• Yeni masa eklendi (istatistikler iÃ§in): ${tableId}`);
          }
        });
        
        // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
        updateActiveTablesCount(calculateActiveTablesCount());
        console.log('âœ… Aktif masa sayÄ±sÄ± gÃ¼ncellendi (istatistikler iÃ§in)');
      }).catch((error) => {
        console.error('âŒ Masa verileri Ã§ekilirken hata (istatistikler iÃ§in):', error);
        // Hata olsa bile aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle (varsayÄ±lan deÄŸerlerle)
        updateActiveTablesCount(calculateActiveTablesCount());
      });
    }

    function showDashboard() {
      const loginSection = document.getElementById('loginSection');
      const dashboard = document.getElementById('dashboard');
      if (loginSection) loginSection.style.display = 'none';
      if (dashboard) dashboard.style.display = 'block';
      if (document.body) document.body.classList.remove('login-view');
      
      // Gece DÃ¶nercisi Ã¶zel: YÃ¶netim butonu gÃ¶ster
      const mgmtBtn = document.getElementById('managementBtn');
      if (mgmtBtn) {
        mgmtBtn.style.display = isGeceDonercisi ? 'inline-flex' : 'none';
      }

      loadSales();
      startRealtimeListener();
      // Dashboard aÃ§Ä±lÄ±r aÃ§Ä±lmaz masa verilerini Ã§ek (aktif masa sayÄ±sÄ± iÃ§in)
      loadTablesDataForStats();
    }

    const REMEMBER_PIN_KEY = 'admin_remember_pin';
    const REMEMBER_ME_KEY = 'admin_remember_me';

    function verifyPin() {
      const pinInput = document.getElementById('pinInput');
      const rememberMe = document.getElementById('rememberMe');
      if (!pinInput) return;
      
      const pin = pinInput.value;
      
      if (pin === adminPin) {
        if (rememberMe && rememberMe.checked) {
          try { localStorage.setItem(REMEMBER_PIN_KEY, pin); localStorage.setItem(REMEMBER_ME_KEY, '1'); } catch (e) {}
        } else {
          try { localStorage.removeItem(REMEMBER_PIN_KEY); localStorage.removeItem(REMEMBER_ME_KEY); } catch (e) {}
        }
        isAuthenticated = true;
        sessionStorage.setItem('adminAuthenticated', 'true');
        showDashboard();
        pinInput.value = '';
      } else {
        alert('PIN hatalÄ±!');
        pinInput.value = '';
      }
    }

    function applyRememberedPin() {
      try {
        if (localStorage.getItem(REMEMBER_ME_KEY) !== '1') return;
        const saved = localStorage.getItem(REMEMBER_PIN_KEY);
        if (!saved) return;
        const pinInput = document.getElementById('pinInput');
        const rememberMe = document.getElementById('rememberMe');
        if (pinInput) { pinInput.value = saved; pinInput.focus(); }
        if (rememberMe) rememberMe.checked = true;
      } catch (e) {}
    }

    function showChangePinModal() {
      const overlay = document.getElementById('changePinOverlay');
      if (overlay) overlay.classList.add('show');
      const cur = document.getElementById('changePinCurrent');
      const neu = document.getElementById('changePinNew');
      if (cur) cur.value = '';
      if (neu) neu.value = '';
      if (cur) cur.focus();
    }

    function hideChangePinModal() {
      const overlay = document.getElementById('changePinOverlay');
      if (overlay) overlay.classList.remove('show');
    }

    function showSuccessPopup(title, subtitle) {
      var t = title || 'Åifreniz BaÅŸarÄ±yla DeÄŸiÅŸtirildi';
      var s = subtitle || 'Bir sonraki giriÅŸte yeni PIN geÃ§erli olacak.';
      var titleEl = document.getElementById('successPopupTitle');
      var subtitleEl = document.getElementById('successPopupSubtitle');
      var overlay = document.getElementById('successPopupOverlay');
      if (titleEl) titleEl.textContent = t;
      if (subtitleEl) subtitleEl.textContent = s;
      if (overlay) overlay.classList.add('show');
    }

    function hideSuccessPopup() {
      var overlay = document.getElementById('successPopupOverlay');
      if (overlay) overlay.classList.remove('show');
    }

    function submitChangePin() {
      const curInput = document.getElementById('changePinCurrent');
      const newInput = document.getElementById('changePinNew');
      if (!curInput || !newInput) return;
      const cur = curInput.value;
      const newPin = newInput.value;
      if (!cur || !newPin) {
        alert('Mevcut PIN ve yeni PIN girin.');
        return;
      }
      if (cur !== adminPin) {
        const saved = localStorage.getItem(REMEMBER_PIN_KEY);
        if (cur !== saved) {
          alert('Mevcut PIN hatalÄ±.');
          return;
        }
      }
      if (tenantDbRef && tenantDocId) {
        var submitBtnEl = document.getElementById('changePinSubmit');
        if (submitBtnEl) { submitBtnEl.disabled = true; submitBtnEl.textContent = 'Kaydediliyor...'; }
        tenantDbRef.collection('tenants').doc(tenantDocId).update({ adminPin: newPin })
          .then(function() {
            adminPin = newPin;
            try { localStorage.setItem(REMEMBER_PIN_KEY, newPin); localStorage.setItem(REMEMBER_ME_KEY, '1'); } catch (e) {}
            hideChangePinModal();
            const pinInput = document.getElementById('pinInput');
            if (pinInput) pinInput.value = newPin;
            const rememberMe = document.getElementById('rememberMe');
            if (rememberMe) rememberMe.checked = true;
            showSuccessPopup('Åifreniz BaÅŸarÄ±yla DeÄŸiÅŸtirildi', 'Bir sonraki giriÅŸte yeni PIN geÃ§erli olacak.');
          })
          .catch(function(err) {
            alert('Firebase\'e kaydedilemedi: ' + (err.message || err));
            console.error('PIN gÃ¼ncelleme hatasÄ±:', err);
          })
          .finally(function() {
            if (submitBtnEl) { submitBtnEl.disabled = false; submitBtnEl.textContent = 'Kaydet'; }
          });
      } else {
        try { localStorage.setItem(REMEMBER_PIN_KEY, newPin); localStorage.setItem(REMEMBER_ME_KEY, '1'); } catch (e) {}
        hideChangePinModal();
        const pinInput = document.getElementById('pinInput');
        if (pinInput) pinInput.value = newPin;
        const rememberMe = document.getElementById('rememberMe');
        if (rememberMe) rememberMe.checked = true;
        alert('Tenant bilgisi yÃ¼klenmediÄŸi iÃ§in sadece "Beni hatÄ±rla" gÃ¼ncellendi.');
      }
    }

    // Eski versiyon kontrolÃ¼ - PWA gÃ¼ncellemesi iÃ§in
    function checkForPWAUpdate() {
      // EÄŸer standalone modda Ã§alÄ±ÅŸÄ±yorsa (PWA olarak kurulmuÅŸsa)
      if (window.matchMedia('(display-mode: standalone)').matches || 
          window.navigator.standalone === true ||
          document.referrer.includes('android-app://')) {
        
        // LocalStorage'da son kontrol zamanÄ±nÄ± kontrol et
        const lastUpdateCheck = localStorage.getItem('lastPWAUpdateCheck');
        const now = Date.now();
        const oneHour = 60 * 60 * 1000; // 1 saat
        
        // Her saatte bir kontrol et (Ã§ok sÄ±k olmasÄ±n)
        if (!lastUpdateCheck || (now - parseInt(lastUpdateCheck)) > oneHour) {
          localStorage.setItem('lastPWAUpdateCheck', now.toString());
          
          // Manifest.json'Ä± kontrol et
          fetch('/manifest.json?v=' + Date.now())
            .then(response => response.json())
            .then(manifest => {
              const currentVersion = manifest.version || 'unknown';
              const storedVersion = localStorage.getItem('pwaVersion');
              
              // EÄŸer versiyon deÄŸiÅŸtiyse veya ilk kontrol ise
              if (storedVersion && storedVersion !== currentVersion) {
                console.log('[PWA] New version detected:', currentVersion);
                // KullanÄ±cÄ±ya bildir
                showUpdateNotification(currentVersion);
              } else if (!storedVersion) {
                // Ä°lk kurulum, versiyonu kaydet
                localStorage.setItem('pwaVersion', currentVersion);
              }
            })
            .catch(error => {
              console.warn('[PWA] Could not check for updates:', error);
            });
        }
      }
    }
    
    // GÃ¼ncelleme bildirimi gÃ¶ster
    function showUpdateNotification(newVersion) {
      // Basit bir bildirim gÃ¶ster
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #dc2626;
        color: white;
        padding: 16px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        max-width: 300px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      `;
      notification.innerHTML = `
        <div style="font-weight: 600; margin-bottom: 8px;">ğŸ”„ Yeni Versiyon Mevcut!</div>
        <div style="font-size: 14px; margin-bottom: 12px;">UygulamayÄ± gÃ¼ncellemek iÃ§in sayfayÄ± yenileyin veya uygulamayÄ± kapatÄ±p aÃ§Ä±n.</div>
        <button onclick="window.location.reload(true)" style="
          background: white;
          color: #dc2626;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          font-weight: 600;
          cursor: pointer;
          width: 100%;
        ">Åimdi GÃ¼ncelle</button>
      `;
      document.body.appendChild(notification);
      
      // 10 saniye sonra otomatik kapat
      setTimeout(() => {
        if (notification.parentNode) {
          notification.style.opacity = '0';
          notification.style.transition = 'opacity 0.3s';
          setTimeout(() => notification.remove(), 300);
        }
      }, 10000);
    }

    // Sayfa yÃ¼klendiÄŸinde kontrol et
    window.addEventListener('load', () => {
      // PWA gÃ¼ncelleme kontrolÃ¼
      checkForPWAUpdate();
      
      // Splash screen'i gÃ¶ster
      const loader = document.getElementById('loader');
      if (loader) {
        loader.style.display = 'flex';
      }

      // 2.5 saniye sonra splash screen'i kapat
      setTimeout(() => {
        if (loader) {
          loader.style.opacity = '0';
          loader.style.transition = 'opacity 0.5s ease';
          setTimeout(() => {
            loader.style.display = 'none';
            
            // Firebase'in hazÄ±r olmasÄ±nÄ± bekle
            const checkFirebase = setInterval(() => {
              if (db) {
                clearInterval(checkFirebase);
                
                if (!tablesDb) {
                  console.warn('âš ï¸ Masalar Firebase baÅŸlatÄ±lamadÄ± - masalar bÃ¶lÃ¼mÃ¼ Ã§alÄ±ÅŸmayabilir');
                } else {
                  console.log('âœ… Masalar Firebase hazÄ±r');
                }
                
                if (sessionStorage.getItem('adminAuthenticated') === 'true') {
                  showDashboard();
                } else {
                  showLogin();
                }
              }
            }, 100);
            
            // 5 saniye sonra timeout
            setTimeout(() => {
              clearInterval(checkFirebase);
              if (!db) {
                console.error('âŒ Ana Firebase baÅŸlatÄ±lamadÄ±');
              }
            }, 5000);
          }, 500);
        }
      }, 2500);
    });

    // SatÄ±ÅŸlarÄ± yÃ¼kle - SADECE SON 2 GÃœNÃœ YÃœKLE (Firebase read limitini korumak iÃ§in)
    async function loadSales() {
      if (!db) {
        console.error('Firebase baÅŸlatÄ±lamadÄ±');
        return;
      }

      try {
        showLoading(true);
        const salesRef = db.collection('sales');
        
        // Son 2 gÃ¼nÃ¼ hesapla (gece 03:00'a gÃ¶re iÅŸ gÃ¼nÃ¼)
        const businessDay = getBusinessDayDate();
        const twoDaysAgo = new Date(businessDay);
        twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
        twoDaysAgo.setHours(0, 0, 0, 0);
        
        // Tarih string formatÄ±na Ã§evir (DD.MM.YYYY)
        const twoDaysAgoStr = twoDaysAgo.toLocaleDateString('tr-TR');
        const businessDayStr = businessDay.toLocaleDateString('tr-TR');
        
        // Son 2 gÃ¼nÃ¼n satÄ±ÅŸlarÄ±nÄ± yÃ¼kle
        let allDocs = [];
        let lastDoc = null;
        let hasMore = true;
        let daysLoaded = new Set();
        
        while (hasMore) {
          let query = salesRef;
          
          // Ä°lk sorgu iÃ§in orderBy dene
          if (!lastDoc) {
            try {
              query = salesRef.orderBy('sale_date', 'desc');
            } catch (e) {
              try {
                query = salesRef.orderBy('created_at', 'desc');
              } catch (e2) {
                query = salesRef;
              }
            }
          } else {
            // Sonraki sayfalar iÃ§in
            try {
              query = salesRef.orderBy('sale_date', 'desc').startAfter(lastDoc);
            } catch (e) {
              try {
                query = salesRef.orderBy('created_at', 'desc').startAfter(lastDoc);
              } catch (e2) {
                query = salesRef.startAfter(lastDoc);
              }
            }
          }
          
          // Her seferinde 500 kayÄ±t al
          const querySnapshot = await query.limit(500).get();
          
          if (querySnapshot.empty) {
            hasMore = false;
          } else {
            let foundOldDate = false;
            querySnapshot.forEach((doc) => {
              const data = doc.data();
              const saleDate = data.sale_date || '';
              
              // Son 2 gÃ¼n iÃ§indeki satÄ±ÅŸlarÄ± al
              if (saleDate && saleDate !== 'Bilinmeyen') {
                const [day, month, year] = saleDate.split('.');
                if (day && month && year) {
                  const saleDateObj = new Date(year, month - 1, day);
                  saleDateObj.setHours(0, 0, 0, 0);
                  
                  // Son 2 gÃ¼n iÃ§indeyse ekle
                  if (saleDateObj >= twoDaysAgo && saleDateObj <= businessDay) {
                    allDocs.push(doc);
                    daysLoaded.add(saleDate);
                  } else if (saleDateObj < twoDaysAgo) {
                    // 2 gÃ¼nden eski tarih bulundu, dur
                    foundOldDate = true;
                  }
                }
              } else {
                // Tarih bilinmeyen satÄ±ÅŸlarÄ± da ekle (son 2 gÃ¼n iÃ§inde oluÅŸturulmuÅŸ olabilir)
                if (data.created_at) {
                  const timestamp = data.created_at;
                  const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
                  if (date >= twoDaysAgo) {
                    allDocs.push(doc);
                  } else {
                    foundOldDate = true;
                  }
                }
              }
            });
            
            // Son dokÃ¼manÄ± kaydet
            lastDoc = querySnapshot.docs[querySnapshot.docs.length - 1];
            
            // EÄŸer 2 gÃ¼nden eski tarih bulunduysa veya 500'den az kayÄ±t geldiyse, dur
            if (foundOldDate || querySnapshot.docs.length < 500) {
              hasMore = false;
            }
          }
        }
        
        const querySnapshot = {
          forEach: (callback) => {
            allDocs.forEach(callback);
          }
        };
        
        const sales = [];
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          
          // Timestamp'i dÃ¶nÃ¼ÅŸtÃ¼r
          let saleDate = data.sale_date;
          let saleTime = data.sale_time;
          
          // EÄŸer sale_date yoksa, created_at veya timestamp'ten oluÅŸtur
          if (!saleDate && data.created_at) {
            const timestamp = data.created_at;
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
            saleDate = normalizeDateString(date);
            saleTime = date.toLocaleTimeString('tr-TR');
          } else if (!saleDate && data.timestamp) {
            const timestamp = data.timestamp;
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
            saleDate = normalizeDateString(date);
            saleTime = date.toLocaleTimeString('tr-TR');
          } else if (saleDate) {
            // sale_date varsa ama format farklÄ±ysa normalize et
            // EÄŸer format zaten DD.MM.YYYY deÄŸilse dÃ¼zelt
            if (typeof saleDate === 'string' && !/^\d{2}\.\d{2}\.\d{4}$/.test(saleDate)) {
              try {
                const parsedDate = new Date(saleDate);
                if (!isNaN(parsedDate.getTime())) {
                  saleDate = normalizeDateString(parsedDate);
                }
              } catch (e) {
                console.warn('Tarih parse edilemedi:', saleDate, e);
              }
            }
          }
          
          // Items'Ä± parse et
          let items = [];
          let itemsArray = data.items_array || [];
          
          if (data.items) {
            if (Array.isArray(data.items)) {
              items = data.items;
            } else if (typeof data.items === 'string') {
              // String formatÄ±: "ÃœrÃ¼n AdÄ± x2, ÃœrÃ¼n AdÄ± 2 x3"
              items = data.items.split(', ').map(item => {
                const match = item.match(/(.+) x(\d+)/);
                if (match) {
                  return {
                    product_name: match[1].replace(' (Ä°KRAM)', ''),
                    quantity: parseInt(match[2]),
                    isGift: item.includes('(Ä°KRAM)')
                  };
                }
                return { product_name: item, quantity: 1, isGift: false };
              });
            }
          }
          
          sales.push({
            id: doc.id,
            sale_id: data.sale_id || doc.id,
            total_amount: data.total_amount || 0,
            payment_method: data.payment_method || 'Nakit',
            sale_date: saleDate || 'Bilinmeyen',
            sale_time: saleTime || '',
            staff_name: data.staff_name || null,
            table_name: data.table_name || null,
            table_type: data.table_type || null,
            order_source: data.order_source || null, // 'Trendyol', 'Yemeksepeti', or null
            items: items,
            items_array: itemsArray, // GerÃ§ek Firebase verileri
            itemsText: data.items || 'ÃœrÃ¼n bulunamadÄ±',
            isExpense: data.isExpense === true || data.isExpense === 'true' || data.payment_method === 'Masraf'
          });
        });

        // Tarih + saate gÃ¶re sÄ±rala (en yeni satÄ±ÅŸ en Ã¼stte)
        sales.sort((a, b) => {
          if (a.sale_date && b.sale_date) {
            const [dayA, monthA, yearA] = a.sale_date.split('.');
            const [dayB, monthB, yearB] = b.sale_date.split('.');
            if (dayA && monthA && yearA && dayB && monthB && yearB) {
              const dateA = new Date(yearA, monthA - 1, dayA);
              const dateB = new Date(yearB, monthB - 1, dayB);
              
              if (a.sale_time) {
                const [hA, mA, sA] = a.sale_time.split(':');
                dateA.setHours(parseInt(hA) || 0, parseInt(mA) || 0, parseInt(sA) || 0, 0);
              }
              if (b.sale_time) {
                const [hB, mB, sB] = b.sale_time.split(':');
                dateB.setHours(parseInt(hB) || 0, parseInt(mB) || 0, parseInt(sB) || 0, 0);
              }
              
              const diff = dateB - dateA;
              if (diff !== 0) return diff;
            }
          }
          
          // Tarih/saat yoksa veya eÅŸitse, sale_id'ye gÃ¶re (bÃ¼yÃ¼kten kÃ¼Ã§Ã¼ÄŸe) sÄ±rala
          const idA = parseInt(a.sale_id || a.id) || 0;
          const idB = parseInt(b.sale_id || b.id) || 0;
          return idB - idA;
        });

        allSales = sales; // TÃ¼m satÄ±ÅŸlarÄ± sakla
        renderCurrentView();
        updateStats(sales);
        showLoading(false);
      } catch (error) {
        console.error('SatÄ±ÅŸ yÃ¼kleme hatasÄ±:', error);
        showLoading(false);
        const container = document.getElementById('salesContainer');
        if (container) {
          container.innerHTML = `
            <div class="error-card">
              <div class="error-icon">âš ï¸</div>
              <h3>BaÄŸlantÄ± HatasÄ±</h3>
              <p>${error.message || 'Firebase\'e baÄŸlanÄ±lamadÄ±'}</p>
              <button onclick="location.reload()" class="retry-btn">ğŸ”„ Yeniden Dene</button>
            </div>
          `;
        }
      }
    }

    // Real-time dinleme - TÃœM SATIÅLARI DÄ°NLE (limit yok)
    function startRealtimeListener() {
      if (!db) return;
      
      if (realtimeUnsubscribe) {
        realtimeUnsubscribe();
      }

      const salesRef = db.collection('sales');
      // Real-time listener iÃ§in tÃ¼m satÄ±ÅŸlarÄ± dinle (limit yok)
      // Not: Real-time listener'da pagination yapmak zor olduÄŸu iÃ§in
      // Ä°lk yÃ¼klemede tÃ¼m satÄ±ÅŸlar yÃ¼klenecek, sonra sadece yeni satÄ±ÅŸlar dinlenecek
      let query = salesRef;
      try {
        query = salesRef.orderBy('sale_date', 'desc');
      } catch (e) {
        try {
          query = salesRef.orderBy('created_at', 'desc');
        } catch (e2) {
          query = salesRef;
        }
      }
      
      // Real-time listener iÃ§in limit kaldÄ±rÄ±ldÄ±
      // Not: Firebase real-time listener'da Ã§ok fazla veri olabilir
      // Bu durumda performans sorunlarÄ± olabilir, ama tÃ¼m verileri gÃ¶rmek iÃ§in gerekli
      realtimeUnsubscribe = query.onSnapshot((snapshot) => {
        const sales = [];
        snapshot.forEach((doc) => {
          const data = doc.data();
          
          let saleDate = data.sale_date;
          let saleTime = data.sale_time;
          
          if (!saleDate && data.created_at) {
            const timestamp = data.created_at;
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
            saleDate = normalizeDateString(date);
            saleTime = date.toLocaleTimeString('tr-TR');
          } else if (!saleDate && data.timestamp) {
            const timestamp = data.timestamp;
            const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp.seconds * 1000);
            saleDate = normalizeDateString(date);
            saleTime = date.toLocaleTimeString('tr-TR');
          } else if (saleDate) {
            // sale_date varsa ama format farklÄ±ysa normalize et
            if (typeof saleDate === 'string' && !/^\d{2}\.\d{2}\.\d{4}$/.test(saleDate)) {
              try {
                const parsedDate = new Date(saleDate);
                if (!isNaN(parsedDate.getTime())) {
                  saleDate = normalizeDateString(parsedDate);
                }
              } catch (e) {
                console.warn('Tarih parse edilemedi:', saleDate, e);
              }
            }
          }
          
          let items = [];
          let itemsArray = data.items_array || [];
          
          if (data.items) {
            if (Array.isArray(data.items)) {
              items = data.items;
            } else if (typeof data.items === 'string') {
              items = data.items.split(', ').map(item => {
                const match = item.match(/(.+) x(\d+)/);
                if (match) {
                  return {
                    product_name: match[1].replace(' (Ä°KRAM)', ''),
                    quantity: parseInt(match[2]),
                    isGift: item.includes('(Ä°KRAM)')
                  };
                }
                return { product_name: item, quantity: 1, isGift: false };
              });
            }
          }
          
          sales.push({
            id: doc.id,
            sale_id: data.sale_id || doc.id,
            total_amount: data.total_amount || 0,
            payment_method: data.payment_method || 'Nakit',
            sale_date: saleDate || 'Bilinmeyen',
            sale_time: saleTime || '',
            staff_name: data.staff_name || null,
            table_name: data.table_name || null,
            table_type: data.table_type || null,
            order_source: data.order_source || null, // 'Trendyol', 'Yemeksepeti', or null
            items: items,
            items_array: itemsArray, // GerÃ§ek Firebase verileri
            itemsText: data.items || 'ÃœrÃ¼n bulunamadÄ±',
            isExpense: data.isExpense === true || data.isExpense === 'true' || data.payment_method === 'Masraf'
          });
        });

        sales.sort((a, b) => {
          if (!a.sale_date || !b.sale_date) return 0;
          const [dayA, monthA, yearA] = a.sale_date.split('.');
          const [dayB, monthB, yearB] = b.sale_date.split('.');
          if (!dayA || !dayB) return 0;
          const dateA = new Date(yearA, monthA - 1, dayA);
          const dateB = new Date(yearB, monthB - 1, dayB);
          return dateB - dateA;
        });

        allSales = sales; // TÃ¼m satÄ±ÅŸlarÄ± sakla
        renderCurrentView();
        updateStats(sales);
        
        // Yeni satÄ±ÅŸ geldiÄŸinde gÃ¼nlÃ¼k cirolarÄ± otomatik kaydet
        autoSaveDailyRevenue();
      }, (error) => {
        console.error('Real-time listener hatasÄ±:', error);
      });
    }

    // Tarihi formatla
    function formatDateDisplay(dateStr) {
      if (!dateStr || dateStr === 'Bilinmeyen') return dateStr;
      const [day, month, year] = dateStr.split('.');
      if (!day || !month || !year) return dateStr;
      
      const date = new Date(year, month - 1, day);
      const days = ['Pazar', 'Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi'];
      const months = ['Ocak', 'Åubat', 'Mart', 'Nisan', 'MayÄ±s', 'Haziran', 'Temmuz', 'AÄŸustos', 'EylÃ¼l', 'Ekim', 'KasÄ±m', 'AralÄ±k'];
      
      const dayName = days[date.getDay()];
      const monthName = months[parseInt(month) - 1];
      
      const businessDay = getBusinessDayDate();
      const todayStr = businessDay.toLocaleDateString('tr-TR');
      const yesterday = new Date(businessDay);
      yesterday.setDate(yesterday.getDate() - 1);
      const yesterdayStr = yesterday.toLocaleDateString('tr-TR');
      
      const saleDateStr = `${day}.${month}.${year}`;
      
      if (saleDateStr === todayStr) {
        return `BugÃ¼n - ${day} ${monthName} ${year}`;
      } else if (saleDateStr === yesterdayStr) {
        return `DÃ¼n - ${day} ${monthName} ${year}`;
      } else {
        return `${day} ${monthName} ${year} - ${dayName}`;
      }
    }

    // SatÄ±ÅŸlarÄ± tarih filtresine gÃ¶re filtrele
    function filterSalesByDateForHistory(sales) {
      const businessDay = getBusinessDayDate();
      const now = new Date();
      now.setHours(23, 59, 59, 999);
      
      if (salesDateFilter === 'yesterday') {
        const yesterday = new Date(businessDay);
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toLocaleDateString('tr-TR');
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          return sale.sale_date === yesterdayStr;
        });
      } else if (salesDateFilter === 'week') {
        const weekAgo = new Date(businessDay);
        weekAgo.setDate(weekAgo.getDate() - 7);
        const weekAgoStr = weekAgo.toLocaleDateString('tr-TR');
        const todayStr = businessDay.toLocaleDateString('tr-TR');
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          // Tarih string karÅŸÄ±laÅŸtÄ±rmasÄ± iÃ§in parse et
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          const weekAgoDate = new Date(weekAgo);
          weekAgoDate.setHours(0, 0, 0, 0);
          const todayDate = new Date(businessDay);
          todayDate.setHours(23, 59, 59, 999);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= weekAgoDate && saleDate <= todayDate;
        });
      } else if (salesDateFilter === 'month') {
        const monthAgo = new Date(businessDay);
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        const todayStr = businessDay.toLocaleDateString('tr-TR');
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          const monthAgoDate = new Date(monthAgo);
          monthAgoDate.setHours(0, 0, 0, 0);
          const todayDate = new Date(businessDay);
          todayDate.setHours(23, 59, 59, 999);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= monthAgoDate && saleDate <= todayDate;
        });
      } else if (salesDateFilter === 'custom' && salesCustomDateRange.start && salesCustomDateRange.end) {
        const startDate = new Date(salesCustomDateRange.start);
        startDate.setHours(0, 0, 0, 0);
        const endDate = new Date(salesCustomDateRange.end);
        endDate.setHours(23, 59, 59, 999);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= startDate && saleDate <= endDate;
        });
      }
      
      return sales; // 'all' iÃ§in tÃ¼m satÄ±ÅŸlar
    }

    // SatÄ±ÅŸlarÄ± render et
    function renderSales(sales) {
      const container = document.getElementById('salesContainer');
      if (!container) return;

      // Tarih filtresine gÃ¶re filtrele
      const filteredSales = filterSalesByDateForHistory(sales);

      // Header ve tarih filtresi butonu
      const filterLabels = {
        'all': 'TÃ¼m Zamanlar',
        'yesterday': 'DÃ¼n',
        'week': 'Son 1 Hafta',
        'month': 'Son 1 Ay',
        'custom': salesCustomDateRange.start && salesCustomDateRange.end 
          ? `${salesCustomDateRange.start.toLocaleDateString('tr-TR')} - ${salesCustomDateRange.end.toLocaleDateString('tr-TR')}`
          : 'Ã–zel Tarih'
      };

      let html = `
        <div id="salesHeader" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding: 0 4px;">
          <h2 style="font-size: 18px; font-weight: 700; color: #1f2937; margin: 0;">SatÄ±ÅŸ GeÃ§miÅŸi</h2>
          <div class="date-filter-wrapper">
            <button class="date-filter-trigger" onclick="toggleSalesDateFilterModal(event)">
              <span>ğŸ“…</span>
              <span id="salesDateFilterLabel">${filterLabels[salesDateFilter] || 'TÃ¼m Zamanlar'}</span>
              <span class="date-filter-arrow">â–¼</span>
            </button>
            <div id="salesDateFilterModal" class="date-filter-modal">
              <div class="date-filter-modal-content">
                <div class="date-filter-option ${salesDateFilter === 'yesterday' ? 'active' : ''}" onclick="setSalesDateFilter('yesterday'); closeSalesDateFilterModal();">
                  <span class="date-filter-icon">ğŸ“†</span>
                  <span>DÃ¼n</span>
                </div>
                <div class="date-filter-option ${salesDateFilter === 'week' ? 'active' : ''}" onclick="setSalesDateFilter('week'); closeSalesDateFilterModal();">
                  <span class="date-filter-icon">ğŸ“…</span>
                  <span>Son 1 Hafta</span>
                </div>
                <div class="date-filter-option ${salesDateFilter === 'month' ? 'active' : ''}" onclick="setSalesDateFilter('month'); closeSalesDateFilterModal();">
                  <span class="date-filter-icon">ğŸ“…</span>
                  <span>Son 1 Ay</span>
                </div>
                <div class="date-filter-option ${salesDateFilter === 'all' ? 'active' : ''}" onclick="setSalesDateFilter('all'); closeSalesDateFilterModal();">
                  <span class="date-filter-icon">ğŸ“Š</span>
                  <span>TÃ¼m Zamanlar</span>
                </div>
                <div class="date-filter-divider"></div>
                <div class="date-filter-option ${salesDateFilter === 'custom' ? 'active' : ''}" onclick="document.getElementById('salesCustomDateRangeSection').style.display = 'block';">
                  <span class="date-filter-icon">ğŸ—“ï¸</span>
                  <span>Ã–zel Tarih AralÄ±ÄŸÄ±</span>
                </div>
                <div id="salesCustomDateRangeSection" class="custom-date-range-section" style="display: ${salesDateFilter === 'custom' ? 'block' : 'none'};">
                  <div class="custom-date-inputs">
                    <div class="custom-date-input-group">
                      <label>BaÅŸlangÄ±Ã§:</label>
                      <input type="date" id="salesCustomDateStart" value="${salesCustomDateRange.start ? formatDateForInput(salesCustomDateRange.start) : ''}">
                    </div>
                    <div class="custom-date-input-group">
                      <label>BitiÅŸ:</label>
                      <input type="date" id="salesCustomDateEnd" value="${salesCustomDateRange.end ? formatDateForInput(salesCustomDateRange.end) : ''}">
                    </div>
                  </div>
                  <button onclick="setSalesCustomDateRange()" class="custom-date-apply-btn">Uygula</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;

      if (filteredSales.length === 0) {
        html += `
          <div class="empty-state">
            <div class="empty-icon">ğŸ“Š</div>
            <h3>SeÃ§ilen Tarih AralÄ±ÄŸÄ±nda SatÄ±ÅŸ Yok</h3>
            <p>FarklÄ± bir tarih aralÄ±ÄŸÄ± seÃ§meyi deneyin</p>
          </div>
        `;
        container.innerHTML = html;
        return;
      }

      // Tarihe gÃ¶re grupla (filtrelenmiÅŸ satÄ±ÅŸlar Ã¼zerinde)
      const salesByDate = {};
      filteredSales.forEach(sale => {
        const date = sale.sale_date || 'Bilinmeyen';
        if (!salesByDate[date]) {
          salesByDate[date] = [];
        }
        salesByDate[date].push(sale);
      });

      // Tarihleri sÄ±rala
      const sortedDates = Object.keys(salesByDate).sort((a, b) => {
        if (a === 'Bilinmeyen') return 1;
        if (b === 'Bilinmeyen') return -1;
        const [dayA, monthA, yearA] = a.split('.');
        const [dayB, monthB, yearB] = b.split('.');
        if (!dayA || !dayB) return 0;
        const dateA = new Date(yearA, monthA - 1, dayA);
        const dateB = new Date(yearB, monthB - 1, dayB);
        return dateB - dateA;
      });
      sortedDates.forEach(date => {
        let daySales = salesByDate[date];
        
        // Her tarih grubu iÃ§indeki satÄ±ÅŸlarÄ± saat bilgisine gÃ¶re sÄ±rala (en yeni Ã¶nce)
        daySales.sort((a, b) => {
          // Ã–nce saat bilgisine gÃ¶re sÄ±rala
          if (a.sale_time && b.sale_time) {
            const [hA, mA, sA] = a.sale_time.split(':').map(Number);
            const [hB, mB, sB] = b.sale_time.split(':').map(Number);
            const timeA = (hA || 0) * 3600 + (mA || 0) * 60 + (sA || 0);
            const timeB = (hB || 0) * 3600 + (mB || 0) * 60 + (sB || 0);
            if (timeB !== timeA) return timeB - timeA; // En yeni saat Ã¶nce
          }
          
          // Saat bilgisi yoksa veya eÅŸitse sale_id'ye gÃ¶re sÄ±rala (bÃ¼yÃ¼kten kÃ¼Ã§Ã¼ÄŸe)
          const idA = parseInt(a.sale_id || a.id || 0);
          const idB = parseInt(b.sale_id || b.id || 0);
          return idB - idA;
        });
        
        // MasraflarÄ± hariÃ§ tut
        const dayTotal = daySales
          .filter(sale => !sale.isExpense && sale.payment_method !== 'Masraf')
          .reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);
        
        html += `
          <div class="date-group">
            <div class="date-header">
              <div>
                <div class="date-title-wrapper">
                  <div class="date-icon">ğŸ“…</div>
                  <div>
                    <h2 class="date-title">${formatDateDisplay(date)}</h2>
                  </div>
                </div>
              </div>
              <div class="date-stats">
                <div class="date-stat-item">
                  <span class="date-stat-label">SatÄ±ÅŸ</span>
                  <span class="date-stat-value">${daySales.length}</span>
                </div>
                <div class="date-stat-item">
                  <span class="date-stat-label">Toplam</span>
                  <span class="date-stat-value amount">â‚º${dayTotal.toFixed(2)}</span>
                </div>
              </div>
            </div>
            <div class="sales-grid">
              ${daySales.map(sale => {
                // Masraf kontrolÃ¼ - birden fazla yÃ¶ntemle kontrol et
                const isExpense = sale.isExpense === true || 
                                  sale.isExpense === 'true' ||
                                  sale.payment_method === 'Masraf' ||
                                  (sale.items_array && sale.items_array.length > 0 && (
                                    sale.items_array[0].isExpense === true ||
                                    sale.items_array[0].isExpense === 'true' ||
                                    (sale.items_array[0].product_id && sale.items_array[0].product_id.toString().startsWith('expense-'))
                                  ));
                
                // Masraf ise farklÄ± gÃ¶rÃ¼nÃ¼m
                if (isExpense) {
                  const expenseTitle = sale.items_array && sale.items_array.length > 0 
                    ? sale.items_array[0].product_name 
                    : (sale.itemsText || sale.items || 'Masraf');
                  
                  return `
                    <div class="sale-card expense-card">
                      <div class="expense-header">
                        <div class="expense-info">
                          <h3 class="expense-title">${expenseTitle}</h3>
                          <p class="expense-time">${sale.sale_time || ''}</p>
                          <span class="badge badge-expense">ğŸ’° Masraf</span>
                        </div>
                        <div class="expense-amount">
                          <p class="expense-label">MÄ°KTAR</p>
                          <p class="expense-value">â‚º${parseFloat(sale.total_amount || 0).toFixed(2)}</p>
                        </div>
                      </div>
                    </div>
                  `;
                }
                
                // Normal satÄ±ÅŸ gÃ¶rÃ¼nÃ¼mÃ¼
                const itemsHtml = sale.items && sale.items.length > 0
                  ? sale.items.map(item => `
                    <div class="sale-item">
                      <span class="item-name">${item.product_name}</span>
                      <span class="item-quantity">x${item.quantity}</span>
                      ${item.isGift ? '<span class="gift-badge">Ä°KRAM</span>' : ''}
                    </div>
                  `).join('')
                  : `<div class="sale-item"><span class="item-name">${sale.itemsText || 'ÃœrÃ¼n bulunamadÄ±'}</span></div>`;
                
                return `
                <div class="sale-card">
                  <div class="sale-header">
                    <div class="sale-info">
                      <h3 class="sale-id">SatÄ±ÅŸ #${sale.sale_id || sale.id}</h3>
                      <p class="sale-time">${sale.sale_time || ''}</p>
                      <div class="sale-badges">
                        <span class="badge badge-${sale.payment_method === 'Nakit' ? 'cash' : 'card'}">
                          ${sale.payment_method === 'Nakit' ? 'ğŸ’µ Nakit' : 'ğŸ’³ Kart'}
                        </span>
                        ${sale.staff_name ? `<span class="badge badge-staff">ğŸ‘¤ ${sale.staff_name}</span>` : ''}
                        ${sale.table_name ? `<span class="badge badge-table">ğŸª‘ ${sale.table_name}${sale.table_type ? ` (${sale.table_type})` : ''}</span>` : ''}
                      </div>
                    </div>
                    <div class="sale-total">
                      <p class="total-label">TOPLAM</p>
                      <p class="total-amount">â‚º${parseFloat(sale.total_amount || 0).toFixed(2)}</p>
                    </div>
                  </div>
                  <div class="sale-items">
                    <p class="items-label">ÃœrÃ¼nler:</p>
                    <div class="items-list">
                      ${itemsHtml}
                    </div>
                  </div>
                  <div class="sale-card-actions">
                    <button type="button" class="sale-action-btn sale-edit-btn" onclick="openEditSaleModal('${(sale.id || '').toString().replace(/'/g, "\\'")}')" title="DÃ¼zenle">DÃ¼zenle</button>
                    <button type="button" class="sale-action-btn sale-delete-btn" onclick="openDeleteConfirm('${(sale.id || '').toString().replace(/'/g, "\\'")}')" title="Sil">Sil</button>
                  </div>
                </div>
              `;
              }).join('')}
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // SatÄ±ÅŸ geÃ§miÅŸi tarih filtresini gÃ¼ncelle
    function updateSalesDateFilterButton() {
      const label = document.getElementById('salesDateFilterLabel');
      if (!label) return;

      const filterLabels = {
        'all': 'TÃ¼m Zamanlar',
        'yesterday': 'DÃ¼n',
        'week': 'Son 1 Hafta',
        'month': 'Son 1 Ay',
        'custom': salesCustomDateRange.start && salesCustomDateRange.end 
          ? `${salesCustomDateRange.start.toLocaleDateString('tr-TR')} - ${salesCustomDateRange.end.toLocaleDateString('tr-TR')}`
          : 'Ã–zel Tarih'
      };

      label.textContent = filterLabels[salesDateFilter] || 'TÃ¼m Zamanlar';
    }

    // SatÄ±ÅŸ geÃ§miÅŸi tarih filtresini deÄŸiÅŸtir
    function setSalesDateFilter(filter) {
      salesDateFilter = filter;
      renderSales(allSales);
      updateSalesDateFilterButton();
    }

    // SatÄ±ÅŸ geÃ§miÅŸi Ã¶zel tarih aralÄ±ÄŸÄ± seÃ§
    function setSalesCustomDateRange() {
      const startInput = document.getElementById('salesCustomDateStart');
      const endInput = document.getElementById('salesCustomDateEnd');
      
      if (!startInput || !endInput) return;
      
      const start = startInput.value;
      const end = endInput.value;
      
      if (!start || !end) {
        alert('LÃ¼tfen baÅŸlangÄ±Ã§ ve bitiÅŸ tarihlerini seÃ§in');
        return;
      }
      
      const startDate = parseDateFromInput(start);
      const endDate = parseDateFromInput(end);
      
      if (startDate > endDate) {
        alert('BaÅŸlangÄ±Ã§ tarihi bitiÅŸ tarihinden sonra olamaz');
        return;
      }
      
      salesCustomDateRange.start = startDate;
      salesCustomDateRange.end = endDate;
      salesDateFilter = 'custom';
      renderSales(allSales);
      updateSalesDateFilterButton();
      closeSalesDateFilterModal();
    }

    // SatÄ±ÅŸ geÃ§miÅŸi tarih filtresi modal'Ä±nÄ± aÃ§/kapa
    function toggleSalesDateFilterModal(event) {
      if (event) {
        event.stopPropagation();
      }
      const modal = document.getElementById('salesDateFilterModal');
      if (modal) {
        const isOpen = modal.classList.contains('show');
        // Ã–nce tÃ¼m modal'larÄ± kapat
        document.querySelectorAll('.date-filter-modal').forEach(m => m.classList.remove('show'));
        if (!isOpen) {
          modal.classList.add('show');
        }
      }
    }

    function closeSalesDateFilterModal() {
      const modal = document.getElementById('salesDateFilterModal');
      if (modal) {
        modal.classList.remove('show');
      }
      const customSection = document.getElementById('salesCustomDateRangeSection');
      if (customSection && salesDateFilter !== 'custom') {
        customSection.style.display = 'none';
      }
    }

    // --- SatÄ±ÅŸ Silme Onay ---
    function openDeleteConfirm(saleId) {
      saleIdToDelete = saleId;
      const overlay = document.getElementById('deleteSaleConfirmOverlay');
      if (overlay) {
        overlay.style.display = 'flex';
        overlay.style.alignItems = 'center';
        overlay.style.justifyContent = 'center';
      }
    }
    function closeDeleteConfirm() {
      saleIdToDelete = null;
      const overlay = document.getElementById('deleteSaleConfirmOverlay');
      if (overlay) overlay.style.display = 'none';
    }
    async function confirmDeleteSale() {
      if (!saleIdToDelete || !db) return;
      const btn = document.getElementById('deleteSaleConfirmBtn');
      if (btn) { btn.disabled = true; btn.textContent = 'Siliniyorâ€¦'; }
      try {
        const salesRef = db.collection('sales');
        await salesRef.doc(saleIdToDelete).delete();
        closeDeleteConfirm();
        allSales = allSales.filter(s => s.id !== saleIdToDelete);
        renderSales(allSales);
        updateStats(allSales);
      } catch (e) {
        console.error('SatÄ±ÅŸ silinirken hata:', e);
        if (btn) { btn.disabled = false; btn.textContent = 'Sil'; }
        alert('SatÄ±ÅŸ silinirken bir hata oluÅŸtu: ' + (e.message || e));
      }
      if (btn) { btn.disabled = false; btn.textContent = 'Sil'; }
    }

    // --- SatÄ±ÅŸ DÃ¼zenleme Modal ---
    function openEditSaleModal(saleId) {
      const sale = allSales.find(s => s.id === saleId);
      if (!sale || sale.isExpense) return;
      editingSaleId = saleId;
      const raw = (sale.items_array && sale.items_array.length) ? sale.items_array : (sale.items || []).map(it => ({
        product_id: it.product_id || null,
        product_name: it.product_name || it.name || 'ÃœrÃ¼n',
        quantity: it.quantity || 1,
        price: it.price != null ? parseFloat(it.price) : 0,
        isGift: it.isGift || false,
        staff_id: it.staff_id || null,
        staff_name: it.staff_name || null
      }));
      editingSaleItems = raw.map(it => ({ ...it, quantity: Math.max(0, parseInt(it.quantity, 10) || 1) }));
      const sel = document.getElementById('editSalePaymentMethod');
      if (sel) sel.value = (sale.payment_method === 'Kredi KartÄ±' || sale.payment_method === 'Kart') ? 'Kredi KartÄ±' : 'Nakit';
      renderEditSaleItems();
      updateEditSaleTotal();
      const overlay = document.getElementById('editSaleOverlay');
      if (overlay) {
        overlay.style.display = 'flex';
        overlay.style.alignItems = 'center';
        overlay.style.justifyContent = 'center';
      }
    }
    function closeEditSaleModal() {
      editingSaleId = null;
      editingSaleItems = [];
      const overlay = document.getElementById('editSaleOverlay');
      if (overlay) overlay.style.display = 'none';
    }
    function editSaleItemQty(index, delta) {
      if (!editingSaleItems[index]) return;
      const q = Math.max(0, (editingSaleItems[index].quantity || 0) + delta);
      editingSaleItems[index].quantity = q;
      if (q === 0) editingSaleItems.splice(index, 1);
      renderEditSaleItems();
      updateEditSaleTotal();
    }
    function renderEditSaleItems() {
      const list = document.getElementById('editSaleItemsList');
      if (!list) return;
      list.innerHTML = editingSaleItems.map((it, i) => {
        const price = parseFloat(it.price) || 0;
        const lineTotal = (it.quantity || 0) * price;
        return `
          <div class="edit-sale-item-row" style="display:flex;align-items:center;justify-content:space-between;padding:12px 14px;background:#f8fafc;border-radius:12px;border:1px solid #e2e8f0;">
            <div style="flex:1;min-width:0;">
              <div style="font-weight:700;color:#0f172a;font-size:14px;">${(it.product_name || 'ÃœrÃ¼n').replace(/</g,'&lt;')}</div>
              <div style="font-size:12px;color:#64748b;">â‚º${price.toFixed(2)} Ã— ${it.quantity} = â‚º${lineTotal.toFixed(2)}</div>
            </div>
            <div style="display:flex;align-items:center;gap:8px;">
              <button type="button" onclick="editSaleItemQty(${i}, -1)" style="width:36px;height:36px;border:2px solid #e2e8f0;border-radius:10px;background:#fff;font-size:18px;font-weight:700;color:#475569;cursor:pointer;">âˆ’</button>
              <span style="min-width:28px;text-align:center;font-weight:700;">${it.quantity}</span>
              <button type="button" onclick="editSaleItemQty(${i}, 1)" style="width:36px;height:36px;border:2px solid #e2e8f0;border-radius:10px;background:#fff;font-size:18px;font-weight:700;color:#475569;cursor:pointer;">+</button>
            </div>
          </div>`;
      }).join('');
    }
    function updateEditSaleTotal() {
      let total = 0;
      editingSaleItems.forEach(it => { total += (parseFloat(it.price) || 0) * (it.quantity || 0); });
      const el = document.getElementById('editSaleTotalDisplay');
      if (el) el.textContent = 'â‚º' + total.toFixed(2);
    }
    async function saveEditSale() {
      if (!editingSaleId || !db) return;
      const paymentMethod = document.getElementById('editSalePaymentMethod');
      const method = paymentMethod ? paymentMethod.value : 'Nakit';
      const itemsToSave = editingSaleItems.filter(it => (it.quantity || 0) > 0);
      if (itemsToSave.length === 0) {
        alert('En az bir Ã¼rÃ¼n kalmalÄ±. Silmek iÃ§in SatÄ±ÅŸ Sil butonunu kullanÄ±n.');
        return;
      }
      let totalAmount = 0;
      itemsToSave.forEach(it => { totalAmount += (parseFloat(it.price) || 0) * (it.quantity || 0); });
      const sale = allSales.find(s => s.id === editingSaleId);
      if (totalAmount === 0 && sale && parseFloat(sale.total_amount) > 0) totalAmount = parseFloat(sale.total_amount);
      const itemsText = itemsToSave.map(it => {
        const g = it.isGift ? ' (Ä°KRAM)' : '';
        return `${it.product_name} x${it.quantity}${g}`;
      }).join(', ');
      const itemsArray = itemsToSave.map(it => ({
        product_id: it.product_id || null,
        product_name: it.product_name,
        quantity: it.quantity,
        price: parseFloat(it.price) || 0,
        isGift: it.isGift || false,
        staff_id: it.staff_id || null,
        staff_name: it.staff_name || null
      }));
      const btn = document.getElementById('editSaleSaveBtn');
      if (btn) { btn.disabled = true; btn.textContent = 'Kaydediliyorâ€¦'; }
      try {
        const salesRef = db.collection('sales');
        await salesRef.doc(editingSaleId).update({
          payment_method: method,
          total_amount: totalAmount,
          items: itemsText,
          items_array: itemsArray
        });
        const idx = allSales.findIndex(s => s.id === editingSaleId);
        if (idx !== -1) {
          allSales[idx] = { ...allSales[idx], payment_method: method, total_amount: totalAmount, items: itemsToSave.map(i => ({ product_name: i.product_name, quantity: i.quantity, isGift: i.isGift })), items_array: itemsArray };
        }
        closeEditSaleModal();
        renderSales(allSales);
        updateStats(allSales);
      } catch (e) {
        console.error('SatÄ±ÅŸ gÃ¼ncellenirken hata:', e);
        if (btn) { btn.disabled = false; btn.textContent = 'Kaydet'; }
        alert('SatÄ±ÅŸ gÃ¼ncellenirken bir hata oluÅŸtu: ' + (e.message || e));
      }
      if (btn) { btn.disabled = false; btn.textContent = 'Kaydet'; }
    }

    // Aktif masa sayÄ±sÄ±nÄ± hesapla (sadece iÃ§ ve dÄ±ÅŸ masalar; Gece DÃ¶nercisi: salon + bahÃ§e)
    function calculateActiveTablesCount() {
      let activeCount = 0;
      
      Object.values(allStaticTables).forEach(table => {
        const tableId = table.table_id || '';
        const isTable =
          tableId.startsWith('masa-') ||
          tableId.startsWith('inside-') ||
          tableId.startsWith('outside-') ||
          (isGeceDonercisi && (tableId.startsWith('salon-') || tableId.startsWith('bahce-')));
        const isPackage = tableId.startsWith('paket-');
        
        if (isTable && !isPackage) {
          // Masa dolu mu kontrol et
          const isOccupied = table.is_occupied === true || 
                            table.is_occupied === 'true' || 
                            table.is_occupied === 1 ||
                            (table.status && (table.status === 'occupied' || table.status === 'dolu')) ||
                            (table.items && Array.isArray(table.items) && table.items.length > 0);
          
          if (isOccupied) {
            activeCount++;
          }
        }
      });
      
      return activeCount;
    }

    // Aktif masa sayÄ±sÄ±nÄ± gerÃ§ek zamanlÄ± dinle
    function startActiveTablesListener() {
      // Ä°lk hesaplama
      updateActiveTablesCount(calculateActiveTablesCount());
      
      // Not: Aktif masa sayÄ±sÄ± renderAllTables() ve Firebase listener'Ä±nda otomatik gÃ¼ncelleniyor
      // Burada sadece ilk hesaplamayÄ± yapÄ±yoruz
    }

    // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
    function updateActiveTablesCount(count) {
      const activeTablesValue = document.querySelector('.stat-card-pink .stat-value');
      if (activeTablesValue) {
        activeTablesValue.textContent = count;
      }
    }

    // Ä°statistikleri gÃ¼ncelle
    function updateStats(sales) {
      const today = getTodayDateString();
      // MasraflarÄ± hariÃ§ tut
      const todaySales = sales.filter(s => {
        const saleDate = s.sale_date || '';
        const matches = saleDate === today;
        return matches && !s.isExpense && s.payment_method !== 'Masraf';
      });
      // total_amount kullanarak hesaplama yap
      const todayRevenue = todaySales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      
      // Nakit, kart ve online tutarlarÄ±nÄ± hesapla
      // Ã–nce tÃ¼m Ã¶deme yÃ¶ntemlerini logla
      const paymentMethods = {};
      todaySales.forEach(s => {
        const method = s.payment_method || 'Bilinmeyen';
        if (!paymentMethods[method]) {
          paymentMethods[method] = [];
        }
        paymentMethods[method].push({
          sale_id: s.sale_id,
          amount: calculateSaleRevenue(s),
          order_source: s.order_source
        });
      });
      // Online sipariÅŸler: payment_method === 'Online' veya order_source === 'Trendyol' || 'Yemeksepeti' || 'Migros Yemek'
      const onlineSales = todaySales.filter(s => 
        s.payment_method === 'Online' || 
        s.order_source === 'Trendyol' || 
        s.order_source === 'Yemeksepeti' ||
        s.order_source === 'Migros Yemek' ||
        s.order_source === 'MigrosYemek' ||
        s.order_source === 'Migros'
      );
      
      // Nakit: payment_method === 'Nakit' ve online deÄŸil
      const cashSales = todaySales.filter(s => 
        s.payment_method === 'Nakit' && 
        !onlineSales.includes(s)
      );
      
      // Kart: Online deÄŸil, Nakit deÄŸil, Masraf deÄŸil, boÅŸ/undefined deÄŸil -> Kart olarak say
      const cardSales = todaySales.filter(s => {
        const paymentMethod = s.payment_method || '';
        return !onlineSales.includes(s) &&
          paymentMethod !== 'Nakit' &&
          paymentMethod !== 'Masraf' &&
          paymentMethod !== 'Online' &&
          paymentMethod !== '' &&
          !s.isExpense;
      });
      
      // total_amount kullanarak hesaplama yap
      const cashTotal = cashSales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      const cardTotal = cardSales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      const onlineTotal = onlineSales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      
      // GÃ¼nlÃ¼k masraflarÄ± hesapla
      const todayExpenses = sales.filter(s => 
        s.sale_date === today && 
        (s.isExpense || s.payment_method === 'Masraf')
      );
      const todayExpenseTotal = todayExpenses.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      
      const statsGrid = document.getElementById('statsGrid');
      if (!statsGrid) return;
      
      statsGrid.innerHTML = `
        <div class="stat-card-wrapper">
          <div class="stat-card stat-card-green">
            <div class="stat-icon">ğŸ’°</div>
            <div class="stat-content">
              <h3>GÃ¼nlÃ¼k Ciro</h3>
              <div class="stat-value">â‚º${todayRevenue.toFixed(2)}</div>
            </div>
          </div>
          <div class="payment-breakdown-card">
            <div class="payment-breakdown-item">
              <span class="payment-breakdown-label">ğŸ’µ Nakit:</span>
              <span class="payment-breakdown-value">â‚º${cashTotal.toFixed(2)}</span>
            </div>
            <div class="payment-breakdown-item">
              <span class="payment-breakdown-label">ğŸ’³ Kart:</span>
              <span class="payment-breakdown-value">â‚º${cardTotal.toFixed(2)}</span>
            </div>
            <div class="payment-breakdown-item">
              <span class="payment-breakdown-label">ğŸŒ Online:</span>
              <span class="payment-breakdown-value">â‚º${onlineTotal.toFixed(2)}</span>
            </div>
          </div>
        </div>
        <div class="stat-card stat-card-red">
          <div class="stat-icon">ğŸ’¸</div>
          <div class="stat-content">
            <h3>GÃ¼nlÃ¼k Masraf</h3>
            <div class="stat-value">â‚º${todayExpenseTotal.toFixed(2)}</div>
          </div>
        </div>
        <div class="stat-card stat-card-purple">
          <div class="stat-icon">ğŸ“Š</div>
          <div class="stat-content">
            <h3>BugÃ¼nkÃ¼ SatÄ±ÅŸ</h3>
            <div class="stat-value">${todaySales.length}</div>
          </div>
        </div>
        <div class="stat-card stat-card-pink">
          <div class="stat-icon">ğŸª‘</div>
          <div class="stat-content">
            <h3>Aktif Masa</h3>
            <div class="stat-value">0</div>
          </div>
        </div>
      `;

      // Aktif masa sayÄ±sÄ±nÄ± baÅŸlat
      startActiveTablesListener();
    }

    function showLoading(show) {
      const loader = document.getElementById('loader');
      if (loader) {
        loader.style.display = show ? 'flex' : 'none';
      }
    }

    // Aktif sekme deÄŸiÅŸtir
    function setActiveTab(tab) {
      activeTab = tab;
      renderCurrentView();
      updateTabButtons();
    }

    // Tab butonlarÄ±nÄ± gÃ¼ncelle
    function updateTabButtons() {
      const buttons = document.querySelectorAll('.tab-btn');
      buttons.forEach(btn => {
        if (btn.dataset.tab === activeTab) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    }

    // Mevcut gÃ¶rÃ¼nÃ¼mÃ¼ render et
    function renderCurrentView() {
      // EÄŸer masalar sekmesinden Ã§Ä±kÄ±lÄ±yorsa, listener'Ä± temizle
      if (activeTab !== 'tables' && tablesUnsubscribe) {
        tablesUnsubscribe();
        tablesUnsubscribe = null;
      }

      // Aktif masa listener'Ä±nÄ± her zaman Ã§alÄ±ÅŸtÄ±r (stats iÃ§in gerekli)
      if (!activeTablesUnsubscribe) {
        startActiveTablesListener();
      }

      // Container'larÄ± gÃ¶ster/gizle
      const salesContainer = document.getElementById('salesContainer');
      const reportsContainer = document.getElementById('reportsContainer');
      const staffContainer = document.getElementById('staffContainer');
      const tablesContainer = document.getElementById('tablesContainer');
      const cancelsContainer = document.getElementById('cancelsContainer');
      
      if (salesContainer) salesContainer.style.display = activeTab === 'sales' ? 'block' : 'none';
      if (reportsContainer) reportsContainer.style.display = activeTab === 'reports' ? 'block' : 'none';
      if (staffContainer) staffContainer.style.display = activeTab === 'staff' ? 'block' : 'none';
      if (tablesContainer) tablesContainer.style.display = activeTab === 'tables' ? 'block' : 'none';
      if (cancelsContainer) cancelsContainer.style.display = activeTab === 'cancels' ? 'block' : 'none';
      
      if (activeTab === 'sales') {
        renderSales(allSales);
        updateSalesDateFilterButton();
      } else if (activeTab === 'reports') {
        renderReports();
      } else if (activeTab === 'staff') {
        renderStaffDetails();
      } else if (activeTab === 'tables') {
        renderTables();
      } else if (activeTab === 'cancels') {
        renderCancels();
      }
    }

    // Tarih filtresine gÃ¶re satÄ±ÅŸlarÄ± filtrele
    function filterSalesByDate(sales) {
      const businessDay = getBusinessDayDate();
      const now = new Date();
      now.setHours(23, 59, 59, 999);
      
      if (reportDateFilter === 'yesterday') {
        const yesterday = new Date(businessDay);
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayStr = yesterday.toLocaleDateString('tr-TR');
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          return sale.sale_date === yesterdayStr;
        });
      } else if (reportDateFilter === 'week') {
        const weekAgo = new Date(businessDay);
        weekAgo.setDate(weekAgo.getDate() - 7);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          const weekAgoDate = new Date(weekAgo);
          weekAgoDate.setHours(0, 0, 0, 0);
          const todayDate = new Date(businessDay);
          todayDate.setHours(23, 59, 59, 999);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= weekAgoDate && saleDate <= todayDate;
        });
      } else if (reportDateFilter === 'month') {
        const monthAgo = new Date(businessDay);
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          const monthAgoDate = new Date(monthAgo);
          monthAgoDate.setHours(0, 0, 0, 0);
          const todayDate = new Date(businessDay);
          todayDate.setHours(23, 59, 59, 999);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= monthAgoDate && saleDate <= todayDate;
        });
      } else if (reportDateFilter === 'custom' && customDateRange.start && customDateRange.end) {
        const startDate = new Date(customDateRange.start);
        startDate.setHours(0, 0, 0, 0);
        const endDate = new Date(customDateRange.end);
        endDate.setHours(23, 59, 59, 999);
        
        return sales.filter(sale => {
          if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return false;
          const [day, month, year] = sale.sale_date.split('.');
          if (!day || !month || !year) return false;
          const saleDate = new Date(year, month - 1, day);
          saleDate.setHours(0, 0, 0, 0);
          return saleDate >= startDate && saleDate <= endDate;
        });
      }
      
      return sales; // 'all' iÃ§in tÃ¼m satÄ±ÅŸlar
    }

    // Tarih formatÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼r (YYYY-MM-DD -> DD.MM.YYYY)
    function formatDateForInput(date) {
      if (!date) return '';
      const d = new Date(date);
      const day = String(d.getDate()).padStart(2, '0');
      const month = String(d.getMonth() + 1).padStart(2, '0');
      const year = d.getFullYear();
      return `${year}-${month}-${day}`;
    }

    function getSelectedReportDateRange() {
      // Tarih aralÄ±ÄŸÄ±nÄ±, rapor filtresindeki mantÄ±kla birebir Ã§Ä±karÄ±r.
      const businessDay = getBusinessDayDate();

      if (reportDateFilter === 'all') return null;

      if (reportDateFilter === 'yesterday') {
        const yesterday = new Date(businessDay);
        yesterday.setDate(yesterday.getDate() - 1);
        const start = new Date(yesterday);
        start.setHours(0, 0, 0, 0);
        const end = new Date(yesterday);
        end.setHours(23, 59, 59, 999);
        return { start, end };
      }

      if (reportDateFilter === 'week') {
        const weekAgo = new Date(businessDay);
        weekAgo.setDate(weekAgo.getDate() - 7);
        const start = new Date(weekAgo);
        start.setHours(0, 0, 0, 0);
        const end = new Date(businessDay);
        end.setHours(23, 59, 59, 999);
        return { start, end };
      }

      if (reportDateFilter === 'month') {
        const monthAgo = new Date(businessDay);
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        const start = new Date(monthAgo);
        start.setHours(0, 0, 0, 0);
        const end = new Date(businessDay);
        end.setHours(23, 59, 59, 999);
        return { start, end };
      }

      if (reportDateFilter === 'custom' && customDateRange.start && customDateRange.end) {
        const start = new Date(customDateRange.start);
        start.setHours(0, 0, 0, 0);
        const end = new Date(customDateRange.end);
        end.setHours(23, 59, 59, 999);
        return { start, end };
      }

      return null;
    }

    function mgmtParseTrNumber(value) {
      if (value == null) return 0;
      const raw = String(value).replace(',', '.').trim();
      const num = Number(raw);
      return isNaN(num) ? 0 : num;
    }

    function mgmtParseTrDateToDate(dateStr) {
      // DD.MM.YYYY
      if (!dateStr) return null;
      const parts = String(dateStr).split('.');
      if (parts.length !== 3) return null;
      const [day, month, year] = parts;
      const d = new Date(Number(year), Number(month) - 1, Number(day));
      return isNaN(d.getTime()) ? null : d;
    }

    function getZahiyatDocDate(docData) {
      // Ã–ncelik: string tarih alanlarÄ±, sonra timestamp
      const d =
        mgmtParseTrDateToDate(docData?.date) ||
        mgmtParseTrDateToDate(docData?.sale_date) ||
        mgmtParseTrDateToDate(docData?.createdDate) ||
        mgmtParseTrDateToDate(docData?.created_date);
      if (d) return d;

      const ts = docData?.createdAt || docData?.created_at || docData?.updatedAt || docData?.updated_at;
      try {
        if (ts && typeof ts.toDate === 'function') return ts.toDate();
      } catch (e) {}

      return null;
    }

    function getZahiyatAmount(docData) {
      // Esnek: farklÄ± alan isimlerine toleranslÄ±.
      const quantity =
        docData?.quantity ??
        docData?.qty ??
        docData?.adet ??
        docData?.count ??
        1;
      const qNum = Math.max(1, Math.floor(mgmtParseTrNumber(quantity) || 1));

      const totalCandidates = [
        docData?.totalAmount,
        docData?.total_amount,
        docData?.total,
        docData?.amount,
        docData?.tutar
      ];

      for (const v of totalCandidates) {
        const n = mgmtParseTrNumber(v);
        if (n > 0) return n;
      }

      const priceCandidates = [
        docData?.price,
        docData?.fiyat,
        docData?.cost,
        docData?.maliyet
      ];
      for (const v of priceCandidates) {
        const n = mgmtParseTrNumber(v);
        if (n > 0) return n * qNum;
      }

      // items[] varsa topla
      if (Array.isArray(docData?.items) && docData.items.length > 0) {
        return docData.items.reduce((sum, it) => {
          const p = mgmtParseTrNumber(it?.price ?? it?.fiyat ?? it?.cost);
          const q = Math.max(1, Math.floor(mgmtParseTrNumber(it?.quantity ?? it?.adet ?? 1) || 1));
          return sum + (p * q);
        }, 0);
      }

      return 0;
    }

    async function fetchZahiyatSummaryForSelectedPeriod() {
      // Gece DÃ¶nercisi: gecedonercisimasalar / zahiyat koleksiyonundan okur.
      if (!geceMasalarDb) return { total: 0, count: 0, ok: false };

      const range = getSelectedReportDateRange();
      let total = 0;
      let count = 0;

      try {
        const snap = await geceMasalarDb.collection('zahiyat').get();
        if (snap && snap.forEach) {
          snap.forEach((doc) => {
            const data = doc.data() || {};
            const dt = getZahiyatDocDate(data);
            if (range && dt) {
              const d0 = new Date(dt);
              d0.setHours(0, 0, 0, 0);
              if (d0 < range.start || d0 > range.end) return;
            } else if (range && !dt) {
              // Tarih alanÄ± yoksa seÃ§ili aralÄ±kta sayma (yanlÄ±ÅŸ toplam olmasÄ±n)
              return;
            }

            const amount = getZahiyatAmount(data);
            if (amount && amount > 0) {
              total += amount;
              count += 1;
            }
          });
        }

        return { total, count, ok: true };
      } catch (e) {
        console.warn('Zahiyat okunamadÄ±:', e);
        return { total: 0, count: 0, ok: false };
      }
    }

    function ensureZahiyatModal() {
      if (document.getElementById('zahiyatModalOverlay')) return;

      const overlay = document.createElement('div');
      overlay.id = 'zahiyatModalOverlay';
      overlay.className = 'zahiyat-modal-overlay';
      overlay.onclick = (e) => {
        if (e.target === overlay) closeZahiyatModal();
      };

      overlay.innerHTML = `
        <div class="zahiyat-modal" role="dialog" aria-modal="true">
          <div class="zahiyat-modal-header">
            <div style="min-width: 0;">
              <h3 class="zahiyat-modal-title">Zahiyat DetaylarÄ±</h3>
              <p class="zahiyat-modal-subtitle" id="zahiyatModalSubtitle"></p>
            </div>
            <button type="button" class="zahiyat-modal-close" onclick="closeZahiyatModal()" title="Kapat">Ã—</button>
          </div>
          <div class="zahiyat-modal-body">
            <div class="zahiyat-modal-toolbar">
              <div class="zahiyat-modal-pill" id="zahiyatModalSummary">YÃ¼kleniyorâ€¦</div>
              <div class="zahiyat-modal-pill" id="zahiyatModalTotal">â‚º0,00</div>
            </div>
            <div id="zahiyatModalList" class="zahiyat-list"></div>
          </div>
        </div>
      `;

      document.body.appendChild(overlay);
    }

    function closeZahiyatModal() {
      const overlay = document.getElementById('zahiyatModalOverlay');
      if (overlay) overlay.style.display = 'none';
    }

    function closeExpenseDetailModal() {
      const overlay = document.getElementById('expenseDetailOverlay');
      if (overlay) overlay.style.display = 'none';
    }

    function openExpenseDetailModal() {
      const data = window._lastPeriodExpenseData;
      const overlay = document.getElementById('expenseDetailOverlay');
      const periodEl = document.getElementById('expenseDetailPeriodInfo');
      const bodyEl = document.getElementById('expenseDetailBody');
      const totalEl = document.getElementById('expenseDetailTotal');
      if (!overlay || !bodyEl || !totalEl) return;

      if (!data || !data.periodExpenses || !Array.isArray(data.periodExpenses)) {
        if (periodEl) periodEl.textContent = '';
        bodyEl.innerHTML = '<p style="color:#64748b;font-weight:600;">SeÃ§ilen zaman diliminde masraf kaydÄ± yok.</p>';
        totalEl.textContent = 'â‚º0.00';
        overlay.style.display = 'flex';
        overlay.style.alignItems = 'center';
        overlay.style.justifyContent = 'center';
        return;
      }

      const periodInfo = data.periodInfo || 'SeÃ§ilen zaman dilimi';
      if (periodEl) periodEl.textContent = periodInfo;

      var byTitle = {};
      data.periodExpenses.forEach(function(sale) {
        var title = (sale.items_array && sale.items_array[0] && sale.items_array[0].product_name)
          ? sale.items_array[0].product_name
          : (sale.itemsText || sale.items || 'Masraf');
        if (!byTitle[title]) byTitle[title] = { total: 0, items: [] };
        var amt = parseFloat(sale.total_amount || 0);
        byTitle[title].total += amt;
        byTitle[title].items.push({ amount: amt, date: sale.sale_date || '', time: sale.sale_time || '' });
      });

      var totalExpense = 0;
      var html = '';
      Object.keys(byTitle).sort().forEach(function(title) {
        var g = byTitle[title];
        totalExpense += g.total;
        html += '<div style="margin-bottom:20px;padding:16px;background:#f8fafc;border-radius:12px;border:1px solid #e2e8f0;">';
        html += '<div style="font-weight:800;font-size:15px;color:#0f172a;margin-bottom:8px;">' + (title.replace(/</g,'&lt;')) + '</div>';
        html += '<div style="font-size:13px;color:#64748b;margin-bottom:6px;">' + g.items.length + ' kayÄ±t â€¢ Toplam <span style="font-weight:700;color:#dc2626;">â‚º' + g.total.toFixed(2) + '</span></div>';
        html += '<ul style="margin:0;padding-left:18px;font-size:12px;color:#475569;">';
        g.items.forEach(function(it) {
          html += '<li>â‚º' + it.amount.toFixed(2) + (it.date ? ' â€¢ ' + it.date + (it.time ? ' ' + it.time : '') : '') + '</li>';
        });
        html += '</ul></div>';
      });
      bodyEl.innerHTML = html || '<p style="color:#64748b;">KayÄ±t yok.</p>';
      totalEl.textContent = 'â‚º' + totalExpense.toFixed(2);

      overlay.style.display = 'flex';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
    }

    function formatMoneyTR(amount) {
      const n = Number(amount || 0);
      return 'â‚º' + n.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    }

    function extractZahiyatPerson(data) {
      const v =
        data?.personel ||
        data?.personelName ||
        data?.staff ||
        data?.staff_name ||
        data?.staffName ||
        data?.employee ||
        data?.employeeName ||
        data?.user ||
        data?.userName;
      const s = (v != null) ? String(v).trim() : '';
      return s || 'Personel: Bilinmiyor';
    }

    function extractZahiyatProducts(data) {
      if (Array.isArray(data?.items) && data.items.length > 0) {
        return data.items
          .map((it) => {
            const name = String(it?.product || it?.product_name || it?.name || it?.urun || it?.urunAdi || '').trim() || 'ÃœrÃ¼n';
            const qty = Math.max(1, Math.floor(mgmtParseTrNumber(it?.quantity ?? it?.adet ?? it?.qty ?? 1) || 1));
            const price = mgmtParseTrNumber(it?.price ?? it?.fiyat ?? it?.cost ?? it?.maliyet);
            return { name, qty, price };
          })
          .filter(x => x && x.name);
      }

      const name = String(data?.product || data?.product_name || data?.productName || data?.urun || data?.urunAdi || '').trim();
      const qty = Math.max(1, Math.floor(mgmtParseTrNumber(data?.quantity ?? data?.adet ?? data?.qty ?? 1) || 1));
      const price = mgmtParseTrNumber(data?.price ?? data?.fiyat ?? data?.cost ?? data?.maliyet);
      if (name) return [{ name, qty, price }];
      return [];
    }

    async function openZahiyatModal() {
      ensureZahiyatModal();

      const overlay = document.getElementById('zahiyatModalOverlay');
      const subtitle = document.getElementById('zahiyatModalSubtitle');
      const summaryEl = document.getElementById('zahiyatModalSummary');
      const totalEl = document.getElementById('zahiyatModalTotal');
      const listEl = document.getElementById('zahiyatModalList');

      if (!overlay || !subtitle || !summaryEl || !totalEl || !listEl) return;

      overlay.style.display = 'flex';
      subtitle.textContent = (typeof periodInfo === 'string' && periodInfo) ? periodInfo : '';
      summaryEl.textContent = 'YÃ¼kleniyorâ€¦';
      totalEl.textContent = formatMoneyTR(0);
      listEl.innerHTML = '';

      if (!isGeceDonercisi || !geceMasalarDb) {
        summaryEl.textContent = 'Zahiyat kaynaÄŸÄ± hazÄ±r deÄŸil';
        listEl.innerHTML = `<div class="error-message"><div style="font-size:24px; margin-bottom:10px;">âš ï¸</div><div>Zahiyat veritabanÄ± baÄŸlantÄ±sÄ± bulunamadÄ±.</div></div>`;
        return;
      }

      try {
        const range = getSelectedReportDateRange();
        const snap = await geceMasalarDb.collection('zahiyat').get();

        const entries = [];
        let total = 0;

        if (snap && snap.forEach) {
          snap.forEach((doc) => {
            const data = doc.data() || {};
            const dt = getZahiyatDocDate(data);

            if (range && dt) {
              const d0 = new Date(dt);
              d0.setHours(0, 0, 0, 0);
              if (d0 < range.start || d0 > range.end) return;
            } else if (range && !dt) {
              return;
            }

            const amount = getZahiyatAmount(data);
            if (!amount || amount <= 0) return;

            const person = extractZahiyatPerson(data);
            const products = extractZahiyatProducts(data);

            const dtText = dt
              ? new Date(dt).toLocaleString('tr-TR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })
              : (data?.date || data?.sale_date || 'Tarih yok');

            entries.push({
              id: doc.id,
              person,
              dtText,
              products,
              amount
            });
            total += amount;
          });
        }

        entries.sort((a, b) => (b.dtText || '').localeCompare((a.dtText || ''), 'tr'));

        summaryEl.textContent = `${entries.length} kayÄ±t`;
        totalEl.textContent = formatMoneyTR(total);

        if (!entries.length) {
          listEl.innerHTML = `<div class="error-message"><div style="font-size:24px; margin-bottom:10px;">ğŸ”</div><div>Bu zaman diliminde zahiyat bulunamadÄ±</div></div>`;
          return;
        }

        listEl.innerHTML = entries.map((e) => {
          const products = (e.products || []).slice(0, 6);
          const productsHtml = products.length
            ? `
              <div class="zahiyat-products">
                ${products.map(p => {
                  const right = (p.price && p.price > 0) ? formatMoneyTR(p.price) : '';
                  return `
                    <div>
                      <div class="zahiyat-product-line">
                        <span>${p.qty} Ã— ${String(p.name).toUpperCase()}</span>
                        <span>${right}</span>
                      </div>
                    </div>
                  `;
                }).join('')}
                ${(e.products && e.products.length > products.length) ? `<div class="zahiyat-product-sub">+${e.products.length - products.length} Ã¼rÃ¼n dahaâ€¦</div>` : ''}
              </div>
            `
            : `<div class="zahiyat-products"><div class="zahiyat-product-sub">ÃœrÃ¼n detayÄ± yok</div></div>`;

          return `
            <div class="zahiyat-item-card">
              <div class="zahiyat-item-top">
                <div style="min-width:0;">
                  <div class="zahiyat-item-person">${e.person}</div>
                  <div class="zahiyat-item-meta">${e.dtText}</div>
                </div>
                <div class="zahiyat-item-amount">${formatMoneyTR(e.amount)}</div>
              </div>
              ${productsHtml}
            </div>
          `;
        }).join('');
      } catch (e) {
        console.error('Zahiyat modal yÃ¼kleme hatasÄ±:', e);
        summaryEl.textContent = 'Hata';
        listEl.innerHTML = `<div class="error-message"><div style="font-size:24px; margin-bottom:10px;">âŒ</div><div>Zahiyat verileri yÃ¼klenemedi</div><div style="font-size:12px; margin-top:8px; color:#9ca3af;">${(e && e.message) ? e.message : ''}</div></div>`;
      }
    }

    window.openZahiyatModal = openZahiyatModal;
    window.closeZahiyatModal = closeZahiyatModal;

    // Tarih formatÄ±nÄ± dÃ¶nÃ¼ÅŸtÃ¼r (DD.MM.YYYY -> YYYY-MM-DD)
    function parseDateFromInput(dateStr) {
      if (!dateStr) return null;
      const [year, month, day] = dateStr.split('-');
      return new Date(year, month - 1, day);
    }

    // Ã–zel tarih aralÄ±ÄŸÄ± seÃ§
    function setCustomDateRange() {
      const startInput = document.getElementById('customDateStart');
      const endInput = document.getElementById('customDateEnd');
      
      if (!startInput || !endInput) return;
      
      const start = startInput.value;
      const end = endInput.value;
      
      if (!start || !end) {
        alert('LÃ¼tfen baÅŸlangÄ±Ã§ ve bitiÅŸ tarihlerini seÃ§in');
        return;
      }
      
      const startDate = parseDateFromInput(start);
      const endDate = parseDateFromInput(end);
      
      if (startDate > endDate) {
        alert('BaÅŸlangÄ±Ã§ tarihi bitiÅŸ tarihinden sonra olamaz');
        return;
      }
      
      customDateRange.start = startDate;
      customDateRange.end = endDate;
      reportDateFilter = 'custom';
      renderReports();
      closeDateFilterModal();
    }

    // Tarih filtresini deÄŸiÅŸtir
    function setReportDateFilter(filter) {
      reportDateFilter = filter;
      renderReports();
    }

    // Tarih filtresi modal'Ä±nÄ± aÃ§/kapa
    function toggleDateFilterModal(event) {
      if (event) {
        event.stopPropagation();
      }
      const modal = document.getElementById('dateFilterModal');
      if (modal) {
        const isOpen = modal.classList.contains('show');
        // Ã–nce tÃ¼m modal'larÄ± kapat
        document.querySelectorAll('.date-filter-modal').forEach(m => m.classList.remove('show'));
        // Sonra bu modal'Ä± aÃ§/kapa
        if (!isOpen) {
          modal.classList.add('show');
        }
      }
    }

    // Tarih filtresi modal'Ä±nÄ± kapat
    function closeDateFilterModal() {
      const modal = document.getElementById('dateFilterModal');
      if (modal) {
        modal.classList.remove('show');
      }
    }

    // GÃ¼nlÃ¼k ciro detaylarÄ± modalÄ±nÄ± gÃ¶ster
    function showDailyRevenueModal() {
      const modal = document.getElementById('dailyRevenueModal');
      if (!modal) return;

      // SeÃ§ilen zaman dilimindeki satÄ±ÅŸlarÄ± al
      let reportSales = allSales.filter(sale => 
        !sale.isExpense && sale.payment_method !== 'Masraf'
      );
      reportSales = filterSalesByDate(reportSales);

      // GÃ¼nlere gÃ¶re grupla
      const dailyStats = {};
      let unknownDateStats = {
        date: 'Tarih Bilinmeyen',
        online: 0,
        card: 0,
        cash: 0,
        total: 0
      };
      
      // Toplam kontrolÃ¼ iÃ§in
      let modalTotal = 0;
      
      reportSales.forEach(sale => {
        const saleRevenue = parseFloat(sale.total_amount || 0);
        modalTotal += saleRevenue; // TÃ¼m satÄ±ÅŸlarÄ± topla
        const saleDate = sale.sale_date;
        
        // Ã–deme yÃ¶ntemine gÃ¶re daÄŸÄ±t
        const paymentMethod = sale.payment_method || '';
        const orderSource = sale.order_source || '';
        
        // Online: payment_method === 'Online' veya order_source === 'Trendyol' || 'Yemeksepeti' || 'Migros Yemek'
        const isOnline =
          paymentMethod === 'Online' ||
          orderSource === 'Trendyol' ||
          orderSource === 'Yemeksepeti' ||
          orderSource === 'Migros Yemek' ||
          orderSource === 'MigrosYemek' ||
          orderSource === 'Migros';
        // Nakit: payment_method === 'Nakit' ve online deÄŸil
        const isCash = !isOnline && paymentMethod === 'Nakit';
        // DiÄŸerleri: Kart (Online deÄŸil, Nakit deÄŸil, Masraf deÄŸil)
        const isCard = !isOnline && !isCash && paymentMethod !== 'Masraf' && !sale.isExpense;
        
        // Tarihi olmayan veya 'Bilinmeyen' olan satÄ±ÅŸlarÄ± ayrÄ± topla
        if (!saleDate || saleDate === 'Bilinmeyen') {
          unknownDateStats.total += saleRevenue;
          if (isOnline) unknownDateStats.online += saleRevenue;
          else if (isCash) unknownDateStats.cash += saleRevenue;
          else if (isCard) unknownDateStats.card += saleRevenue;
          return;
        }

        if (!dailyStats[saleDate]) {
          dailyStats[saleDate] = {
            date: saleDate,
            online: 0,
            card: 0,
            cash: 0,
            total: 0
          };
        }

        dailyStats[saleDate].total += saleRevenue;

        // Ã–deme yÃ¶ntemine gÃ¶re daÄŸÄ±t (yukarÄ±da tanÄ±mlanan deÄŸiÅŸkenleri kullan)
        if (isOnline) {
          dailyStats[saleDate].online += saleRevenue;
        } else if (isCash) {
          dailyStats[saleDate].cash += saleRevenue;
        } else if (isCard) {
          dailyStats[saleDate].card += saleRevenue;
        }
      });

      // Tarihe gÃ¶re sÄ±rala (en yeni en Ã¼stte)
      const sortedDays = Object.values(dailyStats).sort((a, b) => {
        const [dayA, monthA, yearA] = a.date.split('.');
        const [dayB, monthB, yearB] = b.date.split('.');
        const dateA = new Date(yearA, monthA - 1, dayA);
        const dateB = new Date(yearB, monthB - 1, dayB);
        return dateB - dateA;
      });
      
      // Tarihi olmayan satÄ±ÅŸlar varsa en alta ekle
      if (unknownDateStats.total > 0) {
        sortedDays.push(unknownDateStats);
      }
      
      // Toplam kontrolÃ¼: Modal'daki toplam ile ana karttaki toplamÄ± karÅŸÄ±laÅŸtÄ±r
      const mainCardTotal = reportSales.reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);

      // Modal iÃ§eriÄŸini oluÅŸtur
      const modalContent = document.getElementById('dailyRevenueModalContent');
      if (modalContent) {
        // SeÃ§ilen zaman dilimi bilgisi
        const businessDay = getBusinessDayDate();
        let periodTitle = 'GÃ¼nlÃ¼k Ciro DetaylarÄ±';
        if (reportDateFilter === 'yesterday') {
          periodTitle = 'DÃ¼n - GÃ¼nlÃ¼k Ciro DetaylarÄ±';
        } else if (reportDateFilter === 'week') {
          periodTitle = 'Son 1 Hafta - GÃ¼nlÃ¼k Ciro DetaylarÄ±';
        } else if (reportDateFilter === 'month') {
          periodTitle = 'Son 1 Ay - GÃ¼nlÃ¼k Ciro DetaylarÄ±';
        } else if (reportDateFilter === 'custom' && customDateRange.start && customDateRange.end) {
          periodTitle = 'Ã–zel Tarih AralÄ±ÄŸÄ± - GÃ¼nlÃ¼k Ciro DetaylarÄ±';
        } else if (reportDateFilter === 'all') {
          periodTitle = 'TÃ¼m Zamanlar - GÃ¼nlÃ¼k Ciro DetaylarÄ±';
        }
        
        modalContent.innerHTML = `
          <!-- ÅÄ±k Header ve Kapatma Butonu -->
          <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px 24px; border-radius: 0; position: sticky; top: 0; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div style="flex: 1;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 800; color: white; letter-spacing: -0.3px; margin-bottom: 4px;">ğŸ“Š ${periodTitle}</h2>
                <div style="font-size: 13px; color: rgba(255,255,255,0.9); font-weight: 500;">
                  Toplam: <span style="font-weight: 700; font-size: 15px;">â‚º${modalTotal.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</span> â€¢ ${sortedDays.length} gÃ¼n
                </div>
              </div>
              <button onclick="closeDailyRevenueModal()" style="
                background: rgba(255,255,255,0.2);
                border: 1px solid rgba(255,255,255,0.3);
                color: white;
                width: 44px;
                height: 44px;
                border-radius: 12px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                backdrop-filter: blur(10px);
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
              " onmouseover="this.style.background='rgba(255,255,255,0.3)'; this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)';" onmouseout="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='scale(1)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)';">
                <svg width="22" height="22" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M18 6L6 18M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
          
          <div style="padding: 16px; overflow-y: auto; max-height: calc(100vh - 180px); -webkit-overflow-scrolling: touch;">
            <div style="display: flex; flex-direction: column; gap: 8px;">
              ${sortedDays.length > 0 ? sortedDays.map(day => `
                <div style="background: #ffffff; border-radius: 8px; padding: 12px; border: 1px solid #e5e7eb; margin-bottom: 8px;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid #f3f4f6;">
                    <div style="font-size: 13px; font-weight: 700; color: ${day.date === 'Tarih Bilinmeyen' ? '#dc2626' : '#374151'};">${day.date}</div>
                    <div style="font-size: 15px; font-weight: 800; color: #059669;">â‚º${day.total.toFixed(2)}</div>
                  </div>
                  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px;">
                    <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 10px 8px; text-align: center;">
                      <div style="font-size: 9px; font-weight: 600; color: #64748b; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.3px;">Kart</div>
                      <div style="font-size: 13px; font-weight: 800; color: #1e293b;">â‚º${day.card.toFixed(2)}</div>
                    </div>
                    <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 10px 8px; text-align: center;">
                      <div style="font-size: 9px; font-weight: 600; color: #64748b; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.3px;">Nakit</div>
                      <div style="font-size: 13px; font-weight: 800; color: #1e293b;">â‚º${day.cash.toFixed(2)}</div>
                    </div>
                    <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 10px 8px; text-align: center;">
                      <div style="font-size: 9px; font-weight: 600; color: #64748b; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.3px;">Online</div>
                      <div style="font-size: 13px; font-weight: 800; color: #1e293b;">â‚º${day.online.toFixed(2)}</div>
                    </div>
                  </div>
                </div>
              `).join('') : `
                <div style="text-align: center; padding: 40px 20px; color: #64748b;">
                  <div style="font-size: 32px; margin-bottom: 12px;">ğŸ“Š</div>
                  <div style="font-size: 14px; font-weight: 600;">Bu zaman diliminde satÄ±ÅŸ bulunamadÄ±</div>
                </div>
              `}
            </div>
          </div>
          
          <!-- Alt Kapatma Butonu (Mobil iÃ§in) -->
          <div style="padding: 16px 24px; background: #f9fafb; border-top: 1px solid #e5e7eb; position: sticky; bottom: 0; z-index: 10;">
            <button onclick="closeDailyRevenueModal()" style="
              width: 100%;
              background: linear-gradient(135deg, #10b981 0%, #059669 100%);
              border: none;
              color: white;
              padding: 14px 24px;
              border-radius: 12px;
              font-size: 15px;
              font-weight: 700;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
              box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(16, 185, 129, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)';">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 18L18 6M6 6l12 12"/>
              </svg>
              <span>Kapat</span>
            </button>
            ${Math.abs(modalTotal - mainCardTotal) > 0.01 ? `
              <div style="margin-top: 12px; padding: 10px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
                <div style="font-size: 11px; color: #991b1b; font-weight: 600; text-align: center;">âš ï¸ TutarsÄ±zlÄ±k: â‚º${Math.abs(modalTotal - mainCardTotal).toFixed(2)}</div>
              </div>
            ` : ''}
          </div>
        `;
      }

      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    // GÃ¼nlÃ¼k ciro detaylarÄ± modalÄ±nÄ± kapat
    function closeDailyRevenueModal() {
      const modal = document.getElementById('dailyRevenueModal');
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
      }
    }

    // Masalar detaylÄ± rapor tablosunu oluÅŸtur
    function generateTablesReportHTML(reportSales, insideTablesCount, outsideTablesCount) {
      // Masalara gÃ¶re satÄ±ÅŸ istatistiklerini hesapla
      const tableStats = {};
      
      // TÃ¼m masalarÄ± al (iÃ§ ve dÄ±ÅŸ masalar, paketler hariÃ§)
      if (isLacromisa) {
        for (let i = 1; i <= insideTablesCount; i++) {
          const tableId = 'inside-' + i;
          const tableName = 'Ä°Ã§eri ' + i;
          tableStats[tableId] = { tableName, tableNumber: i, totalSales: 0, totalRevenue: 0, products: {} };
        }
        for (let i = 1; i <= outsideTablesCount; i++) {
          const tableId = 'outside-' + i;
          const tableName = 'DÄ±ÅŸarÄ± ' + i;
          tableStats[tableId] = { tableName, tableNumber: i, totalSales: 0, totalRevenue: 0, products: {} };
        }
      } else {
        for (let i = 1; i <= (insideTablesCount + outsideTablesCount); i++) {
          const tableId = 'masa-' + i;
          const tableName = 'Masa ' + i;
          tableStats[tableId] = { tableName, tableNumber: i, totalSales: 0, totalRevenue: 0, products: {} };
        }
      }
      
      console.log('ğŸ“Š [generateTablesReportHTML] Toplam satÄ±ÅŸ sayÄ±sÄ±:', reportSales.length);
      console.log('ğŸ“Š [generateTablesReportHTML] Masa sayÄ±sÄ±:', insideTablesCount + outsideTablesCount);
      
      // SatÄ±ÅŸ verilerini masalara gÃ¶re grupla
      reportSales.forEach(sale => {
        const tableName = sale.table_name;
        const tableId = sale.table_id;
        const tableType = sale.table_type;
        
        // Debug: Ä°lk birkaÃ§ satÄ±ÅŸÄ± logla
        if (reportSales.indexOf(sale) < 3) {
          console.log('ğŸ“Š [generateTablesReportHTML] SatÄ±ÅŸ Ã¶rneÄŸi:', {
            sale_id: sale.sale_id,
            table_name: tableName,
            table_id: tableId,
            table_type: tableType,
            total_amount: sale.total_amount
          });
        }
        
        // Masa adÄ± veya ID'sine gÃ¶re eÅŸleÅŸtir
        let matchedTable = null;
        
        // Ã–nce table_id kontrolÃ¼
        if (tableId) {
          if (tableId.startsWith('inside-') || tableId.startsWith('outside-')) {
            matchedTable = tableId;
          } else if (tableId.startsWith('masa-')) {
            matchedTable = tableId;
          } else if (tableId.startsWith('Masa')) {
            // "Masa 1" formatÄ±ndan numara Ã§Ä±kar
            const match = tableId.match(/Masa\s*(\d+)/i);
            if (match) {
              matchedTable = 'masa-' + match[1];
            }
          } else if (tableId.toLowerCase().startsWith('iÃ§eri') || tableId.toLowerCase().startsWith('iceri')) {
            const match = tableId.match(/(?:iÃ§eri|iceri)\s*-?\s*(\d+)/i);
            if (match) matchedTable = 'inside-' + match[1];
          } else if (tableId.toLowerCase().startsWith('dÄ±ÅŸarÄ±') || tableId.toLowerCase().startsWith('disari')) {
            const match = tableId.match(/(?:dÄ±ÅŸarÄ±|disari)\s*-?\s*(\d+)/i);
            if (match) matchedTable = 'outside-' + match[1];
          }
        }
        
        // table_id yoksa table_name kontrolÃ¼
        if (!matchedTable && tableName) {
          // "Masa 1", "Masa1", "masa-1" gibi formatlarÄ± kontrol et
          const matchMasa = tableName.match(/(?:masa|Masa)[\s-]*(\d+)/i);
          if (matchMasa) {
            matchedTable = 'masa-' + matchMasa[1];
          }
          if (!matchedTable) {
            const matchInside = tableName.match(/(?:iÃ§eri|iceri)[\s-]*(\d+)/i);
            if (matchInside) matchedTable = 'inside-' + matchInside[1];
          }
          if (!matchedTable) {
            const matchOutside = tableName.match(/(?:dÄ±ÅŸarÄ±|disari)[\s-]*(\d+)/i);
            if (matchOutside) matchedTable = 'outside-' + matchOutside[1];
          }
        }
        
        // table_type kontrolÃ¼ (eÄŸer 'table' ise ve numara varsa)
        if (!matchedTable && tableType === 'table' && tableName) {
          const match = tableName.match(/(\d+)/);
          if (match) {
            matchedTable = 'masa-' + match[1];
          }
        }
        
        if (matchedTable && tableStats[matchedTable]) {
          tableStats[matchedTable].totalSales++;
          tableStats[matchedTable].totalRevenue += parseFloat(sale.total_amount || 0);
          
          // ÃœrÃ¼nleri say
          const items = sale.items_array || sale.items || [];
          if (Array.isArray(items)) {
            items.forEach(item => {
              if (item && item.product_name && !item.isExpense) {
                const productName = item.product_name;
                if (!tableStats[matchedTable].products[productName]) {
                  tableStats[matchedTable].products[productName] = 0;
                }
                tableStats[matchedTable].products[productName] += (item.quantity || 1);
              }
            });
          }
        } else if (tableName || tableId) {
          // EÅŸleÅŸmeyen masa bilgilerini logla
          console.log('âš ï¸ [generateTablesReportHTML] EÅŸleÅŸmeyen masa:', {
            table_name: tableName,
            table_id: tableId,
            table_type: tableType
          });
        }
      });
      
      console.log('ğŸ“Š [generateTablesReportHTML] Masa istatistikleri:', Object.keys(tableStats).map(id => ({
        id: id,
        name: tableStats[id].tableName,
        sales: tableStats[id].totalSales,
        revenue: tableStats[id].totalRevenue
      })));
      
      // En Ã§ok sipariÅŸ verilen Ã¼rÃ¼nÃ¼ bul
      Object.keys(tableStats).forEach(tableId => {
        const products = tableStats[tableId].products;
        const entries = Object.entries(products);
        if (entries.length > 0) {
          entries.sort(([, a], [, b]) => b - a);
          tableStats[tableId].topProduct = entries[0][0];
          tableStats[tableId].topProductCount = entries[0][1];
        } else {
          tableStats[tableId].topProduct = '-';
          tableStats[tableId].topProductCount = 0;
        }
      });
      
      // MasalarÄ± sÄ±rala (ciroya gÃ¶re)
      const tableEntries = Object.entries(tableStats)
        .sort(([, a], [, b]) => b.totalRevenue - a.totalRevenue)
        .filter(([, stats]) => stats.totalSales > 0); // Sadece satÄ±ÅŸ yapÄ±lan masalar
      
      const totalTableRevenue = tableEntries.reduce((sum, [, stats]) => sum + stats.totalRevenue, 0);
      const totalTableSales = tableEntries.reduce((sum, [, stats]) => sum + stats.totalSales, 0);
      
      if (tableEntries.length === 0) {
        return `
          <div style="text-align: center; padding: 60px 20px; color: #9ca3af;">
            <div style="font-size: 64px; margin-bottom: 16px; opacity: 0.5;">ğŸª‘</div>
            <div style="font-weight: 700; font-size: 16px; color: #6b7280; margin-bottom: 6px;">HenÃ¼z masa satÄ±ÅŸÄ± yok</div>
            <div style="font-size: 13px; color: #9ca3af;">Masalardan satÄ±ÅŸ yapÄ±ldÄ±kÃ§a burada gÃ¶rÃ¼necek</div>
          </div>
        `;
      }
      
      let rowsHTML = '';
      tableEntries.forEach(([tableId, stats], index) => {
        const isTop3 = index < 3;
        const rowBg = index % 2 === 0 ? '#ffffff' : '#f8fafc';
        const rankColor = index === 0 ? '#fbbf24' : index === 1 ? '#94a3b8' : index === 2 ? '#f97316' : 'transparent';
        const revenueFull = 'â‚º' + stats.totalRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        const topProductDisplay = stats.topProduct !== '-' ? stats.topProduct + ' (' + stats.topProductCount + 'x)' : '-';
        
        rowsHTML += `
          <div style="background: ${rowBg}; border-bottom: 1px solid #e5e7eb; padding: 10px 12px; display: grid; grid-template-columns: 38px minmax(0, 1fr) 55px 90px 1fr; gap: 6px; align-items: center; transition: all 0.2s; ${isTop3 ? 'border-left: 2px solid ' + rankColor + ';' : ''}" 
               onmouseover="this.style.background='#f1f5f9';" 
               onmouseout="this.style.background='${rowBg}';">
            <!-- SÄ±ra No -->
            <div style="text-align: center; flex-shrink: 0;">
              ${isTop3 ? `
                <div style="width: 24px; height: 24px; border-radius: 5px; background: linear-gradient(135deg, ${rankColor} 0%, ${rankColor}dd 100%); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 11px; color: white; margin: 0 auto; box-shadow: 0 1px 4px ${rankColor}40;">
                  ${index + 1}
                </div>
              ` : `
                <div style="font-size: 11px; font-weight: 700; color: #64748b;">${index + 1}</div>
              `}
            </div>
            
            <!-- Masa AdÄ± -->
            <div style="min-width: 0; overflow: hidden; word-break: break-word;">
              <div style="font-size: 12px; font-weight: 700; color: #1e293b; line-height: 1.3;">${stats.tableName}</div>
            </div>
            
            <!-- SatÄ±ÅŸ SayÄ±sÄ± -->
            <div style="text-align: right; flex-shrink: 0;">
              <div style="font-size: 11px; font-weight: 700; color: #475569;">${stats.totalSales}</div>
            </div>
            
            <!-- Ciro -->
            <div style="text-align: right; flex-shrink: 0; min-width: 0;">
              <div style="font-size: 11px; font-weight: 800; color: #10b981; letter-spacing: -0.3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${revenueFull}">${revenueFull}</div>
            </div>
            
            <!-- En Ã‡ok SipariÅŸ -->
            <div style="min-width: 0; overflow: hidden; word-break: break-word;">
              <div style="font-size: 11px; font-weight: 600; color: #64748b; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;" title="${topProductDisplay}">${topProductDisplay}</div>
            </div>
          </div>
        `;
      });
      
      return `
        <div style="width: 100%; border-collapse: collapse;">
          <!-- Tablo BaÅŸlÄ±ÄŸÄ± - Sabit -->
          <div style="position: sticky; top: 0; z-index: 10; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-bottom: 2px solid #e2e8f0; padding: 10px 12px; display: grid; grid-template-columns: 38px minmax(0, 1fr) 55px 90px 1fr; gap: 6px; align-items: center;">
            <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; text-align: center;">#</div>
            <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; min-width: 0;">Masa</div>
            <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; text-align: right;">SatÄ±ÅŸ</div>
            <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; text-align: right;">Ciro</div>
            <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; min-width: 0;">En Ã‡ok SipariÅŸ</div>
          </div>
          
          <!-- Tablo SatÄ±rlarÄ± -->
          <div style="display: flex; flex-direction: column;">
            ${rowsHTML}
          </div>
          
          <!-- Toplam Ã–zet - Alt Sabit -->
          <div style="position: sticky; bottom: 0; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 12px; border-top: 2px solid #475569; display: grid; grid-template-columns: minmax(0, 1fr) 55px 90px 1fr; gap: 6px; align-items: center;">
            <div style="font-size: 11px; font-weight: 800; color: #f1f5f9; text-transform: uppercase; letter-spacing: 0.3px; min-width: 0;">Toplam (${tableEntries.length} masa)</div>
            <div style="text-align: right;">
              <div style="font-size: 12px; font-weight: 800; color: #f1f5f9;">${totalTableSales}</div>
            </div>
            <div style="text-align: right; min-width: 0;">
              <div style="font-size: 12px; font-weight: 900; color: #10b981; letter-spacing: -0.3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">â‚º${totalTableRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</div>
            </div>
            <div style="min-width: 0;">
              <div style="font-size: 11px; font-weight: 600; color: #f1f5f9; opacity: 0.8;">-</div>
            </div>
          </div>
        </div>
      `;
    }

    // SatÄ±ÅŸ cirosunu hesapla - HER ZAMAN total_amount kullan (SatÄ±ÅŸ GeÃ§miÅŸi ile tutarlÄ±)
    function calculateSaleRevenue(sale) {
      return parseFloat(sale.total_amount || 0);
    }

    // GÃ¼nlÃ¼k cirolarÄ± Firebase'de kaydet
    async function saveDailyRevenue(dateStr) {
      if (!db) return;
      
      try {
        // O gÃ¼ne ait tÃ¼m satÄ±ÅŸlarÄ± filtrele
        const daySales = allSales.filter(sale => 
          sale.sale_date === dateStr && 
          !sale.isExpense && 
          sale.payment_method !== 'Masraf'
        );
        
        // GÃ¼nlÃ¼k ciroyu hesapla
        const totalRevenue = daySales.reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);
        
        // Ã–deme yÃ¶ntemlerine gÃ¶re daÄŸÄ±t
        const onlineSales = daySales.filter(s => 
          s.payment_method === 'Online' || 
          s.order_source === 'Trendyol' || 
          s.order_source === 'Yemeksepeti' ||
          s.order_source === 'Migros Yemek' ||
          s.order_source === 'MigrosYemek' ||
          s.order_source === 'Migros'
        );
        const cashSales = daySales.filter(s => 
          s.payment_method === 'Nakit' && 
          !onlineSales.includes(s)
        );
        const cardSales = daySales.filter(s => {
          const paymentMethod = s.payment_method || '';
          return !onlineSales.includes(s) &&
            paymentMethod !== 'Nakit' &&
            paymentMethod !== 'Masraf' &&
            paymentMethod !== 'Online' &&
            paymentMethod !== '' &&
            !s.isExpense;
        });
        
        const cashTotal = cashSales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
        const cardTotal = cardSales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
        const onlineTotal = onlineSales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
        
        // Firebase'de kaydet
        const dailyRevenuesRef = db.collection('daily_revenues');
        await dailyRevenuesRef.doc(dateStr).set({
          date: dateStr,
          total_revenue: totalRevenue,
          cash_revenue: cashTotal,
          card_revenue: cardTotal,
          online_revenue: onlineTotal,
          sales_count: daySales.length,
          updated_at: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        
      } catch (error) {
        // GÃ¼nlÃ¼k ciro kaydetme hatasÄ± - sessizce devam et
      }
    }

    // GÃ¼nlÃ¼k cirolarÄ± otomatik kaydet (her satÄ±ÅŸ sonrasÄ± veya gÃ¼n sonu)
    async function autoSaveDailyRevenue() {
      const today = getTodayDateString();
      await saveDailyRevenue(today);
      
      // DÃ¼nkÃ¼ ciroyu da kaydet (gÃ¼n sonu iÃ§in)
      const yesterday = new Date(getBusinessDayDate());
      yesterday.setDate(yesterday.getDate() - 1);
      const yesterdayStr = yesterday.toLocaleDateString('tr-TR');
      await saveDailyRevenue(yesterdayStr);
    }

    // DetaylÄ± Raporlama render et
    async function renderReports() {
      const container = document.getElementById('reportsContainer');
      if (!container) return;

      // Modal'Ä± ekle (eÄŸer yoksa)
      addDailyRevenueModal();
      // MasraflarÄ± filtrele
      let reportSales = allSales.filter(sale => 
        !sale.isExpense && sale.payment_method !== 'Masraf'
      );
      
      reportSales = filterSalesByDate(reportSales);

      if (reportSales.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ“Š</div>
            <h3>HenÃ¼z veri yok</h3>
            <p>SatÄ±ÅŸ yapÄ±ldÄ±kÃ§a raporlar oluÅŸturulacak</p>
          </div>
        `;
        return;
      }

      // ÃœrÃ¼n istatistiklerini hesapla - Firebase'den gelen gerÃ§ek satÄ±ÅŸ detaylarÄ±nÄ± kullan
      const productStats = {};
      
      reportSales.forEach(sale => {
        let itemsArray = [];
        
        if (sale.items_array && Array.isArray(sale.items_array)) {
          // Masraf itemlarÄ±nÄ± filtrele
          itemsArray = sale.items_array.filter(item => !item.isExpense);
        } else if (sale.items) {
          const items = sale.items.split(', ');
          itemsArray = items.map(item => {
            const match = item.match(/(.+) x(\d+)/);
            if (match) {
              const [, productName, quantity] = match;
              const isGift = item.includes('(Ä°KRAM)');
              return {
                product_name: productName.replace(' (Ä°KRAM)', ''),
                quantity: parseInt(quantity),
                price: 0,
                isGift: isGift
              };
            }
            return null;
          }).filter(Boolean);
        }
        
        itemsArray.forEach(item => {
          if (!item || !item.product_name || item.isExpense) return;
          
          const productName = item.product_name;
          const quantity = item.quantity || 1;
          const isGift = item.isGift || false;
          
          if (!productStats[productName]) {
            productStats[productName] = { 
              count: 0, 
              revenue: 0,
              price: item.price || 0
            };
          }
          
          productStats[productName].count += quantity;
          
          if (!isGift && item.price) {
            productStats[productName].revenue += item.price * quantity;
            if (productStats[productName].price === 0) {
              productStats[productName].price = item.price;
            }
          } else if (!isGift && !item.price && sale.total_amount) {
            const saleTotal = parseFloat(sale.total_amount);
            const nonGiftItems = itemsArray.filter(i => !i.isGift);
            const totalNonGiftQuantity = nonGiftItems.reduce((sum, i) => sum + (i.quantity || 1), 0);
            
            if (totalNonGiftQuantity > 0) {
              productStats[productName].revenue += (saleTotal / totalNonGiftQuantity) * quantity;
            }
          }
        });
      });

      const productEntries = Object.entries(productStats);
      
      // Debug: ÃœrÃ¼n adlarÄ±nÄ± kontrol et
      console.log('ğŸ“Š [renderReports] Toplam Ã¼rÃ¼n sayÄ±sÄ±:', productEntries.length);
      console.log('ğŸ“Š [renderReports] Ä°lk 5 Ã¼rÃ¼n:', productEntries.slice(0, 5).map(([name, stats]) => ({
        name: name,
        nameLength: name ? name.length : 0,
        count: stats.count,
        revenue: stats.revenue
      })));
      
      const topProductsByCount = [...productEntries]
        .sort(([, a], [, b]) => b.count - a.count)
        .slice(0, 2);
      const bottomProductsByCount = [...productEntries]
        .sort(([, a], [, b]) => a.count - b.count)
        .slice(0, 2);
      const topProductsByRevenue = [...productEntries]
        .sort(([, a], [, b]) => b.revenue - a.revenue)
        .slice(0, 2);
      const bottomProductsByRevenue = [...productEntries]
        .sort(([, a], [, b]) => a.revenue - b.revenue)
        .slice(0, 2);

      const paymentMethods = {};
      reportSales.forEach(sale => {
        if (!paymentMethods[sale.payment_method]) {
          paymentMethods[sale.payment_method] = { count: 0, total: 0 };
        }
        paymentMethods[sale.payment_method].count++;
        // total_amount kullanarak hesaplama yap
        paymentMethods[sale.payment_method].total += parseFloat(sale.total_amount || 0);
      });

      // Toplam ciroyu hesapla - GÃ¼nlÃ¼k cirolarÄ± Firebase'den yÃ¼kle ve topla
      let totalRevenue = 0;
      
      // EÄŸer seÃ§ilen zaman dilimi 'all' deÄŸilse, gÃ¼nlÃ¼k cirolarÄ± Firebase'den yÃ¼kle ve topla
      if (reportDateFilter !== 'all' && db) {
        try {
          const dailyRevenuesRef = db.collection('daily_revenues');
          let startDate, endDate;
          const businessDay = getBusinessDayDate();
          
          if (reportDateFilter === 'yesterday') {
            const yesterday = new Date(businessDay);
            yesterday.setDate(yesterday.getDate() - 1);
            startDate = yesterday.toLocaleDateString('tr-TR');
            endDate = yesterday.toLocaleDateString('tr-TR');
          } else if (reportDateFilter === 'week') {
            const weekAgo = new Date(businessDay);
            weekAgo.setDate(weekAgo.getDate() - 7);
            startDate = weekAgo.toLocaleDateString('tr-TR');
            endDate = businessDay.toLocaleDateString('tr-TR');
          } else if (reportDateFilter === 'month') {
            const monthAgo = new Date(businessDay);
            monthAgo.setMonth(monthAgo.getMonth() - 1);
            startDate = monthAgo.toLocaleDateString('tr-TR');
            endDate = businessDay.toLocaleDateString('tr-TR');
          } else if (reportDateFilter === 'custom' && customDateRange.start && customDateRange.end) {
            startDate = customDateRange.start.toLocaleDateString('tr-TR');
            endDate = customDateRange.end.toLocaleDateString('tr-TR');
          }
          
          if (startDate && endDate) {
            // Tarih aralÄ±ÄŸÄ±ndaki gÃ¼nlÃ¼k cirolarÄ± yÃ¼kle
            const [startDay, startMonth, startYear] = startDate.split('.');
            const [endDay, endMonth, endYear] = endDate.split('.');
            const startDateObj = new Date(startYear, startMonth - 1, startDay);
            const endDateObj = new Date(endYear, endMonth - 1, endDay);
            
            // TÃ¼m gÃ¼nleri dÃ¶ngÃ¼ye al ve gÃ¼nlÃ¼k cirolarÄ± topla
            const currentDate = new Date(startDateObj);
            while (currentDate <= endDateObj) {
              const dateStr = currentDate.toLocaleDateString('tr-TR');
              const dailyRevenueDoc = await dailyRevenuesRef.doc(dateStr).get();
              
              if (dailyRevenueDoc.exists) {
                const data = dailyRevenueDoc.data();
                totalRevenue += parseFloat(data.total_revenue || 0);
              }
              
              currentDate.setDate(currentDate.getDate() + 1);
            }
            
          }
        } catch (error) {
          // GÃ¼nlÃ¼k cirolar yÃ¼klenemedi, satÄ±ÅŸlardan hesapla
          // Fallback: SatÄ±ÅŸlardan hesapla
          totalRevenue = reportSales.reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);
        }
      } else {
        // 'all' veya Firebase yoksa, satÄ±ÅŸlardan hesapla
        totalRevenue = reportSales.reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);
      }

      // Trendyol / Yemeksepeti / Migros Yemek cirolarÄ±nÄ± hesapla (total_amount'tan)
      const trendyolRevenue = reportSales
        .filter(sale => sale.order_source === 'Trendyol')
        .reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);
      
      const yemeksepetiRevenue = reportSales
        .filter(sale => sale.order_source === 'Yemeksepeti')
        .reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);

      const migrosYemekRevenue = reportSales
        .filter(sale => {
          const src = String(sale.order_source || '')
            .toLocaleLowerCase('tr-TR')
            .replace(/\s+/g, ' ')
            .trim();
          return src === 'migros yemek' || src === 'migrosyemek' || src === 'migros';
        })
        .reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);

      // GÃ¶rsellerin path'lerini dinamik olarak oluÅŸtur
      // Firebase Hosting veya localhost iÃ§in doÄŸru path'i oluÅŸtur
      let baseUrl = '';
      if (window.location.protocol === 'file:') {
        // File protokolÃ¼ iÃ§in relative path kullan
        baseUrl = '.';
      } else {
        baseUrl = window.location.origin || '';
      }
      const trendyolImageUrl = baseUrl + '/trendyol.webp';
      const yemeksepetiImageUrl = baseUrl + '/yemeksepeti.png';
      const migrosImageUrl = baseUrl + '/migros.png';

      // SeÃ§ilen zaman dilimindeki masraflarÄ± hesapla
      let periodExpenses = allSales.filter(sale => 
        (sale.isExpense || sale.payment_method === 'Masraf')
      );
      periodExpenses = filterSalesByDate(periodExpenses);
      const totalExpense = periodExpenses.reduce((sum, sale) => sum + parseFloat(sale.total_amount || 0), 0);

      // SeÃ§ilen zaman dilimi zahiyatÄ± (Gece DÃ¶nercisi - gecedonercisimasalar)
      let zahiyatTotal = 0;
      let zahiyatCount = 0;
      if (isGeceDonercisi && geceMasalarDb) {
        const z = await fetchZahiyatSummaryForSelectedPeriod();
        zahiyatTotal = z.total || 0;
        zahiyatCount = z.count || 0;
      }

      const filterLabels = {
        'all': 'TÃ¼m Zamanlar',
        'yesterday': 'DÃ¼n',
        'week': 'Son 1 Hafta',
        'month': 'Son 1 Ay',
        'custom': customDateRange.start && customDateRange.end 
          ? `${customDateRange.start.toLocaleDateString('tr-TR')} - ${customDateRange.end.toLocaleDateString('tr-TR')}`
          : 'Ã–zel Tarih AralÄ±ÄŸÄ±'
      };

      // SeÃ§ilen zaman dilimi bilgisi (gece 03:00'a gÃ¶re)
      let periodInfo = '';
      const businessDay = getBusinessDayDate();
      if (reportDateFilter === 'yesterday') {
        periodInfo = getYesterdayDateString();
      } else if (reportDateFilter === 'week') {
        const weekAgo = new Date(businessDay);
        weekAgo.setDate(weekAgo.getDate() - 7);
        periodInfo = `${weekAgo.toLocaleDateString('tr-TR')} - ${businessDay.toLocaleDateString('tr-TR')}`;
      } else if (reportDateFilter === 'month') {
        const monthAgo = new Date(businessDay);
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        periodInfo = `${monthAgo.toLocaleDateString('tr-TR')} - ${businessDay.toLocaleDateString('tr-TR')}`;
      } else if (reportDateFilter === 'custom' && customDateRange.start && customDateRange.end) {
        periodInfo = `${customDateRange.start.toLocaleDateString('tr-TR')} - ${customDateRange.end.toLocaleDateString('tr-TR')}`;
      } else {
        periodInfo = 'TÃ¼m Zamanlar';
      }
      window._lastPeriodExpenseData = { periodExpenses, periodInfo };

      let html = `
        <div class="reports-container">
          <div class="reports-header">
            <div>
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 4px; flex-wrap: nowrap;">
                <h2 class="reports-title" style="white-space: nowrap;">ğŸ“Š DetaylÄ± Raporlama</h2>
                <button class="analyze-btn" onclick="showAnalysisModal()" style="flex-shrink: 0;">
                  <span>ğŸ”</span>
                  <span>Analiz Et</span>
                </button>
              </div>
              <p class="reports-subtitle">KapsamlÄ± satÄ±ÅŸ analizi ve istatistikler</p>
            </div>
            <div class="date-filter-wrapper">
              <button class="date-filter-trigger" onclick="toggleDateFilterModal(event)">
                <span>ğŸ“…</span>
                <span>${filterLabels[reportDateFilter] || 'Tarih SeÃ§'}</span>
                <span class="date-filter-arrow">â–¼</span>
              </button>
              <div id="dateFilterModal" class="date-filter-modal">
                <div class="date-filter-modal-content">
                  <div class="date-filter-option ${reportDateFilter === 'yesterday' ? 'active' : ''}" onclick="setReportDateFilter('yesterday'); closeDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“†</span>
                    <span>DÃ¼n</span>
                  </div>
                  <div class="date-filter-option ${reportDateFilter === 'week' ? 'active' : ''}" onclick="setReportDateFilter('week'); closeDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“†</span>
                    <span>Son 1 Hafta</span>
                  </div>
                  <div class="date-filter-option ${reportDateFilter === 'month' ? 'active' : ''}" onclick="setReportDateFilter('month'); closeDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“…</span>
                    <span>Son 1 Ay</span>
                  </div>
                  <div class="date-filter-option ${reportDateFilter === 'all' ? 'active' : ''}" onclick="setReportDateFilter('all'); closeDateFilterModal();">
                    <span class="date-filter-icon">ğŸ“Š</span>
                    <span>TÃ¼m Zamanlar</span>
                  </div>
                  <div class="date-filter-divider"></div>
                  <div class="date-filter-option ${reportDateFilter === 'custom' ? 'active' : ''}" onclick="document.getElementById('customDateRangeSection').style.display = 'block';">
                    <span class="date-filter-icon">ğŸ—“ï¸</span>
                    <span>Ã–zel Tarih AralÄ±ÄŸÄ±</span>
                  </div>
                  <div id="customDateRangeSection" class="custom-date-range-section" style="display: ${reportDateFilter === 'custom' ? 'block' : 'none'};">
                    <div class="custom-date-inputs">
                      <div class="custom-date-input-group">
                        <label>BaÅŸlangÄ±Ã§:</label>
                        <input type="date" id="customDateStart" value="${formatDateForInput(customDateRange.start)}" class="custom-date-input">
                      </div>
                      <div class="custom-date-input-group">
                        <label>BitiÅŸ:</label>
                        <input type="date" id="customDateEnd" value="${formatDateForInput(customDateRange.end)}" class="custom-date-input">
                      </div>
                    </div>
                    <button class="custom-date-apply-btn" onclick="setCustomDateRange();">Uygula</button>
                  </div>
                </div>
              </div>
              </div>
            </div>
          </div>
          
          <!-- SeÃ§ilen Zaman Dilimi Ciro ve Masraf Bilgisi -->
          <div class="period-revenue-container">
            <div class="period-revenue-card" onclick="showDailyRevenueModal()" style="cursor: pointer;">
              <div class="period-card-background"></div>
              <div class="period-card-icon">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="period-revenue-content">
                <div class="period-revenue-label">
                  <span class="period-label-icon">ğŸ“ˆ</span>
                  <span>SeÃ§ilen Zaman Dilimi Cirosu</span>
                </div>
                <div class="period-revenue-period">${periodInfo}</div>
                <div class="period-revenue-amount">â‚º${totalRevenue.toFixed(2)}</div>
              </div>
              <div class="period-card-decoration">
                <svg viewBox="0 0 200 200" preserveAspectRatio="none">
                  <defs>
                    <linearGradient id="revenueGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:rgba(255,255,255,0.15);stop-opacity:1" />
                      <stop offset="100%" style="stop-color:rgba(255,255,255,0);stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <path d="M0,200 Q50,150 100,120 T200,80 L200,200 Z" fill="url(#revenueGradient)"/>
                </svg>
              </div>
            </div>
            <div class="period-expense-stack">
              <div class="period-expense-card" onclick="openExpenseDetailModal()" style="cursor: pointer;">
                <div class="period-card-background"></div>
                <div class="period-card-icon">
                  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div class="period-revenue-content">
                  <div class="period-revenue-label">
                    <span class="period-label-icon">ğŸ“‰</span>
                    <span>SeÃ§ilen Zaman Dilimi MasrafÄ±</span>
                  </div>
                  <div class="period-revenue-period">${periodInfo}</div>
                  <div class="period-revenue-amount">â‚º${totalExpense.toFixed(2)}</div>
                </div>
                <div class="period-card-decoration">
                  <svg viewBox="0 0 200 200" preserveAspectRatio="none">
                    <defs>
                      <linearGradient id="expenseGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:rgba(255,255,255,0.15);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:rgba(255,255,255,0);stop-opacity:1" />
                      </linearGradient>
                    </defs>
                    <path d="M0,200 Q50,150 100,120 T200,80 L200,200 Z" fill="url(#expenseGradient)"/>
                  </svg>
                </div>
              </div>

              <div class="period-zahiyat-card" onclick="openZahiyatModal()" style="cursor: pointer;">
                <div class="period-zahiyat-accent"></div>
                <div class="period-zahiyat-badge">
                  <span>SeÃ§ilen Zaman Dilimi ZahiyatÄ±</span>
                </div>
                <div class="period-zahiyat-meta">${periodInfo}${zahiyatCount ? ` â€¢ ${zahiyatCount} kayÄ±t` : ''}</div>
                <div class="period-zahiyat-amount">â‚º${zahiyatTotal.toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.')}</div>
              </div>
            </div>
          </div>
          
          <!-- Trendyol ve Yemeksepeti CirolarÄ± - Profesyonel Kurumsal TasarÄ±m -->
          <div class="period-revenue-container platform-revenue-container" style="margin-top: 20px;">
            <!-- Trendyol Ciro KartÄ± -->
            <div class="period-revenue-card" style="background: white; padding: 0; border-radius: 16px; box-shadow: 0 8px 32px rgba(251, 191, 36, 0.15), 0 2px 8px rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.2); overflow: hidden; position: relative;">
              <!-- Gradient Border Effect -->
              <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #fbbf24 0%, #f59e0b 50%, #d97706 100%);"></div>
              
              <div style="background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%); padding: 28px 24px; height: 100%; position: relative; overflow: hidden;">
                <!-- Decorative Background Pattern -->
                <div style="position: absolute; top: -20px; right: -20px; width: 120px; height: 120px; background: radial-gradient(circle, rgba(251, 191, 36, 0.08) 0%, transparent 70%); border-radius: 50%;"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: radial-gradient(circle, rgba(251, 191, 36, 0.06) 0%, transparent 70%); border-radius: 50%;"></div>
                
                <!-- Icon Container -->
                <div style="position: absolute; top: 24px; right: 24px; width: 64px; height: 64px; display: flex; align-items: center; justify-content: center; border-radius: 14px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(217, 119, 6, 0.1) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(251, 191, 36, 0.2); box-shadow: 0 4px 12px rgba(251, 191, 36, 0.15);">
                  <img src="${trendyolImageUrl}" alt="Trendyol" onerror="this.onerror=null; this.style.display='none';" style="width: 44px; height: 44px; border-radius: 10px; object-fit: cover; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">
                </div>
                
                <!-- Content -->
                <div style="position: relative; z-index: 1;">
                  <div style="margin-bottom: 12px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                      <div style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); box-shadow: 0 0 8px rgba(251, 191, 36, 0.5);"></div>
                      <span style="font-size: 11px; font-weight: 700; color: #92400e; text-transform: uppercase; letter-spacing: 1px;">TRENDYOL</span>
                    </div>
                    <div style="font-size: 15px; font-weight: 800; color: #1e293b; letter-spacing: -0.3px; margin-bottom: 4px;">Toplam Ciro</div>
                    <div style="font-size: 11px; font-weight: 600; color: #64748b; letter-spacing: 0.2px;">${periodInfo}</div>
                  </div>
                  
                  <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(251, 191, 36, 0.15);">
                    <div style="display: flex; align-items: baseline; gap: 6px;">
                      <span style="font-size: 13px; font-weight: 700; color: #10b981; margin-right: 2px;">â‚º</span>
                      <span style="font-size: 32px; font-weight: 900; color: #10b981; letter-spacing: -1px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif; line-height: 1;">${trendyolRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 10px; font-weight: 600; color: #64748b; opacity: 0.8;">
                      ${totalRevenue > 0 ? ((trendyolRevenue / totalRevenue) * 100).toFixed(1) : '0'}% toplam cirodan
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Yemeksepeti Ciro KartÄ± -->
            <div class="period-expense-card" style="background: white; padding: 0; border-radius: 16px; box-shadow: 0 8px 32px rgba(239, 68, 68, 0.15), 0 2px 8px rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); overflow: hidden; position: relative;">
              <!-- Gradient Border Effect -->
              <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);"></div>
              
              <div style="background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%); padding: 28px 24px; height: 100%; position: relative; overflow: hidden;">
                <!-- Decorative Background Pattern -->
                <div style="position: absolute; top: -20px; right: -20px; width: 120px; height: 120px; background: radial-gradient(circle, rgba(239, 68, 68, 0.08) 0%, transparent 70%); border-radius: 50%;"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: radial-gradient(circle, rgba(239, 68, 68, 0.06) 0%, transparent 70%); border-radius: 50%;"></div>
                
                <!-- Icon Container -->
                <div style="position: absolute; top: 24px; right: 24px; width: 64px; height: 64px; display: flex; align-items: center; justify-content: center; border-radius: 14px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(185, 28, 28, 0.1) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(239, 68, 68, 0.2); box-shadow: 0 4px 12px rgba(239, 68, 68, 0.15);">
                  <img src="${yemeksepetiImageUrl}" alt="Yemeksepeti" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22%3E%3Cpath fill=%22%23ef4444%22 d=%22M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z%22/%3E%3C/svg%3E';" style="width: 44px; height: 44px; border-radius: 10px; object-fit: cover; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">
                </div>
                
                <!-- Content -->
                <div style="position: relative; z-index: 1;">
                  <div style="margin-bottom: 12px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                      <div style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);"></div>
                      <span style="font-size: 11px; font-weight: 700; color: #991b1b; text-transform: uppercase; letter-spacing: 1px;">YEMEKSEPETÄ°</span>
                    </div>
                    <div style="font-size: 15px; font-weight: 800; color: #1e293b; letter-spacing: -0.3px; margin-bottom: 4px;">Toplam Ciro</div>
                    <div style="font-size: 11px; font-weight: 600; color: #64748b; letter-spacing: 0.2px;">${periodInfo}</div>
                  </div>
                  
                  <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(239, 68, 68, 0.15);">
                    <div style="display: flex; align-items: baseline; gap: 6px;">
                      <span style="font-size: 13px; font-weight: 700; color: #10b981; margin-right: 2px;">â‚º</span>
                      <span style="font-size: 32px; font-weight: 900; color: #10b981; letter-spacing: -1px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif; line-height: 1;">${yemeksepetiRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 10px; font-weight: 600; color: #64748b; opacity: 0.8;">
                      ${totalRevenue > 0 ? ((yemeksepetiRevenue / totalRevenue) * 100).toFixed(1) : '0'}% toplam cirodan
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Migros Yemek Ciro KartÄ± -->
            <div class="period-revenue-card" style="background: white; padding: 0; border-radius: 16px; box-shadow: 0 8px 32px rgba(37, 99, 235, 0.14), 0 2px 8px rgba(37, 99, 235, 0.10); border: 1px solid rgba(37, 99, 235, 0.18); overflow: hidden; position: relative;">
              <!-- Gradient Border Effect -->
              <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, #2563eb 0%, #1d4ed8 50%, #1e40af 100%);"></div>
              
              <div style="background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%); padding: 28px 24px; height: 100%; position: relative; overflow: hidden;">
                <!-- Decorative Background Pattern -->
                <div style="position: absolute; top: -20px; right: -20px; width: 120px; height: 120px; background: radial-gradient(circle, rgba(37, 99, 235, 0.08) 0%, transparent 70%); border-radius: 50%;"></div>
                <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: radial-gradient(circle, rgba(37, 99, 235, 0.06) 0%, transparent 70%); border-radius: 50%;"></div>
                
                <!-- Icon Container -->
                <div style="position: absolute; top: 24px; right: 24px; width: 64px; height: 64px; display: flex; align-items: center; justify-content: center; border-radius: 14px; background: linear-gradient(135deg, rgba(37, 99, 235, 0.15) 0%, rgba(30, 64, 175, 0.10) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(37, 99, 235, 0.2); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);">
                  <img src="${migrosImageUrl}" alt="Migros Yemek" onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22%3E%3Cpath fill=%22%232563eb%22 d=%22M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1.6 14.6h-1.8V7.4h1.8v9.2zm6.2 0h-1.8V12c0-.87-.71-1.58-1.58-1.58-.88 0-1.62.7-1.62 1.58v4.6h-1.8V12c0-1.86 1.52-3.38 3.42-3.38 1.88 0 3.38 1.52 3.38 3.38v4.6z%22/%3E%3C/svg%3E';" style="width: 44px; height: 44px; border-radius: 10px; object-fit: cover; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));">
                </div>
                
                <!-- Content -->
                <div style="position: relative; z-index: 1;">
                  <div style="margin-bottom: 12px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 6px;">
                      <div style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); box-shadow: 0 0 8px rgba(37, 99, 235, 0.45);"></div>
                      <span style="font-size: 11px; font-weight: 700; color: #1e40af; text-transform: uppercase; letter-spacing: 1px;">MÄ°GROS YEMEK</span>
                    </div>
                    <div style="font-size: 15px; font-weight: 800; color: #1e293b; letter-spacing: -0.3px; margin-bottom: 4px;">Toplam Ciro</div>
                    <div style="font-size: 11px; font-weight: 600; color: #64748b; letter-spacing: 0.2px;">${periodInfo}</div>
                  </div>
                  
                  <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(37, 99, 235, 0.15);">
                    <div style="display: flex; align-items: baseline; gap: 6px;">
                      <span style="font-size: 13px; font-weight: 700; color: #10b981; margin-right: 2px;">â‚º</span>
                      <span style="font-size: 32px; font-weight: 900; color: #10b981; letter-spacing: -1px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif; line-height: 1;">${migrosYemekRevenue.toFixed(2).replace(/\\B(?=(\\d{3})+(?!\\d))/g, '.')}</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 10px; font-weight: 600; color: #64748b; opacity: 0.8;">
                      ${totalRevenue > 0 ? ((migrosYemekRevenue / totalRevenue) * 100).toFixed(1) : '0'}% toplam cirodan
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card stat-card-green">
              <div class="stat-icon">ğŸ’°</div>
              <div class="stat-content">
                <h3>Toplam Ciro</h3>
                <div class="stat-value">â‚º${totalRevenue.toFixed(2)}</div>
              </div>
            </div>
            <div class="stat-card stat-card-blue">
              <div class="stat-icon">ğŸ“¦</div>
              <div class="stat-content">
                <h3>Toplam SatÄ±ÅŸ</h3>
                <div class="stat-value">${reportSales.length}</div>
              </div>
            </div>
            <div class="stat-card stat-card-purple">
              <div class="stat-icon">ğŸ“Š</div>
              <div class="stat-content">
                <h3>Ortalama Sepet</h3>
                <div class="stat-value">â‚º${(reportSales.length > 0 ? (totalRevenue / reportSales.length) : 0).toFixed(2)}</div>
              </div>
            </div>
            <div class="stat-card stat-card-orange">
              <div class="stat-icon">ğŸ“ˆ</div>
              <div class="stat-content">
                <h3>En YÃ¼ksek SatÄ±ÅŸ</h3>
                <div class="stat-value">â‚º${(reportSales.length > 0 ? Math.max(...reportSales.map(s => parseFloat(s.total_amount))) : 0).toFixed(2)}</div>
              </div>
            </div>
          </div>

          <div class="reports-container-modern">
            <!-- Ãœst Kutu: YÃ¼kselen Grafik -->
            <div class="report-group report-group-rising">
              <div class="report-group-header">
                <div class="report-group-title">
                  <svg class="chart-icon chart-icon-rising" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 18L9 12L13 16L21 8" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21 8H15V14" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>YÃ¼kselen Performans</span>
                </div>
                <div class="report-group-chart">
                  <svg class="chart-svg chart-rising" viewBox="0 0 120 40" preserveAspectRatio="none">
                    <defs>
                      <linearGradient id="risingGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#10b981;stop-opacity:0" />
                      </linearGradient>
                    </defs>
                    <path d="M0,35 Q15,25 30,20 T60,15 T90,10 T120,5" fill="url(#risingGradient)" stroke="none"/>
                    <path d="M0,35 Q15,25 30,20 T60,15 T90,10 T120,5" stroke="#10b981" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    <circle cx="120" cy="5" r="3" fill="#10b981"/>
                  </svg>
                </div>
              </div>
              <div class="report-group-cards">
                <div class="report-card report-card-top-earning">
                  <h3 class="report-card-title">En Ã‡ok KazandÄ±ran ÃœrÃ¼nler</h3>
                  <div class="product-list">
                    ${topProductsByRevenue.length > 0 ? topProductsByRevenue.map(([product, stats], index) => `
                      <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                          <div class="product-name">${product}</div>
                          <div class="product-meta">
                            <span class="product-quantity">${stats.count} adet</span>
                            <span class="product-total product-total-emphasis">â‚º${stats.revenue.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    `).join('') : '<p class="no-data">Veri yok</p>'}
                  </div>
                </div>

                <div class="report-card report-card-top-sold">
                  <h3 class="report-card-title">En Ã‡ok SatÄ±lan ÃœrÃ¼nler</h3>
                  <div class="product-list">
                    ${topProductsByCount.length > 0 ? topProductsByCount.map(([product, stats], index) => `
                      <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                          <div class="product-name">${product}</div>
                          <div class="product-meta">
                            <span class="product-quantity">${stats.count} adet</span>
                            <span class="product-total">â‚º${stats.revenue.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    `).join('') : '<p class="no-data">Veri yok</p>'}
                  </div>
                </div>
              </div>
            </div>

            <!-- Alt Kutu: AlÃ§alan Grafik -->
            <div class="report-group report-group-falling">
              <div class="report-group-header">
                <div class="report-group-title">
                  <svg class="chart-icon chart-icon-falling" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 6L9 12L13 8L21 16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21 16H15V10" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span>DÃ¼ÅŸÃ¼k Performans</span>
                </div>
                <div class="report-group-chart">
                  <svg class="chart-svg chart-falling" viewBox="0 0 120 40" preserveAspectRatio="none">
                    <defs>
                      <linearGradient id="fallingGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:0.3" />
                        <stop offset="100%" style="stop-color:#f59e0b;stop-opacity:0" />
                      </linearGradient>
                    </defs>
                    <path d="M0,5 Q15,15 30,20 T60,25 T90,30 T120,35" fill="url(#fallingGradient)" stroke="none"/>
                    <path d="M0,5 Q15,15 30,20 T60,25 T90,30 T120,35" stroke="#f59e0b" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    <circle cx="120" cy="35" r="3" fill="#f59e0b"/>
                  </svg>
                </div>
              </div>
              <div class="report-group-cards">
                <div class="report-card report-card-least-earning">
                  <h3 class="report-card-title">En Az KazandÄ±ran ÃœrÃ¼nler</h3>
                  <div class="product-list">
                    ${bottomProductsByRevenue.length > 0 ? bottomProductsByRevenue.map(([product, stats], index) => `
                      <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                          <div class="product-name">${product}</div>
                          <div class="product-meta">
                            <span class="product-quantity">${stats.count} adet</span>
                            <span class="product-total">â‚º${stats.revenue.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    `).join('') : '<p class="no-data">Veri yok</p>'}
                  </div>
                </div>

                <div class="report-card report-card-least-sold">
                  <h3 class="report-card-title">En Az SatÄ±lan ÃœrÃ¼nler</h3>
                  <div class="product-list">
                    ${bottomProductsByCount.length > 0 ? bottomProductsByCount.map(([product, stats], index) => `
                      <div class="product-item">
                        <div class="product-rank">${index + 1}</div>
                        <div class="product-info">
                          <div class="product-name">${product}</div>
                          <div class="product-meta">
                            <span class="product-quantity">${stats.count} adet</span>
                            <span class="product-total">â‚º${stats.revenue.toFixed(2)}</span>
                          </div>
                        </div>
                      </div>
                    `).join('') : '<p class="no-data">Veri yok</p>'}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="report-card">
            <h3 class="report-card-title">ğŸ’³ Ã–deme YÃ¶ntemleri</h3>
            <div class="payment-methods">
              ${Object.entries(paymentMethods).map(([method, data]) => `
                <div class="payment-method-item">
                  <div class="payment-method-header">
                    <span class="payment-method-name">${method}</span>
                    <span class="payment-method-count">${data.count} satÄ±ÅŸ (${reportSales.length > 0 ? ((data.count / reportSales.length) * 100).toFixed(1) : '0'}%)</span>
                  </div>
                  <div class="payment-progress-bar">
                    <div class="payment-progress-fill" style="width: ${reportSales.length > 0 ? (data.count / reportSales.length) * 100 : 0}%"></div>
                  </div>
                  <div class="payment-total">Toplam: â‚º${data.total.toFixed(2)}</div>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- TÃ¼m ÃœrÃ¼nler DetaylÄ± Liste - Profesyonel Mobil Tablo -->
          <div class="report-card" style="margin-top: 30px; padding: 0; overflow: hidden; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 14px 16px; color: white;">
              <h3 style="margin: 0; font-size: 14px; font-weight: 800; letter-spacing: 0.2px;">ğŸ“‹ ${reportDateFilter === 'week' ? 'Son 1 Hafta' : reportDateFilter === 'month' ? 'Son 1 Ay' : reportDateFilter === 'yesterday' ? 'DÃ¼n' : 'TÃ¼m Zamanlar'} - ÃœrÃ¼n BazlÄ± DetaylÄ± Rapor</h3>
              <p style="margin: 3px 0 0 0; font-size: 10px; opacity: 0.9; font-weight: 500;">GerÃ§ek satÄ±ÅŸ verileri ile Ã¼rÃ¼n performans analizi</p>
            </div>
            
            <div style="padding: 0; overflow-x: hidden; overflow-y: auto; max-height: calc(100vh - 380px);">
              ${productEntries.length > 0 ? `
                <!-- Profesyonel Tablo -->
                <div style="width: 100%; border-collapse: collapse;">
                  <!-- Tablo BaÅŸlÄ±ÄŸÄ± - Sabit -->
                  <div style="position: sticky; top: 0; z-index: 10; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-bottom: 2px solid #e2e8f0; padding: 10px 12px; display: grid; grid-template-columns: 38px minmax(0, 1fr) 55px 85px 50px; gap: 6px; align-items: center;">
                    <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; text-align: center;">#</div>
                    <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; min-width: 0;">ÃœrÃ¼n AdÄ±</div>
                    <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; text-align: right;">Adet</div>
                    <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; text-align: right;">Ciro</div>
                    <div style="font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.3px; text-align: right;">%</div>
                  </div>
                  
                  <!-- Tablo SatÄ±rlarÄ± -->
                  <div style="display: flex; flex-direction: column;">
                    ${productEntries
                      .sort(([, a], [, b]) => b.revenue - a.revenue)
                      .map(([product, stats], index) => {
                        const percentage = totalRevenue > 0 ? (stats.revenue / totalRevenue * 100) : 0;
                        const isTop3 = index < 3;
                        const rowBg = index % 2 === 0 ? '#ffffff' : '#f8fafc';
                        const rankColor = index === 0 ? '#fbbf24' : index === 1 ? '#94a3b8' : index === 2 ? '#f97316' : 'transparent';
                        
                        // ÃœrÃ¼n adÄ±nÄ± temizle ve kontrol et
                        let productName = (product || '').toString().trim();
                        if (!productName || productName === 'undefined' || productName === 'null' || productName.length === 0) {
                          productName = 'Bilinmeyen ÃœrÃ¼n';
                        }
                        // HTML escape
                        productName = productName.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;');
                        // Ciro formatÄ±nÄ± kompakt ama tam sayÄ± olarak gÃ¶ster
                        const revenueNum = stats.revenue;
                        const revenueFormatted = revenueNum >= 1000 
                          ? `â‚º${(revenueNum / 1000).toFixed(1)}K` 
                          : `â‚º${revenueNum.toFixed(0)}`;
                        const revenueFull = `â‚º${revenueNum.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}`;
                        
                        return `
                          <div style="background: ${rowBg}; border-bottom: 1px solid #e5e7eb; padding: 10px 12px; display: grid; grid-template-columns: 38px minmax(0, 1fr) 55px 90px 50px; gap: 6px; align-items: center; transition: all 0.2s; ${isTop3 ? 'border-left: 2px solid ' + rankColor + ';' : ''}" 
                               onmouseover="this.style.background='#f1f5f9';" 
                               onmouseout="this.style.background='${rowBg}';">
                            <!-- SÄ±ra No -->
                            <div style="text-align: center; flex-shrink: 0;">
                              ${isTop3 ? `
                                <div style="width: 24px; height: 24px; border-radius: 5px; background: linear-gradient(135deg, ${rankColor} 0%, ${rankColor}dd 100%); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 11px; color: white; margin: 0 auto; box-shadow: 0 1px 4px ${rankColor}40;">
                                  ${index + 1}
                                </div>
                              ` : `
                                <div style="font-size: 11px; font-weight: 700; color: #64748b;">${index + 1}</div>
                              `}
                            </div>
                            
                            <!-- ÃœrÃ¼n AdÄ± -->
                            <div style="min-width: 0; overflow: hidden; word-break: break-word;">
                              <div style="font-size: 12px; font-weight: 700; color: #1e293b; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;">${productName}</div>
                            </div>
                            
                            <!-- Adet -->
                            <div style="text-align: right; flex-shrink: 0;">
                              <div style="font-size: 11px; font-weight: 700; color: #475569;">${stats.count}</div>
                            </div>
                            
                            <!-- Ciro -->
                            <div style="text-align: right; flex-shrink: 0; min-width: 0;">
                              <div style="font-size: 11px; font-weight: 800; color: #10b981; letter-spacing: -0.3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${revenueFull}">${revenueFull}</div>
                            </div>
                            
                            <!-- YÃ¼zde -->
                            <div style="text-align: right; flex-shrink: 0;">
                              <div style="font-size: 11px; font-weight: 700; color: #64748b;">${percentage.toFixed(1)}%</div>
                            </div>
                          </div>
                        `;
                      }).join('')}
                  </div>
                  
                  <!-- Toplam Ã–zet - Alt Sabit -->
                  <div style="position: sticky; bottom: 0; background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 12px; border-top: 2px solid #475569; display: grid; grid-template-columns: minmax(0, 1fr) 55px 90px 50px; gap: 6px; align-items: center;">
                    <div style="font-size: 11px; font-weight: 800; color: #f1f5f9; text-transform: uppercase; letter-spacing: 0.3px; min-width: 0;">Toplam (${productEntries.length})</div>
                    <div style="text-align: right;">
                      <div style="font-size: 12px; font-weight: 800; color: #f1f5f9;">${productEntries.reduce((sum, [, stats]) => sum + stats.count, 0)}</div>
                    </div>
                    <div style="text-align: right; min-width: 0;">
                      <div style="font-size: 12px; font-weight: 900; color: #10b981; letter-spacing: -0.3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">â‚º${productEntries.reduce((sum, [, stats]) => sum + stats.revenue, 0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</div>
                    </div>
                    <div style="text-align: right;">
                      <div style="font-size: 11px; font-weight: 800; color: #f1f5f9;">100%</div>
                    </div>
                  </div>
                </div>
              ` : `
                <div style="text-align: center; padding: 60px 20px; color: #9ca3af;">
                  <div style="font-size: 64px; margin-bottom: 16px; opacity: 0.5;">ğŸ“Š</div>
                  <div style="font-weight: 700; font-size: 16px; color: #6b7280; margin-bottom: 6px;">HenÃ¼z veri yok</div>
                  <div style="font-size: 13px; color: #9ca3af;">SatÄ±ÅŸ yapÄ±ldÄ±kÃ§a burada gÃ¶rÃ¼necek</div>
                </div>
              `}
            </div>
          </div>

          <!-- Masalar DetaylÄ± Rapor Tablosu -->
          <div class="report-card" style="margin-top: 20px; padding: 0; overflow: hidden; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
            <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 14px 16px; color: white;">
              <h3 style="margin: 0; font-size: 14px; font-weight: 800; letter-spacing: 0.2px;">ğŸª‘ ${reportDateFilter === 'week' ? 'Son 1 Hafta' : reportDateFilter === 'month' ? 'Son 1 Ay' : reportDateFilter === 'yesterday' ? 'DÃ¼n' : 'TÃ¼m Zamanlar'} - Masalar DetaylÄ± Rapor</h3>
              <p style="margin: 3px 0 0 0; font-size: 10px; opacity: 0.9; font-weight: 500;">Masa bazlÄ± satÄ±ÅŸ performans analizi</p>
            </div>
            
            <div style="padding: 0; overflow-x: hidden; overflow-y: auto; max-height: calc(100vh - 380px);">
              ${generateTablesReportHTML(reportSales, insideTablesCount, outsideTablesCount)}
            </div>
          </div>

          <!-- Saat BazlÄ± SatÄ±ÅŸ YoÄŸunluk GrafiÄŸi -->
          <div class="report-card" style="margin-top: 20px; padding: 0; overflow: hidden; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
            <div style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); padding: 14px 16px; color: white;">
              <h3 style="margin: 0; font-size: 14px; font-weight: 800; letter-spacing: 0.2px;">â° ${reportDateFilter === 'week' ? 'Son 1 Hafta' : reportDateFilter === 'month' ? 'Son 1 Ay' : reportDateFilter === 'yesterday' ? 'DÃ¼n' : 'TÃ¼m Zamanlar'} - Saat BazlÄ± SatÄ±ÅŸ YoÄŸunluÄŸu</h3>
              <p style="margin: 3px 0 0 0; font-size: 10px; opacity: 0.9; font-weight: 500;">Saatlik satÄ±ÅŸ performans analizi ve yoÄŸunluk grafiÄŸi</p>
            </div>
            
            <div style="padding: 16px; overflow-x: hidden;">
              ${generateHourlySalesHTML(reportSales)}
            </div>
          </div>

          <!-- GÃ¼n BazlÄ± SatÄ±ÅŸ YoÄŸunluk GrafiÄŸi -->
          <div class="report-card" style="margin-top: 20px; padding: 0; overflow: hidden; background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
            <div style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); padding: 14px 16px; color: white;">
              <h3 style="margin: 0; font-size: 14px; font-weight: 800; letter-spacing: 0.2px;">ğŸ“… ${reportDateFilter === 'week' ? 'Son 1 Hafta' : reportDateFilter === 'month' ? 'Son 1 Ay' : reportDateFilter === 'yesterday' ? 'DÃ¼n' : 'TÃ¼m Zamanlar'} - GÃ¼n BazlÄ± SatÄ±ÅŸ YoÄŸunluÄŸu</h3>
              <p style="margin: 3px 0 0 0; font-size: 10px; opacity: 0.9; font-weight: 500;">HaftanÄ±n gÃ¼nleri bazlÄ± satÄ±ÅŸ performans analizi</p>
            </div>
            
            <div style="padding: 16px; overflow-x: hidden;">
              ${generateDailySalesHTML(reportSales)}
            </div>
          </div>
        </div>
      `;

      container.innerHTML = html;
    }

    // GÃ¼n bazlÄ± satÄ±ÅŸ yoÄŸunluk grafiÄŸi ve tablosu oluÅŸtur
    function generateDailySalesHTML(reportSales) {
      // TÃ¼rkÃ§e gÃ¼n isimleri
      const dayNames = ['Pazar', 'Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi'];
      const dayOrder = [1, 2, 3, 4, 5, 6, 0]; // Pazartesi'den baÅŸlayarak sÄ±ralama
      
      // GÃ¼n bazlÄ± istatistikleri hesapla
      const dailyStats = {};
      dayOrder.forEach(dayNum => {
        dailyStats[dayNum] = {
          dayNum: dayNum,
          dayName: dayNames[dayNum],
          salesCount: 0,
          revenue: 0,
          products: {} // ÃœrÃ¼n bazlÄ± sayÄ±lar
        };
      });
      
      // SatÄ±ÅŸ verilerini gÃ¼n bazlÄ± grupla
      reportSales.forEach(sale => {
        let dayNum = null;
        
        // sale_date'den gÃ¼n Ã§Ä±kar (DD.MM.YYYY formatÄ±)
        if (sale.sale_date) {
          try {
            const dateParts = sale.sale_date.split('.');
            if (dateParts.length === 3) {
              const day = parseInt(dateParts[0]);
              const month = parseInt(dateParts[1]) - 1; // Ay 0-11 arasÄ±
              const year = parseInt(dateParts[2]);
              const date = new Date(year, month, day);
              dayNum = date.getDay(); // 0=Pazar, 1=Pazartesi, ...
            }
          } catch (e) {
            // Hata durumunda atla
          }
        }
        
        // EÄŸer sale_date'den Ã§Ä±karamazsak, created_at'ten dene
        if (dayNum === null && sale.created_at) {
          try {
            const date = sale.created_at.toDate ? sale.created_at.toDate() : new Date(sale.created_at);
            dayNum = date.getDay();
          } catch (e) {
            // Hata durumunda atla
          }
        }
        
        if (dayNum !== null && dayNum >= 0 && dayNum < 7) {
          dailyStats[dayNum].salesCount++;
          dailyStats[dayNum].revenue += parseFloat(sale.total_amount || 0);
          
          // ÃœrÃ¼nleri say
          const items = sale.items_array || sale.items || [];
          if (Array.isArray(items)) {
            items.forEach(item => {
              if (item && item.product_name && !item.isExpense) {
                const productName = item.product_name;
                if (!dailyStats[dayNum].products[productName]) {
                  dailyStats[dayNum].products[productName] = 0;
                }
                dailyStats[dayNum].products[productName] += (item.quantity || 1);
              }
            });
          }
        }
      });
      
      // En Ã§ok satÄ±lan Ã¼rÃ¼nÃ¼ bul (her gÃ¼n iÃ§in)
      dayOrder.forEach(dayNum => {
        const products = dailyStats[dayNum].products;
        const entries = Object.entries(products);
        if (entries.length > 0) {
          entries.sort(([, a], [, b]) => b - a);
          dailyStats[dayNum].topProduct = entries[0][0];
          dailyStats[dayNum].topProductCount = entries[0][1];
        } else {
          dailyStats[dayNum].topProduct = '-';
          dailyStats[dayNum].topProductCount = 0;
        }
      });
      
      // GÃ¼nleri sÄ±rala (Pazartesi'den baÅŸlayarak)
      const dailyEntries = dayOrder.map(dayNum => dailyStats[dayNum]);
      const maxRevenue = Math.max(...dailyEntries.map(d => d.revenue), 1);
      const totalDailyRevenue = dailyEntries.reduce((sum, d) => sum + d.revenue, 0);
      const totalDailySales = dailyEntries.reduce((sum, d) => sum + d.salesCount, 0);
      
      // Line Chart HTML'i oluÅŸtur - Modern ve Profesyonel
      const chartWidth = 700;
      const chartHeight = 200;
      const padding = { top: 20, right: 30, bottom: 50, left: 50 };
      const graphWidth = chartWidth - padding.left - padding.right;
      const graphHeight = chartHeight - padding.top - padding.bottom;
      
      // GÃ¼nlÃ¼k Ciro Line Chart
      let dailyLinePath = '';
      let dailyPoints = '';
      dailyEntries.forEach((d, index) => {
        const x = padding.left + (index / (dailyEntries.length - 1 || 1)) * graphWidth;
        const y = padding.top + graphHeight - (d.revenue / maxRevenue) * graphHeight;
        if (index === 0) {
          dailyLinePath = `M ${x} ${y}`;
        } else {
          dailyLinePath += ` L ${x} ${y}`;
        }
        const revenueFormatted = d.revenue >= 1000 ? (d.revenue / 1000).toFixed(1) + 'K' : d.revenue.toFixed(0);
        const dailyTooltipX = x - 80;
        const dailyTooltipY = y - 40;
        const dailyRevenueText = d.revenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        dailyPoints += `<circle cx="${x}" cy="${y}" r="5" fill="#8b5cf6" stroke="#ffffff" stroke-width="2.5" style="cursor: pointer;" onmouseover="this.setAttribute('r', '7'); const tooltip = this.parentElement.querySelector('#tooltip-daily'); const text = this.parentElement.querySelector('#tooltip-daily-text'); text.textContent='${d.dayName} - â‚º${dailyRevenueText}'; tooltip.setAttribute('transform', 'translate(${dailyTooltipX}, ${dailyTooltipY})'); tooltip.style.opacity='1';" onmouseout="this.setAttribute('r', '5'); this.parentElement.querySelector('#tooltip-daily').style.opacity='0';"></circle>`;
      });
      
      // Y ekseni grid Ã§izgileri
      let dailyGridLines = '';
      for (let i = 0; i <= 4; i++) {
        const y = padding.top + (i / 4) * graphHeight;
        dailyGridLines += `<line x1="${padding.left}" y1="${y}" x2="${padding.left + graphWidth}" y2="${y}" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="2,2"></line>`;
      }
      
      let chartHTML = `
        <div style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
            <h4 style="font-size: 13px; font-weight: 800; color: #1e293b; margin: 0; letter-spacing: 0.3px;">ğŸ’° GÃ¼nlÃ¼k Ciro</h4>
            <div style="font-size: 10px; color: #64748b; font-weight: 600;">Toplam: <span style="color: #8b5cf6; font-weight: 700;">â‚º${totalDailyRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</span></div>
          </div>
          <div style="overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 20px; background: #ffffff; border-radius: 12px; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <svg width="${chartWidth}" height="${chartHeight}" style="display: block;">
              <!-- Grid Ã§izgileri -->
              ${dailyGridLines}
              <!-- Area fill -->
              <defs>
                <linearGradient id="dailyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:0.2" />
                  <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:0" />
                </linearGradient>
              </defs>
              <path d="${dailyLinePath} L ${padding.left + graphWidth} ${padding.top + graphHeight} L ${padding.left} ${padding.top + graphHeight} Z" fill="url(#dailyGradient)"></path>
              <!-- Line -->
              <path d="${dailyLinePath}" stroke="#8b5cf6" stroke-width="3.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></path>
              <!-- Points -->
              ${dailyPoints}
              <!-- Y ekseni etiketleri -->
              ${[0, 0.25, 0.5, 0.75, 1].map((ratio, i) => {
                const y = padding.top + (1 - ratio) * graphHeight;
                const value = Math.round(maxRevenue * ratio / 1000);
                return `<text x="${padding.left - 10}" y="${y + 4}" text-anchor="end" font-size="10" fill="#94a3b8" font-weight="600">â‚º${value}K</text>`;
              }).join('')}
              <!-- X ekseni etiketleri -->
              ${dailyEntries.map((d, index) => {
                const x = padding.left + (index / (dailyEntries.length - 1 || 1)) * graphWidth;
                return `<text x="${x}" y="${chartHeight - 15}" text-anchor="middle" font-size="11" fill="#64748b" font-weight="600">${d.dayName}</text>`;
              }).join('')}
              <!-- Tooltip -->
              <g id="tooltip-daily" opacity="0" style="transition: opacity 0.2s; pointer-events: none;">
                <rect x="0" y="0" width="160" height="32" rx="6" fill="#1e293b" opacity="0.95"></rect>
                <text id="tooltip-daily-text" x="80" y="20" text-anchor="middle" font-size="11" fill="#ffffff" font-weight="700"></text>
              </g>
            </svg>
          </div>
        </div>
      `;
      
      // Tablo HTML'i oluÅŸtur - Modern ve Profesyonel
      let tableHTML = `
        <div style="margin-top: 24px;">
          <h4 style="font-size: 13px; font-weight: 800; color: #1e293b; margin-bottom: 16px; letter-spacing: 0.3px;">ğŸ“‹ DetaylÄ± GÃ¼n BazlÄ± Tablo</h4>
          <div style="width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <!-- Tablo BaÅŸlÄ±ÄŸÄ± -->
            <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-bottom: 2px solid #e2e8f0; padding: 12px 16px; display: grid; grid-template-columns: 110px 1fr 1fr 1fr; gap: 12px; align-items: center;">
              <div style="font-size: 11px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.5px;">GÃ¼n</div>
              <div style="font-size: 11px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; text-align: right;">SatÄ±ÅŸ SayÄ±sÄ±</div>
              <div style="font-size: 11px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; text-align: right;">Ciro</div>
              <div style="font-size: 11px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; min-width: 0;">En Ã‡ok SatÄ±lan</div>
            </div>
            
            <!-- Tablo SatÄ±rlarÄ± -->
            <div style="max-height: 400px; overflow-y: auto;">
      `;
      
      dailyEntries.forEach((d, index) => {
        const rowBg = index % 2 === 0 ? '#ffffff' : '#f8fafc';
        const revenueFull = 'â‚º' + d.revenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        const percentage = totalDailyRevenue > 0 ? (d.revenue / totalDailyRevenue * 100) : 0;
        const isPeak = d.revenue === maxRevenue;
        const topProductDisplay = d.topProduct !== '-' ? d.topProduct + ' (' + d.topProductCount + 'x)' : '-';
        
        tableHTML += `
          <div style="background: ${rowBg}; border-bottom: 1px solid #e5e7eb; padding: 12px 16px; display: grid; grid-template-columns: 110px 1fr 1fr 1fr; gap: 12px; align-items: center; transition: all 0.2s; ${isPeak ? 'border-left: 3px solid #8b5cf6; background: #faf5ff;' : ''}" 
               onmouseover="this.style.background='#f1f5f9';" 
               onmouseout="this.style.background='${isPeak ? '#faf5ff' : rowBg}';">
            <div style="font-size: 12px; font-weight: 700; color: #1e293b;">
              ${d.dayName}
            </div>
            <div style="text-align: right;">
              <div style="font-size: 12px; font-weight: 700; color: #475569;">${d.salesCount}</div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 12px; font-weight: 800; color: ${isPeak ? '#8b5cf6' : '#10b981'}; letter-spacing: -0.2px;" title="${revenueFull}">${revenueFull}</div>
              ${percentage > 0 ? `<div style="font-size: 10px; color: #64748b; margin-top: 3px; font-weight: 600;">${percentage.toFixed(1)}%</div>` : ''}
            </div>
            <div style="min-width: 0; overflow: hidden; word-break: break-word;">
              <div style="font-size: 11px; font-weight: 600; color: #64748b; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis;" title="${topProductDisplay}">${topProductDisplay}</div>
            </div>
          </div>
        `;
      });
      
      tableHTML += `
            </div>
            
            <!-- Toplam Ã–zet -->
            <div style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 14px 16px; border-top: 2px solid #475569; display: grid; grid-template-columns: 110px 1fr 1fr 1fr; gap: 12px; align-items: center;">
              <div style="font-size: 12px; font-weight: 800; color: #f1f5f9; text-transform: uppercase; letter-spacing: 0.5px;">Toplam</div>
              <div style="text-align: right;">
                <div style="font-size: 13px; font-weight: 800; color: #f1f5f9;">${totalDailySales}</div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 14px; font-weight: 900; color: #10b981; letter-spacing: -0.2px;">â‚º${totalDailyRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</div>
              </div>
              <div style="min-width: 0;">
                <div style="font-size: 11px; font-weight: 600; color: #f1f5f9; opacity: 0.8;">-</div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      return chartHTML + tableHTML;
    }

    // Saat bazlÄ± satÄ±ÅŸ yoÄŸunluk grafiÄŸi ve tablosu oluÅŸtur
    function generateHourlySalesHTML(reportSales) {
      // Saat bazlÄ± istatistikleri hesapla (0-23 saat)
      const hourlyStats = {};
      for (let hour = 0; hour < 24; hour++) {
        hourlyStats[hour] = {
          hour: hour,
          salesCount: 0,
          revenue: 0
        };
      }
      
      // SatÄ±ÅŸ verilerini saat bazlÄ± grupla
      reportSales.forEach(sale => {
        let hour = null;
        
        // sale_time'den saat Ã§Ä±kar (Ã¶rn: "14:30:25" -> 14)
        if (sale.sale_time) {
          const timeMatch = sale.sale_time.match(/(\d{1,2}):/);
          if (timeMatch) {
            hour = parseInt(timeMatch[1]);
          }
        }
        
        // EÄŸer sale_time yoksa, created_at veya timestamp'ten Ã§Ä±kar
        if (hour === null && sale.created_at) {
          try {
            const date = sale.created_at.toDate ? sale.created_at.toDate() : new Date(sale.created_at);
            hour = date.getHours();
          } catch (e) {
            // Hata durumunda atla
          }
        }
        
        if (hour !== null && hour >= 0 && hour < 24) {
          hourlyStats[hour].salesCount++;
          hourlyStats[hour].revenue += parseFloat(sale.total_amount || 0);
        }
      });
      
      // Saatleri sÄ±rala ve maksimum deÄŸerleri bul
      const hourlyEntries = Object.values(hourlyStats).sort((a, b) => a.hour - b.hour);
      const maxSalesCount = Math.max(...hourlyEntries.map(h => h.salesCount), 1);
      const maxRevenue = Math.max(...hourlyEntries.map(h => h.revenue), 1);
      const totalHourlyRevenue = hourlyEntries.reduce((sum, h) => sum + h.revenue, 0);
      const totalHourlySales = hourlyEntries.reduce((sum, h) => sum + h.salesCount, 0);
      
      // Line Chart HTML'i oluÅŸtur - Modern ve Profesyonel
      const chartWidth = 800;
      const chartHeight = 180;
      const padding = { top: 20, right: 40, bottom: 40, left: 50 };
      const graphWidth = chartWidth - padding.left - padding.right;
      const graphHeight = chartHeight - padding.top - padding.bottom;
      
      // SatÄ±ÅŸ SayÄ±sÄ± Line Chart
      let salesLinePath = '';
      let salesPoints = '';
      let salesDots = '';
      hourlyEntries.forEach((h, index) => {
        const x = padding.left + (index / (hourlyEntries.length - 1 || 1)) * graphWidth;
        const y = padding.top + graphHeight - (h.salesCount / maxSalesCount) * graphHeight;
        if (index === 0) {
          salesLinePath = `M ${x} ${y}`;
        } else {
          salesLinePath += ` L ${x} ${y}`;
        }
        const tooltipX = x - 60;
        const tooltipY = y - 35;
        salesPoints += `<circle cx="${x}" cy="${y}" r="4" fill="#3b82f6" stroke="#ffffff" stroke-width="2" style="cursor: pointer;" onmouseover="this.setAttribute('r', '6'); const tooltip = this.parentElement.querySelector('#tooltip-sales'); const text = this.parentElement.querySelector('#tooltip-sales-text'); text.textContent='${h.hour}:00 - ${h.salesCount} satÄ±ÅŸ'; tooltip.setAttribute('transform', 'translate(${tooltipX}, ${tooltipY})'); tooltip.style.opacity='1';" onmouseout="this.setAttribute('r', '4'); this.parentElement.querySelector('#tooltip-sales').style.opacity='0';"></circle>`;
      });
      
      // Ciro Line Chart
      let revenueLinePath = '';
      let revenuePoints = '';
      hourlyEntries.forEach((h, index) => {
        const x = padding.left + (index / (hourlyEntries.length - 1 || 1)) * graphWidth;
        const y = padding.top + graphHeight - (h.revenue / maxRevenue) * graphHeight;
        if (index === 0) {
          revenueLinePath = `M ${x} ${y}`;
        } else {
          revenueLinePath += ` L ${x} ${y}`;
        }
        const revenueFormatted = h.revenue >= 1000 ? (h.revenue / 1000).toFixed(1) + 'K' : h.revenue.toFixed(0);
        const revTooltipX = x - 70;
        const revTooltipY = y - 35;
        const revenueText = h.revenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        revenuePoints += `<circle cx="${x}" cy="${y}" r="4" fill="#10b981" stroke="#ffffff" stroke-width="2" style="cursor: pointer;" onmouseover="this.setAttribute('r', '6'); const tooltip = this.parentElement.querySelector('#tooltip-revenue'); const text = this.parentElement.querySelector('#tooltip-revenue-text'); text.textContent='${h.hour}:00 - â‚º${revenueText}'; tooltip.setAttribute('transform', 'translate(${revTooltipX}, ${revTooltipY})'); tooltip.style.opacity='1';" onmouseout="this.setAttribute('r', '4'); this.parentElement.querySelector('#tooltip-revenue').style.opacity='0';"></circle>`;
      });
      
      // Y ekseni grid Ã§izgileri
      let salesGridLines = '';
      let revenueGridLines = '';
      for (let i = 0; i <= 4; i++) {
        const y = padding.top + (i / 4) * graphHeight;
        salesGridLines += `<line x1="${padding.left}" y1="${y}" x2="${padding.left + graphWidth}" y2="${y}" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="2,2"></line>`;
        revenueGridLines += `<line x1="${padding.left}" y1="${y}" x2="${padding.left + graphWidth}" y2="${y}" stroke="#e5e7eb" stroke-width="1" stroke-dasharray="2,2"></line>`;
      }
      
      let chartHTML = `
        <div style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
            <h4 style="font-size: 13px; font-weight: 800; color: #1e293b; margin: 0; letter-spacing: 0.3px;">ğŸ“Š SatÄ±ÅŸ SayÄ±sÄ±</h4>
            <div style="font-size: 10px; color: #64748b; font-weight: 600;">Toplam: <span style="color: #1e293b; font-weight: 700;">${totalHourlySales}</span> satÄ±ÅŸ</div>
          </div>
          <div style="overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 20px; background: #ffffff; border-radius: 12px; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <svg width="${chartWidth}" height="${chartHeight}" style="display: block;">
              <!-- Grid Ã§izgileri -->
              ${salesGridLines}
              <!-- Area fill -->
              <defs>
                <linearGradient id="salesGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.2" />
                  <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0" />
                </linearGradient>
              </defs>
              <path d="${salesLinePath} L ${padding.left + graphWidth} ${padding.top + graphHeight} L ${padding.left} ${padding.top + graphHeight} Z" fill="url(#salesGradient)"></path>
              <!-- Line -->
              <path d="${salesLinePath}" stroke="#3b82f6" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"></path>
              <!-- Points -->
              ${salesPoints}
              <!-- Y ekseni etiketleri -->
              ${[0, 0.25, 0.5, 0.75, 1].map((ratio, i) => {
                const y = padding.top + (1 - ratio) * graphHeight;
                const value = Math.round(maxSalesCount * ratio);
                return `<text x="${padding.left - 10}" y="${y + 4}" text-anchor="end" font-size="10" fill="#94a3b8" font-weight="600">${value}</text>`;
              }).join('')}
              <!-- X ekseni etiketleri -->
              ${hourlyEntries.map((h, index) => {
                const x = padding.left + (index / (hourlyEntries.length - 1 || 1)) * graphWidth;
                return `<text x="${x}" y="${chartHeight - 10}" text-anchor="middle" font-size="10" fill="#64748b" font-weight="600">${h.hour.toString().padStart(2, '0')}:00</text>`;
              }).join('')}
              <!-- Tooltip -->
              <g id="tooltip-sales" opacity="0" style="transition: opacity 0.2s; pointer-events: none;">
                <rect x="0" y="0" width="120" height="28" rx="6" fill="#1e293b" opacity="0.95"></rect>
                <text id="tooltip-sales-text" x="60" y="18" text-anchor="middle" font-size="10" fill="#ffffff" font-weight="700"></text>
              </g>
            </svg>
          </div>
        </div>
        
        <div style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
            <h4 style="font-size: 13px; font-weight: 800; color: #1e293b; margin: 0; letter-spacing: 0.3px;">ğŸ’° Ciro</h4>
            <div style="font-size: 10px; color: #64748b; font-weight: 600;">Toplam: <span style="color: #10b981; font-weight: 700;">â‚º${totalHourlyRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</span></div>
          </div>
          <div style="overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 20px; background: #ffffff; border-radius: 12px; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <svg width="${chartWidth}" height="${chartHeight}" style="display: block;">
              <!-- Grid Ã§izgileri -->
              ${revenueGridLines}
              <!-- Area fill -->
              <defs>
                <linearGradient id="revenueGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.2" />
                  <stop offset="100%" style="stop-color:#10b981;stop-opacity:0" />
                </linearGradient>
              </defs>
              <path d="${revenueLinePath} L ${padding.left + graphWidth} ${padding.top + graphHeight} L ${padding.left} ${padding.top + graphHeight} Z" fill="url(#revenueGradient)"></path>
              <!-- Line -->
              <path d="${revenueLinePath}" stroke="#10b981" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"></path>
              <!-- Points -->
              ${revenuePoints}
              <!-- Y ekseni etiketleri -->
              ${[0, 0.25, 0.5, 0.75, 1].map((ratio, i) => {
                const y = padding.top + (1 - ratio) * graphHeight;
                const value = Math.round(maxRevenue * ratio / 1000);
                return `<text x="${padding.left - 10}" y="${y + 4}" text-anchor="end" font-size="10" fill="#94a3b8" font-weight="600">â‚º${value}K</text>`;
              }).join('')}
              <!-- X ekseni etiketleri -->
              ${hourlyEntries.map((h, index) => {
                const x = padding.left + (index / (hourlyEntries.length - 1 || 1)) * graphWidth;
                return `<text x="${x}" y="${chartHeight - 10}" text-anchor="middle" font-size="10" fill="#64748b" font-weight="600">${h.hour.toString().padStart(2, '0')}:00</text>`;
              }).join('')}
              <!-- Tooltip -->
              <g id="tooltip-revenue" opacity="0" style="transition: opacity 0.2s; pointer-events: none;">
                <rect x="0" y="0" width="140" height="28" rx="6" fill="#1e293b" opacity="0.95"></rect>
                <text id="tooltip-revenue-text" x="70" y="18" text-anchor="middle" font-size="10" fill="#ffffff" font-weight="700"></text>
              </g>
            </svg>
          </div>
        </div>
      `;
      
      // Tablo HTML'i oluÅŸtur - Modern ve Profesyonel
      let tableHTML = `
        <div style="margin-top: 24px;">
          <h4 style="font-size: 13px; font-weight: 800; color: #1e293b; margin-bottom: 16px; letter-spacing: 0.3px;">ğŸ“‹ DetaylÄ± Saat BazlÄ± Tablo</h4>
          <div style="width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <!-- Tablo BaÅŸlÄ±ÄŸÄ± -->
            <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-bottom: 2px solid #e2e8f0; padding: 12px 16px; display: grid; grid-template-columns: 90px 1fr 1fr; gap: 12px; align-items: center;">
              <div style="font-size: 11px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.5px;">Saat</div>
              <div style="font-size: 11px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; text-align: right;">SatÄ±ÅŸ SayÄ±sÄ±</div>
              <div style="font-size: 11px; font-weight: 800; color: #475569; text-transform: uppercase; letter-spacing: 0.5px; text-align: right;">Ciro</div>
            </div>
            
            <!-- Tablo SatÄ±rlarÄ± -->
            <div style="max-height: 320px; overflow-y: auto;">
      `;
      
      hourlyEntries.forEach((h, index) => {
        const rowBg = index % 2 === 0 ? '#ffffff' : '#f8fafc';
        const revenueFull = 'â‚º' + h.revenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        const percentage = totalHourlyRevenue > 0 ? (h.revenue / totalHourlyRevenue * 100) : 0;
        const isPeak = h.revenue === maxRevenue;
        const isPeakSales = h.salesCount === maxSalesCount;
        
        tableHTML += `
          <div style="background: ${rowBg}; border-bottom: 1px solid #e5e7eb; padding: 12px 16px; display: grid; grid-template-columns: 90px 1fr 1fr; gap: 12px; align-items: center; transition: all 0.2s; ${isPeak ? 'border-left: 3px solid #f59e0b; background: #fffbeb;' : ''}" 
               onmouseover="this.style.background='#f1f5f9';" 
               onmouseout="this.style.background='${isPeak ? '#fffbeb' : rowBg}';">
            <div style="display: flex; align-items: center; gap: 8px;">
              <div style="font-size: 12px; font-weight: 700; color: #1e293b;">${h.hour.toString().padStart(2, '0')}:00</div>
              ${isPeakSales ? `<div style="width: 6px; height: 6px; border-radius: 50%; background: #10b981; flex-shrink: 0;"></div>` : ''}
            </div>
            <div style="text-align: right;">
              <div style="font-size: 12px; font-weight: 700; color: ${isPeakSales ? '#10b981' : '#475569'};">${h.salesCount}</div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 12px; font-weight: 800; color: ${isPeak ? '#f59e0b' : '#10b981'}; letter-spacing: -0.2px;" title="${revenueFull}">${revenueFull}</div>
              ${percentage > 0 ? `<div style="font-size: 10px; color: #64748b; margin-top: 3px; font-weight: 600;">${percentage.toFixed(1)}%</div>` : ''}
            </div>
          </div>
        `;
      });
      
      tableHTML += `
            </div>
            
            <!-- Toplam Ã–zet -->
            <div style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 14px 16px; border-top: 2px solid #475569; display: grid; grid-template-columns: 90px 1fr 1fr; gap: 12px; align-items: center;">
              <div style="font-size: 12px; font-weight: 800; color: #f1f5f9; text-transform: uppercase; letter-spacing: 0.5px;">Toplam</div>
              <div style="text-align: right;">
                <div style="font-size: 13px; font-weight: 800; color: #f1f5f9;">${totalHourlySales}</div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 14px; font-weight: 900; color: #10b981; letter-spacing: -0.2px;">â‚º${totalHourlyRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      return chartHTML + tableHTML;
    }

    // TÃ¼m masalarÄ± render et (helper function)
    function renderAllTables(allStaticTables) {
      const container = document.getElementById('tablesContainer');
      if (!container || activeTab !== 'tables') {
        return;
      }

      // Gece DÃ¶nercisi: Salon ve BahÃ§e ayrÄ± bÃ¶lÃ¼mler; diÄŸer tenant'lar: tek Masalar listesi
      let html = '';
      if (isGeceDonercisi) {
        const salonTables = Object.values(allStaticTables)
          .filter(t => t.table_id.startsWith('salon-'))
          .sort((a, b) => a.table_number - b.table_number);
        const bahceTables = Object.values(allStaticTables)
          .filter(t => t.table_id.startsWith('bahce-'))
          .sort((a, b) => a.table_number - b.table_number);
        html = `
        <div class="tables-container">
          <div class="tables-section">
            <h2 class="section-title">ğŸª‘ Salon</h2>
            <div class="tables-grid">
              ${salonTables.map(table => renderTableCard(table)).join('')}
            </div>
          </div>
          <div class="tables-section">
            <h2 class="section-title">ğŸŒ¿ BahÃ§e</h2>
            <div class="tables-grid">
              ${bahceTables.map(table => renderTableCard(table)).join('')}
            </div>
          </div>
        </div>
        `;
      } else if (isLacromisa) {
        const insideTables = Object.values(allStaticTables)
          .filter(t => t.table_id.startsWith('inside-'))
          .sort((a, b) => a.table_number - b.table_number);
        const outsideTables = Object.values(allStaticTables)
          .filter(t => t.table_id.startsWith('outside-'))
          .sort((a, b) => a.table_number - b.table_number);
        html = `
        <div class="tables-container">
          <div class="tables-section">
            <h2 class="section-title">ğŸ  Ä°Ã§eri</h2>
            <div class="tables-grid">
              ${insideTables.map(table => renderTableCard(table)).join('')}
            </div>
          </div>
          <div class="tables-section">
            <h2 class="section-title">ğŸŒ³ DÄ±ÅŸarÄ±</h2>
            <div class="tables-grid">
              ${outsideTables.map(table => renderTableCard(table)).join('')}
            </div>
          </div>
        </div>
        `;
      } else {
        const tables = Object.values(allStaticTables)
          .filter(table => table.table_id.startsWith('masa-'))
          .sort((a, b) => a.table_number - b.table_number);
        html = `
        <div class="tables-container">
          <div class="tables-section">
            <h2 class="section-title">ğŸª‘ Masalar</h2>
            <div class="tables-grid">
              ${tables.map(table => renderTableCard(table)).join('')}
            </div>
          </div>
        </div>
      `;
      }

      container.innerHTML = html;
      console.log('âœ… TÃ¼m masalar render edildi');
      
      // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle (sadece masalar, paketler hariÃ§)
      updateActiveTablesCount(calculateActiveTablesCount());
    }

    // Masalar render et
    function renderTables() {
      console.log('ğŸª‘ renderTables Ã§aÄŸrÄ±ldÄ±');
      const container = document.getElementById('tablesContainer');
      if (!container) {
        console.error('âŒ tablesContainer bulunamadÄ±');
        return;
      }

      // Loading gÃ¶ster
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">â³</div>
          <h3>Masalar yÃ¼kleniyor...</h3>
        </div>
      `;

      // Yeni Firebase'den masalarÄ± dinle (makaramasalar)
      if (!tablesDb) {
        console.warn('âš ï¸ tablesDb bulunamadÄ± - sadece statik masalar gÃ¶sterilecek');
        // Firebase olmasa bile tÃ¼m masalarÄ± gÃ¶ster (dinamik)
        allStaticTables = {};
        if (isGeceDonercisi) {
          for (let i = 1; i <= 30; i++) {
            allStaticTables[`salon-${i}`] = { table_id: `salon-${i}`, table_name: `Salon ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
            allStaticTables[`bahce-${i}`] = { table_id: `bahce-${i}`, table_name: `BahÃ§e ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
        } else if (isLacromisa) {
          for (let i = 1; i <= insideTablesCount; i++) {
            allStaticTables[`inside-${i}`] = { table_id: `inside-${i}`, table_name: `Ä°Ã§eri ${i}`, table_type: 'inside', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
          for (let i = 1; i <= outsideTablesCount; i++) {
            allStaticTables[`outside-${i}`] = { table_id: `outside-${i}`, table_name: `DÄ±ÅŸarÄ± ${i}`, table_type: 'outside', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
        } else {
          const totalTablesCount = insideTablesCount + outsideTablesCount;
          for (let i = 1; i <= totalTablesCount; i++) {
            allStaticTables[`masa-${i}`] = { table_id: `masa-${i}`, table_name: `Masa ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
          for (let i = 1; i <= packageTablesCount; i++) {
            allStaticTables[`paket-${i}`] = { table_id: `paket-${i}`, table_name: `Paket ${i}`, table_type: 'package', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          }
        }
        renderAllTables(allStaticTables);
        // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
        updateActiveTablesCount(calculateActiveTablesCount());
        return;
      }

      console.log('âœ… tablesDb mevcut, masalar dinleniyor...');

      // Ã–nceki listener'Ä± temizle
      if (tablesUnsubscribe) {
        tablesUnsubscribe();
        tablesUnsubscribe = null;
      }

      // EÄŸer allStaticTables zaten doluysa (loadTablesDataForStats Ã§alÄ±ÅŸmÄ±ÅŸsa), tekrar oluÅŸturma
      const totalTablesCount = insideTablesCount + outsideTablesCount;
      const expectedTablesCount = totalTablesCount + packageTablesCount;
      
      const geceExpectedCount = 60; // salon 30 + bahce 30
      if (Object.keys(allStaticTables).length === 0 || (!isGeceDonercisi && Object.keys(allStaticTables).length !== expectedTablesCount) || (isGeceDonercisi && Object.keys(allStaticTables).length !== geceExpectedCount)) {
      // TÃœM masalarÄ± statik olarak oluÅŸtur (masaÃ¼stÃ¼ uygulamasÄ±ndaki gibi)
      allStaticTables = {};
      if (isGeceDonercisi) {
        for (let i = 1; i <= 30; i++) {
          allStaticTables[`salon-${i}`] = { table_id: `salon-${i}`, table_name: `Salon ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
          allStaticTables[`bahce-${i}`] = { table_id: `bahce-${i}`, table_name: `BahÃ§e ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
      } else if (isLacromisa) {
        for (let i = 1; i <= insideTablesCount; i++) {
          allStaticTables[`inside-${i}`] = { table_id: `inside-${i}`, table_name: `Ä°Ã§eri ${i}`, table_type: 'inside', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
        for (let i = 1; i <= outsideTablesCount; i++) {
          allStaticTables[`outside-${i}`] = { table_id: `outside-${i}`, table_name: `DÄ±ÅŸarÄ± ${i}`, table_type: 'outside', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
      } else {
        for (let i = 1; i <= totalTablesCount; i++) {
          const tableId = `masa-${i}`;
          allStaticTables[tableId] = { table_id: tableId, table_name: `Masa ${i}`, table_type: 'table', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
        for (let i = 1; i <= packageTablesCount; i++) {
          const tableId = `paket-${i}`;
          allStaticTables[tableId] = { table_id: tableId, table_name: `Paket ${i}`, table_type: 'package', table_number: i, is_occupied: false, total_amount: 0, items: [] };
        }
      }
        console.log(`ğŸ“‹ Toplam ${Object.keys(allStaticTables).length} statik masa oluÅŸturuldu`);
      } else {
        console.log(`ğŸ“‹ Mevcut ${Object.keys(allStaticTables).length} statik masa kullanÄ±lÄ±yor (zaten oluÅŸturulmuÅŸ)`);
      }

      // Ä°lk render - tÃ¼m masalarÄ± gÃ¶ster (Firebase verisi olmasa bile)
      renderAllTables(allStaticTables);
      
      // Aktif masa sayÄ±sÄ±nÄ± gÃ¼ncelle
      updateActiveTablesCount(calculateActiveTablesCount());

      const tablesRef = tablesDb.collection('tables');
      console.log('ğŸ“¡ Firebase collection dinleniyor: tables');
      
      tablesUnsubscribe = tablesRef.onSnapshot((snapshot) => {
        console.log(`ğŸ“Š Masalar snapshot alÄ±ndÄ±: ${snapshot.size} Firebase verisi bulundu`);

        // Firebase'den gelen verileri statik masalarla birleÅŸtir
        snapshot.forEach((doc) => {
          const firebaseData = doc.data();
          const tableId = firebaseData.table_id || doc.id;
          
          if (allStaticTables[tableId]) {
            // Firebase'den gelen verileri statik masaya ekle
            allStaticTables[tableId].is_occupied = firebaseData.is_occupied === true || 
                                                   firebaseData.is_occupied === 'true' || 
                                                   firebaseData.is_occupied === 1 ||
                                                   (firebaseData.items && Array.isArray(firebaseData.items) && firebaseData.items.length > 0);
            allStaticTables[tableId].total_amount = parseFloat(firebaseData.total_amount || 0);
            allStaticTables[tableId].items = Array.isArray(firebaseData.items) ? firebaseData.items : [];
            allStaticTables[tableId].order_id = firebaseData.order_id || null;
            allStaticTables[tableId].order_date = firebaseData.order_date || null;
            allStaticTables[tableId].order_time = firebaseData.order_time || null;
            allStaticTables[tableId].order_note = firebaseData.order_note || null;
            // Firebase'den gelen table_name ve table_type'Ä± da gÃ¼ncelle
            if (firebaseData.table_name) {
              allStaticTables[tableId].table_name = firebaseData.table_name;
            }
            if (firebaseData.table_type) {
              allStaticTables[tableId].table_type = firebaseData.table_type;
            }
            console.log(`âœ… Masa gÃ¼ncellendi: ${tableId} - Dolu: ${allStaticTables[tableId].is_occupied}, Tutar: ${allStaticTables[tableId].total_amount}`);
          } else {
            // Firebase'de var ama statik listede yok - yeni masa ekle (dinamik)
            allStaticTables[tableId] = {
              table_id: tableId,
              table_name: firebaseData.table_name || tableId,
              table_type: firebaseData.table_type || 'table',
              table_number: firebaseData.table_number || parseInt(tableId.replace(/\D/g, '')) || 0,
              is_occupied: firebaseData.is_occupied === true || 
                          firebaseData.is_occupied === 'true' || 
                          firebaseData.is_occupied === 1 ||
                          (firebaseData.items && Array.isArray(firebaseData.items) && firebaseData.items.length > 0),
              total_amount: parseFloat(firebaseData.total_amount || 0),
              items: Array.isArray(firebaseData.items) ? firebaseData.items : [],
              order_id: firebaseData.order_id || null,
              order_date: firebaseData.order_date || null,
              order_time: firebaseData.order_time || null,
              order_note: firebaseData.order_note || null
            };
            console.log(`â• Yeni masa eklendi: ${tableId}`);
          }
        });
        
        // Aktif masa sayÄ±sÄ±nÄ± her zaman gÃ¼ncelle (masalar sekmesinde olmasak bile)
        updateActiveTablesCount(calculateActiveTablesCount());

        // Render - sadece masalar sekmesindeyse render et
        if (activeTab !== 'tables') {
          return;
        }

        // Render iÅŸlemini requestAnimationFrame ile optimize et - yanÄ±p sÃ¶nmeyi Ã¶nler
        requestAnimationFrame(() => {
          // Tekrar aktif sekme kontrolÃ¼
          if (activeTab !== 'tables') {
            return;
          }

          // TÃ¼m masalarÄ± render et
          renderAllTables(allStaticTables);
        });
      }, (error) => {
        console.error('Masalar yÃ¼klenirken hata:', error);
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">âš ï¸</div>
            <h3>Masalar yÃ¼klenemedi</h3>
            <p>${error.message || 'Bilinmeyen hata'}</p>
          </div>
        `;
      });
    }

    // Masa kartÄ± render et
    function renderTableCard(table) {
      // Masa durumunu saÄŸlam bir ÅŸekilde kontrol et
      const isOccupied = table.is_occupied === true || 
                        table.is_occupied === 'true' || 
                        table.is_occupied === 1 ||
                        (table.status && (table.status === 'occupied' || table.status === 'dolu')) ||
                        (table.items && Array.isArray(table.items) && table.items.length > 0);
      
      const totalAmount = parseFloat(table.total_amount || 0);
      const items = Array.isArray(table.items) ? table.items : [];
      const itemsCount = items.reduce((sum, item) => sum + (item.quantity || 0), 0);
      
      const isTable =
        table.table_type === 'table' ||
        table.table_type === 'inside' ||
        table.table_type === 'outside' ||
        table.table_id.startsWith('masa-') ||
        table.table_id.startsWith('inside-') ||
        table.table_id.startsWith('outside-');
      const isPackage = table.table_type === 'package' || table.table_id.startsWith('paket-');
      
      // Renkleri belirle
      let bgColor, borderColor, statusColor, statusText;
      if (isOccupied) {
        // Dolu masalar: kan kÄ±rmÄ±zÄ±
        bgColor = '#dc2626';
        borderColor = '#b91c1c';
        statusColor = '#ffffff';
        statusText = 'Dolu';
      } else {
        // BoÅŸ masalar
        if (isTable) {
          // Masalar: tema rengi ile aÃ§Ä±k ton
          const rgb = hexToRgb(themeColor || '#f97316');
          if (rgb) {
            bgColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.1)`;
            borderColor = `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.3)`;
            statusColor = themeColor || '#f97316';
          } else {
            // Fallback iÃ§in varsayÄ±lan renkler (tema rengi yÃ¼klenemezse)
            bgColor = '#fce7f3';
            borderColor = '#f9a8d4';
            statusColor = themeColor || '#f97316';
          }
        } else if (isPackage) {
          // Paket masalarÄ±: aÃ§Ä±k sarÄ±
          bgColor = '#fef3c7';
          borderColor = '#fde68a';
          statusColor = '#d97706';
        } else {
          // VarsayÄ±lan
          bgColor = '#f3f4f6';
          borderColor = '#d1d5db';
          statusColor = '#6b7280';
        }
        statusText = 'BoÅŸ';
      }
      
      let itemsHtml = '';
      if (isOccupied && items.length > 0) {
        itemsHtml = `
          <div class="table-items">
            <div class="table-items-title">Ä°Ã§erik:</div>
            <div class="table-items-list">
              ${items.slice(0, 5).map(item => `
                <div class="table-item">
                  <span class="item-name">${item.product_name}</span>
                  <span class="item-quantity">x${item.quantity}</span>
                  ${item.isGift ? '<span class="item-gift">Ä°KRAM</span>' : ''}
                </div>
              `).join('')}
              ${items.length > 5 ? `<div class="table-item-more">+${items.length - 5} daha...</div>` : ''}
            </div>
          </div>
        `;
      }

      // Dolu masalar iÃ§in modern gradient kÄ±rmÄ±zÄ± tasarÄ±m
      if (isOccupied) {
        return `
          <div class="table-card table-card-occupied">
            <div class="table-card-gradient">
              <div class="table-number-occupied">${table.table_number}</div>
              <div class="table-amount-occupied">â‚º${totalAmount.toFixed(2)}</div>
            </div>
          </div>
        `;
      }

      // BoÅŸ masalar iÃ§in mevcut tasarÄ±m
      return `
        <div class="table-card ${(!isOccupied && (table.table_id.startsWith('inside-') || table.table_id.startsWith('outside-'))) ? 'inside-empty' : ''}" style="background: ${bgColor}; border-color: ${borderColor};">
          <div class="table-card-header">
            <div class="table-number" style="color: var(--text-main);">${table.table_number}</div>
            <div class="table-status" style="background: ${statusColor}20; color: ${statusColor};">
              ${statusText}
            </div>
          </div>
          <div class="table-name" style="color: var(--text-main);">${table.table_name}</div>
        </div>
      `;
    }

    // Personel DetaylarÄ± render et
    // Ä°ptaller listesini render et
    function renderCancels() {
      const container = document.getElementById('cancelsContainer');
      if (!container) return;

      if (!db) {
        container.innerHTML = '<div class="error-message">Firebase baÄŸlantÄ±sÄ± kurulamadÄ±</div>';
        return;
      }

      // Loading gÃ¶ster
      container.innerHTML = `
        <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
          <div style="font-size: 48px; margin-bottom: 16px;">â³</div>
          <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">Ä°ptal kayÄ±tlarÄ± yÃ¼kleniyor...</div>
        </div>
      `;

      // Firebase'den iptal kayÄ±tlarÄ±nÄ± Ã§ek
      const cancelsRef = db.collection('cancels');
      
      // Ã–nce created_at ile sÄ±ralamayÄ± dene
      cancelsRef.orderBy('created_at', 'desc').get().then((querySnapshot) => {
        const cancels = [];
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          cancels.push({
            id: doc.id,
            ...data
          });
        });

        if (cancels.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
              <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“­</div>
              <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">HenÃ¼z iptal kaydÄ± yok</div>
              <div style="font-size: 14px;">Ä°ptal edilen Ã¼rÃ¼nler burada gÃ¶rÃ¼necek</div>
            </div>
          `;
          return;
        }

        let html = '<div class="cancels-list">';
        
        cancels.forEach((cancel) => {
          const cancelDate = cancel.cancel_date || 'Bilinmeyen';
          const cancelTime = cancel.cancel_time || '';
          const staffName = cancel.staff_name || 'Bilinmiyor';
          const orderStaffName = cancel.order_staff_name || 'Bilinmiyor';
          const staffIsManager = cancel.staff_is_manager || false;
          const source = cancel.source === 'mobile' ? 'ğŸ“± Mobil' : 'ğŸ’» MasaÃ¼stÃ¼';
          const totalAmount = (cancel.price || 0) * (cancel.quantity || 0);
          
          html += `
            <div class="cancel-card">
              <div class="cancel-header">
                <div class="cancel-header-left">
                  <div class="cancel-product-name">${cancel.product_name || 'Bilinmeyen ÃœrÃ¼n'}</div>
                  <div class="cancel-meta">
                    <span class="cancel-meta-item">${cancelDate} ${cancelTime}</span>
                    <span class="cancel-meta-separator">â€¢</span>
                    <span class="cancel-meta-item">${cancel.table_name || 'Bilinmeyen Masa'}</span>
                    <span class="cancel-meta-separator">â€¢</span>
                    <span class="cancel-meta-item">${source}</span>
                  </div>
                </div>
                <div class="cancel-header-right">
                  <div class="cancel-amount">â‚º${totalAmount.toFixed(2)}</div>
                </div>
              </div>
              <div class="cancel-details">
                <div class="cancel-detail-row">
                  <span class="cancel-detail-label">Miktar:</span>
                  <span class="cancel-detail-value">${cancel.quantity || 0} adet</span>
                </div>
                <div class="cancel-detail-row">
                  <span class="cancel-detail-label">Birim Fiyat:</span>
                  <span class="cancel-detail-value">â‚º${(cancel.price || 0).toFixed(2)}</span>
                </div>
                <div class="cancel-detail-row">
                  <span class="cancel-detail-label">Ä°ptal Eden Personel:</span>
                  <span class="cancel-detail-value">
                    ${staffName || 'Bilinmiyor'}${staffIsManager ? ' (MÃ¼dÃ¼r)' : ''}
                  </span>
                </div>
                <div class="cancel-detail-row">
                  <span class="cancel-detail-label">SipariÅŸ Sorumlusu Garson:</span>
                  <span class="cancel-detail-value">${orderStaffName || 'Bilinmiyor'}</span>
                </div>
              </div>
              <div class="cancel-reason">
                <div class="cancel-reason-label">Ä°ptal AÃ§Ä±klamasÄ±:</div>
                <div class="cancel-reason-text">${cancel.cancel_reason || 'AÃ§Ä±klama yok'}</div>
              </div>
            </div>
          `;
        });

        html += '</div>';
        container.innerHTML = html;
      }).catch((error) => {
        console.error('Ä°ptal kayÄ±tlarÄ± yÃ¼klenirken hata:', error);
        
        // EÄŸer created_at field'Ä± yoksa veya index hatasÄ± varsa, tÃ¼m kayÄ±tlarÄ± Ã§ek ve manuel sÄ±rala
        if ((error.message && (error.message.includes('created_at') || error.message.includes('index'))) || error.code === 'failed-precondition') {
          cancelsRef.get().then((querySnapshot) => {
            const cancels = [];
            querySnapshot.forEach((doc) => {
              const data = doc.data();
              cancels.push({
                id: doc.id,
                ...data
              });
            });

            // Tarihe gÃ¶re manuel sÄ±rala
            cancels.sort((a, b) => {
              const dateA = a.cancel_date || '';
              const dateB = b.cancel_date || '';
              const timeA = a.cancel_time || '';
              const timeB = b.cancel_time || '';
              if (dateA !== dateB) return dateB.localeCompare(dateA);
              return timeB.localeCompare(timeA);
            });

            if (cancels.length === 0) {
              container.innerHTML = `
                <div style="text-align: center; padding: 60px 20px; color: #6b7280;">
                  <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“­</div>
                  <div style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">HenÃ¼z iptal kaydÄ± yok</div>
                  <div style="font-size: 14px;">Ä°ptal edilen Ã¼rÃ¼nler burada gÃ¶rÃ¼necek</div>
                </div>
              `;
              return;
            }

            let html = '<div class="cancels-list">';
            
            cancels.forEach((cancel) => {
              const cancelDate = cancel.cancel_date || 'Bilinmeyen';
              const cancelTime = cancel.cancel_time || '';
              const staffName = cancel.staff_name || 'Bilinmiyor';
              const orderStaffName = cancel.order_staff_name || 'Bilinmiyor';
              const staffIsManager = cancel.staff_is_manager || false;
              const source = cancel.source === 'mobile' ? 'ğŸ“± Mobil' : 'ğŸ’» MasaÃ¼stÃ¼';
              const totalAmount = (cancel.price || 0) * (cancel.quantity || 0);
              
              html += `
                <div class="cancel-card">
                  <div class="cancel-header">
                    <div class="cancel-header-left">
                      <div class="cancel-product-name">${cancel.product_name || 'Bilinmeyen ÃœrÃ¼n'}</div>
                      <div class="cancel-meta">
                        <span class="cancel-meta-item">${cancelDate} ${cancelTime}</span>
                        <span class="cancel-meta-separator">â€¢</span>
                        <span class="cancel-meta-item">${cancel.table_name || 'Bilinmeyen Masa'}</span>
                        <span class="cancel-meta-separator">â€¢</span>
                        <span class="cancel-meta-item">${source}</span>
                      </div>
                    </div>
                    <div class="cancel-header-right">
                      <div class="cancel-amount">â‚º${totalAmount.toFixed(2)}</div>
                    </div>
                  </div>
                  <div class="cancel-details">
                    <div class="cancel-detail-row">
                      <span class="cancel-detail-label">Miktar:</span>
                      <span class="cancel-detail-value">${cancel.quantity || 0} adet</span>
                    </div>
                    <div class="cancel-detail-row">
                      <span class="cancel-detail-label">Birim Fiyat:</span>
                      <span class="cancel-detail-value">â‚º${(cancel.price || 0).toFixed(2)}</span>
                    </div>
                    <div class="cancel-detail-row">
                      <span class="cancel-detail-label">Ä°ptal Eden Personel:</span>
                      <span class="cancel-detail-value">
                        ${staffName || 'Bilinmiyor'}${staffIsManager ? ' (MÃ¼dÃ¼r)' : ''}
                      </span>
                    </div>
                    <div class="cancel-detail-row">
                      <span class="cancel-detail-label">SipariÅŸ Sorumlusu Garson:</span>
                      <span class="cancel-detail-value">${orderStaffName || 'Bilinmiyor'}</span>
                    </div>
                  </div>
                  <div class="cancel-reason">
                    <div class="cancel-reason-label">Ä°ptal AÃ§Ä±klamasÄ±:</div>
                    <div class="cancel-reason-text">${cancel.cancel_reason || 'AÃ§Ä±klama yok'}</div>
                  </div>
                </div>
              `;
            });

            html += '</div>';
            container.innerHTML = html;
          }).catch((fallbackError) => {
            console.error('Ä°ptal kayÄ±tlarÄ± yÃ¼klenirken hata (fallback):', fallbackError);
            container.innerHTML = `
              <div class="error-message">
                <div style="font-size: 24px; margin-bottom: 12px;">âš ï¸</div>
                <div>Ä°ptal kayÄ±tlarÄ± yÃ¼klenirken bir hata oluÅŸtu</div>
                <div style="font-size: 12px; margin-top: 8px; color: #9ca3af;">${fallbackError.message}</div>
              </div>
            `;
          });
        } else {
          container.innerHTML = `
            <div class="error-message">
              <div style="font-size: 24px; margin-bottom: 12px;">âš ï¸</div>
              <div>Ä°ptal kayÄ±tlarÄ± yÃ¼klenirken bir hata oluÅŸtu</div>
              <div style="font-size: 12px; margin-top: 8px; color: #9ca3af;">${error.message}</div>
            </div>
          `;
        }
      });
    }

    // GÃ¼nlÃ¼k Ciro DetaylarÄ± Modal HTML'ini ekle
    function addDailyRevenueModal() {
      // Modal zaten varsa ekleme
      if (document.getElementById('dailyRevenueModal')) return;

      const modal = document.createElement('div');
      modal.id = 'dailyRevenueModal';
      modal.className = 'daily-revenue-modal';
      modal.innerHTML = `
        <div class="daily-revenue-modal-overlay" onclick="closeDailyRevenueModal()"></div>
        <div class="daily-revenue-modal-content">
          <div class="daily-revenue-modal-header">
            <h2>ğŸ“Š GÃ¼nlÃ¼k Ciro DetaylarÄ±</h2>
            <button class="daily-revenue-modal-close" onclick="closeDailyRevenueModal()">Ã—</button>
          </div>
          <div id="dailyRevenueModalContent" class="daily-revenue-modal-body">
            <!-- Ä°Ã§erik dinamik olarak doldurulacak -->
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    // Toast Notification FonksiyonlarÄ±
    function showToast(type, title, message) {
      // Mevcut toast'Ä± kaldÄ±r
      const existingToast = document.getElementById('toastNotification');
      if (existingToast) {
        existingToast.remove();
      }

      // Yeni toast oluÅŸtur
      const toast = document.createElement('div');
      toast.id = 'toastNotification';
      toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10001;
        background: ${type === 'success' ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'};
        color: white;
        padding: 20px 24px;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1) inset;
        display: flex;
        align-items: center;
        gap: 16px;
        min-width: 320px;
        max-width: 420px;
        animation: toastSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        backdrop-filter: blur(10px);
      `;

      const icon = type === 'success' 
        ? '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg>'
        : '<svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>';

      toast.innerHTML = `
        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
          ${icon}
        </div>
        <div style="flex: 1;">
          <div style="font-size: 14px; font-weight: 700; margin-bottom: 4px; opacity: 0.95;">${title}</div>
          <div style="font-size: 15px; font-weight: 500; line-height: 1.4;">${message}</div>
        </div>
        <button onclick="hideToast()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 28px; height: 28px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
          <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      `;

      document.body.appendChild(toast);

      // Otomatik kapat (3 saniye)
      setTimeout(() => {
        hideToast();
      }, 3000);
    }

    function hideToast() {
      const toast = document.getElementById('toastNotification');
      if (toast) {
        toast.style.animation = 'toastSlideOut 0.3s ease forwards';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }
    }

    // â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” YÃ¶netim (Stok / Fiyat) â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
    let mgmtProducts = []; // { docId, name, price, category_id, categoryName, trackStock, ... }
    let mgmtCategoriesMap = {}; // id -> name
    let mgmtBranch = null; // 'SANCAK' | 'SEKER'
    let mgmtBranchStocks = {}; // productId(string) -> number
    let mgmtLoading = false;
    let mgmtPriceCategoryId = 'ALL'; // 'ALL' | category_id(string) | 'no-category'
    const MGMT_ALLOWED_STOCK_CATEGORIES = new Set(['icecekler', 'yan urunler']); // sadece bu iki kategori

    function mgmtNormalizeText(input) {
      try {
        return String(input || '')
          .toLocaleLowerCase('tr-TR')
          .normalize('NFD')
          .replace(/[\u0300-\u036f]/g, '') // diacritics
          .replace(/\s+/g, ' ')
          .trim();
      } catch (e) {
        return String(input || '').toLowerCase().trim();
      }
    }

    function mgmtIsAllowedStockCategory(product) {
      const catName =
        (product && product.categoryName) ||
        (product && product.category_id != null ? (mgmtCategoriesMap[String(product.category_id)] || '') : '') ||
        '';
      const norm = mgmtNormalizeText(catName);
      return MGMT_ALLOWED_STOCK_CATEGORIES.has(norm);
    }

    function mgmtGetCategoryInfo(product) {
      const id = (product && product.category_id != null) ? String(product.category_id) : 'no-category';
      const name =
        (product && product.categoryName) ||
        (id !== 'no-category' ? (mgmtCategoriesMap[String(id)] || ('Kategori #' + String(id))) : 'DiÄŸer');
      return { id, name };
    }

    function mgmtGetPriceCategories() {
      const map = new Map(); // id -> { id, name, count }
      (mgmtProducts || []).forEach((p) => {
        const info = mgmtGetCategoryInfo(p);
        if (!map.has(info.id)) map.set(info.id, { id: info.id, name: info.name, count: 0 });
        map.get(info.id).count += 1;
      });
      return Array.from(map.values()).sort((a, b) => (a.name || '').localeCompare((b.name || ''), 'tr'));
    }

    function mgmtSelectPriceCategory(categoryId) {
      mgmtPriceCategoryId = categoryId || 'ALL';
      mgmtRenderPriceCategoryTabs();
      mgmtRenderPriceList();
    }

    function mgmtRenderPriceCategoryTabs() {
      const tabsEl = document.getElementById('mgmtPriceCategoryTabs');
      if (!tabsEl) return;

      const cats = mgmtGetPriceCategories();
      const allCount = (mgmtProducts || []).length;
      const tabs = [{ id: 'ALL', name: 'TÃ¼mÃ¼', count: allCount }, ...cats];
      const activeId = mgmtPriceCategoryId || 'ALL';

      tabsEl.innerHTML = tabs.map((t) => {
        const isActive = String(t.id) === String(activeId);
        return `
          <button type="button" class="mgmt-tab ${isActive ? 'active' : ''}" onclick="mgmtSelectPriceCategory('${String(t.id).replace(/'/g, "\\'")}')">
            <span>${t.name}</span>
            <span class="mgmt-tab-count">${t.count}</span>
          </button>
        `;
      }).join('');

      const hint = document.getElementById('mgmtPriceHint');
      if (hint) {
        const activeTab = tabs.find(t => String(t.id) === String(activeId)) || tabs[0];
        hint.textContent = `Kategori: ${activeTab?.name || 'TÃ¼mÃ¼'} â€¢ ${activeTab?.count ?? allCount} Ã¼rÃ¼n`;
      }
    }

    function getOrCreateMgmtDeviceId() {
      try {
        const existing = localStorage.getItem(MGMT_DEVICE_ID_STORAGE_KEY);
        if (existing) return existing;
        const id = (typeof crypto !== 'undefined' && crypto && typeof crypto.randomUUID === 'function')
          ? crypto.randomUUID()
          : ('dev_' + Date.now() + '_' + Math.random().toString(16).slice(2));
        localStorage.setItem(MGMT_DEVICE_ID_STORAGE_KEY, id);
        return id;
      } catch (e) {
        return 'dev_' + Date.now() + '_' + Math.random().toString(16).slice(2);
      }
    }

    function getSavedMgmtBranch() {
      try {
        const v = localStorage.getItem(MGMT_BRANCH_STORAGE_KEY);
        return (v === 'SANCAK' || v === 'SEKER') ? v : null;
      } catch (e) {
        return null;
      }
    }

    async function mgmtPersistBranchSelection(branch) {
      try {
        localStorage.setItem(MGMT_BRANCH_STORAGE_KEY, branch);
      } catch (e) {
        // ignore
      }

      // Firebase'e cihaz ÅŸube kaydÄ± (gecedonercisimasalar)
      try {
        if (!geceMasalarDb) return;
        const deviceId = getOrCreateMgmtDeviceId();
        await geceMasalarDb.collection('deviceBranches').doc(String(deviceId)).set({
          tenantId: GECE_TENANT_ID,
          deviceId: String(deviceId),
          branch: branch,
          source: 'admin-dashboard',
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
      } catch (e) {
        console.warn('deviceBranches yazÄ±lamadÄ±:', e);
      }
    }

    function openManagementOverlay() {
      const overlay = document.getElementById('managementOverlay');
      if (!overlay) return;
      overlay.style.display = 'flex';
      openManagementSection('home');
    }

    function closeManagementOverlay() {
      const overlay = document.getElementById('managementOverlay');
      if (!overlay) return;
      overlay.style.display = 'none';
    }

    async function openManagementSection(section) {
      const home = document.getElementById('managementHome');
      const stock = document.getElementById('managementStock');
      const price = document.getElementById('managementPrice');
      if (!home || !stock || !price) return;

      home.style.display = section === 'home' ? 'block' : 'none';
      stock.style.display = section === 'stock' ? 'block' : 'none';
      price.style.display = section === 'price' ? 'block' : 'none';

      if (section === 'stock') {
        await mgmtInitIfNeeded();
        const saved = getSavedMgmtBranch();
        if (saved) {
          mgmtSelectBranch(saved);
        } else {
          mgmtBranch = null;
          mgmtBranchStocks = {};
          const b1 = document.getElementById('branchBtn_SANCAK');
          const b2 = document.getElementById('branchBtn_SEKER');
          if (b1) b1.classList.remove('active');
          if (b2) b2.classList.remove('active');
          const hint = document.getElementById('mgmtStockHint');
          if (hint) hint.textContent = 'Åube seÃ§imi zorunludur. LÃ¼tfen SANCAK veya ÅEKER ÅŸubesini seÃ§in.';
          showToast('error', 'Zorunlu', 'Stok iÅŸlemleri iÃ§in Ã¶nce ÅŸube seÃ§iniz.');
          mgmtRenderStockList();
        }
      }

      if (section === 'price') {
        await mgmtInitIfNeeded();
        mgmtRenderPriceCategoryTabs();
        mgmtRenderPriceList();
      }
    }

    async function mgmtInitIfNeeded() {
      if (mgmtLoading) return;
      if (!db || !db.collection) {
        showToast('error', 'Hata', 'VeritabanÄ± baÄŸlantÄ±sÄ± hazÄ±r deÄŸil.');
        return;
      }
      if (mgmtProducts && mgmtProducts.length > 0) return;

      mgmtLoading = true;
      try {
        // Kategoriler
        mgmtCategoriesMap = {};
        try {
          const catSnap = await db.collection('categories').get();
          if (catSnap && catSnap.forEach) {
            catSnap.forEach((doc) => {
              const data = doc.data() || {};
              const id = data.id != null ? String(data.id) : String(doc.id);
              if (data.name) mgmtCategoriesMap[id] = data.name;
            });
          }
        } catch (e) {
          // kategori yoksa sorun deÄŸil
        }

        // ÃœrÃ¼nler
        const prodSnap = await db.collection('products').get();
        const list = [];
        if (prodSnap && prodSnap.forEach) {
          prodSnap.forEach((doc) => {
            const p = doc.data() || {};
            const productId = (p.id != null) ? String(p.id) : String(doc.id);
            const categoryId = p.category_id != null ? String(p.category_id) : '';
            list.push({
              docId: doc.id,
              productId,
              name: p.name || ('ÃœrÃ¼n #' + productId),
              category_id: categoryId,
              categoryName: p.categoryName || mgmtCategoriesMap[categoryId] || '',
              price: (p.price != null) ? Number(p.price) : 0,
              trackStock: p.trackStock === true,
              stock: (p.stock != null) ? Number(p.stock) : 0,
              // opsiyonel platform fiyatlarÄ± (varsa)
              yemeksepeti_price: (p.yemeksepeti_price != null) ? Number(p.yemeksepeti_price) : null,
              trendyolgo_price: (p.trendyolgo_price != null) ? Number(p.trendyolgo_price) : null,
              migros_yemek_price: (p.migros_yemek_price != null) ? Number(p.migros_yemek_price) : null
            });
          });
        }

        list.sort((a, b) => (a.name || '').localeCompare((b.name || ''), 'tr'));
        mgmtProducts = list;
      } catch (e) {
        console.error('YÃ¶netim Ã¼rÃ¼nleri yÃ¼klenemedi:', e);
        showToast('error', 'Hata', 'ÃœrÃ¼nler yÃ¼klenemedi: ' + (e.message || 'Bilinmeyen hata'));
      } finally {
        mgmtLoading = false;
      }
    }

    async function mgmtSelectBranch(branch) {
      if (branch !== 'SANCAK' && branch !== 'SEKER') return;
      mgmtBranch = branch;
      await mgmtPersistBranchSelection(branch);

      const b1 = document.getElementById('branchBtn_SANCAK');
      const b2 = document.getElementById('branchBtn_SEKER');
      if (b1) b1.classList.toggle('active', branch === 'SANCAK');
      if (b2) b2.classList.toggle('active', branch === 'SEKER');

      await mgmtLoadBranchStocks();
      mgmtRenderStockList();
    }

    async function mgmtLoadBranchStocks() {
      mgmtBranchStocks = {};
      const hint = document.getElementById('mgmtStockHint');
      if (hint) hint.textContent = `Åube: ${mgmtBranch === 'SEKER' ? 'ÅEKER' : 'SANCAK'} â€¢ Sadece â€œÄ°Ã§eceklerâ€ ve â€œYan ÃœrÃ¼nlerâ€ listelenir.`;

      if (!geceMasalarDb) {
        if (hint) hint.textContent = 'Åube stok veritabanÄ± baÄŸlantÄ±sÄ± hazÄ±r deÄŸil. (gecedonercisimasalar)';
        return;
      }

      try {
        const snap = await geceMasalarDb.collection('branchStocks').where('branch', '==', mgmtBranch).get();
        if (snap && snap.forEach) {
          snap.forEach((doc) => {
            const d = doc.data() || {};
            const pid = d.productId != null ? String(d.productId) : String(doc.id).split('_').pop();
            mgmtBranchStocks[pid] = Number(d.stock || 0);
          });
        }
      } catch (e) {
        console.warn('branchStocks okunamadÄ±:', e);
      }
    }

    function mgmtRenderStockList() {
      const listEl = document.getElementById('mgmtStockList');
      if (!listEl) return;
      const qRaw = (document.getElementById('mgmtStockSearch')?.value || '');
      const q = mgmtNormalizeText(qRaw);

      const filtered = mgmtProducts.filter((p) => {
        // Gece DÃ¶nercisi: stok yÃ¶netiminde sadece Ä°Ã§ecekler + Yan ÃœrÃ¼nler
        if (!mgmtIsAllowedStockCategory(p)) return false;
        if (!q) return true;
        return mgmtNormalizeText(p.name || '').includes(q);
      });

      if (!mgmtBranch) {
        listEl.innerHTML = `<div class="error-message"><div style="font-size:24px; margin-bottom:10px;">âš ï¸</div><div>Ã–nce ÅŸube seÃ§iniz.</div></div>`;
        return;
      }

      if (!filtered.length) {
        listEl.innerHTML = `<div class="error-message"><div style="font-size:24px; margin-bottom:10px;">ğŸ”</div><div>Bu ÅŸubede stok iÃ§in gÃ¶sterilecek Ã¼rÃ¼n bulunamadÄ±</div><div style="font-size:12px; margin-top:8px; color:#9ca3af;">Sadece â€œÄ°Ã§eceklerâ€ ve â€œYan ÃœrÃ¼nlerâ€ kategorileri listelenir.</div></div>`;
        return;
      }

      listEl.innerHTML = filtered.map((p) => {
        const pid = String(p.productId);
        const current = (mgmtBranchStocks[pid] != null) ? mgmtBranchStocks[pid] : 0;
        const catText = p.categoryName ? p.categoryName : (p.category_id ? ('Kategori #' + p.category_id) : '');
        const pillClass = current <= 0 ? 'management-pill is-zero' : 'management-pill';
        return `
          <div class="management-row stock-row">
            <div class="mgmt-stock-left">
              <div class="management-row-title">${p.name}</div>
              <div class="management-row-sub">${catText}${catText ? ' â€¢ ' : ''}ID: ${pid}</div>
            </div>
            <div class="mgmt-stock-right">
              <div class="${pillClass}">Stok: ${current}</div>
              <div class="mgmt-stock-controls">
                <input class="management-input mgmt-stock-input" id="mgmtStockAmount_${pid}" inputmode="numeric" placeholder="Miktar" autocomplete="off" />
                <div class="mgmt-stock-actions">
                  <button class="mgmt-action-btn add" onclick="mgmtAdjustStock('${pid}', 'add')">+ Ekle</button>
                  <button class="mgmt-action-btn sub" onclick="mgmtAdjustStock('${pid}', 'sub')">âˆ’ Ã‡Ä±kar</button>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function mgmtAdjustStock(productId, mode) {
      if (!mgmtBranch) {
        showToast('error', 'Hata', 'Ã–nce ÅŸube seÃ§iniz.');
        return;
      }
      if (!geceMasalarDb) {
        showToast('error', 'Hata', 'Åube stok veritabanÄ± baÄŸlantÄ±sÄ± hazÄ±r deÄŸil.');
        return;
      }

      const input = document.getElementById('mgmtStockAmount_' + productId);
      const amount = parseInt((input && input.value) ? input.value : '0', 10);
      if (!amount || amount <= 0) {
        showToast('error', 'Hata', 'GeÃ§erli bir miktar giriniz.');
        return;
      }

      const delta = mode === 'sub' ? -amount : amount;
      const docId = mgmtBranch + '_' + String(productId);
      const ref = geceMasalarDb.collection('branchStocks').doc(docId);
      const deviceId = getOrCreateMgmtDeviceId();

      try {
        const result = await geceMasalarDb.runTransaction(async (t) => {
          const snap = await t.get(ref);
          const before = snap.exists ? Number((snap.data() || {}).stock || 0) : 0;
          let after = before + delta;
          if (after < 0) after = 0;

          t.set(ref, {
            tenantId: GECE_TENANT_ID,
            branch: mgmtBranch,
            productId: String(productId),
            stock: after,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedByDeviceId: String(deviceId)
          }, { merge: true });

          return { before, after };
        });

        // Hareket kaydÄ± (opsiyonel)
        try {
          await geceMasalarDb.collection('branchStockMoves').add({
            tenantId: GECE_TENANT_ID,
            branch: mgmtBranch,
            productId: String(productId),
            delta: delta,
            before: result.before,
            after: result.after,
            deviceId: String(deviceId),
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        } catch (e) {
          // history zorunlu deÄŸil
        }

        mgmtBranchStocks[String(productId)] = result.after;
        showToast('success', 'BaÅŸarÄ±lÄ±', `Stok gÃ¼ncellendi. Yeni stok: ${result.after}`);
        mgmtRenderStockList();
      } catch (e) {
        console.error('Stok gÃ¼ncelleme hatasÄ±:', e);
        showToast('error', 'Hata', 'Stok gÃ¼ncellenemedi: ' + (e.message || 'Bilinmeyen hata'));
      }
    }

    function mgmtRenderPriceList() {
      const listEl = document.getElementById('mgmtPriceList');
      if (!listEl) return;
      const qRaw = (document.getElementById('mgmtPriceSearch')?.value || '');
      const q = mgmtNormalizeText(qRaw);

      const filtered = mgmtProducts.filter((p) => {
        if (mgmtPriceCategoryId && mgmtPriceCategoryId !== 'ALL') {
          const info = mgmtGetCategoryInfo(p);
          if (String(info.id) !== String(mgmtPriceCategoryId)) return false;
        }
        if (!q) return true;
        return mgmtNormalizeText(p.name || '').includes(q);
      });

      if (!filtered.length) {
        listEl.innerHTML = `<div class="error-message"><div style="font-size:24px; margin-bottom:10px;">ğŸ”</div><div>ÃœrÃ¼n bulunamadÄ±</div></div>`;
        return;
      }

      listEl.innerHTML = filtered.map((p) => {
        const pid = String(p.productId);
        const currentPrice = (p.price != null && !isNaN(p.price)) ? Number(p.price) : 0;
        const catText = p.categoryName ? p.categoryName : (p.category_id ? (mgmtCategoriesMap[String(p.category_id)] || ('Kategori #' + p.category_id)) : 'DiÄŸer');
        return `
          <div class="management-row price-row">
            <div>
              <div class="management-row-title">${p.name}</div>
              <div class="management-row-sub">${catText}${catText ? ' â€¢ ' : ''}ID: ${pid}</div>
            </div>
            <div class="mgmt-price-controls">
              <div class="management-pill">â‚º ${currentPrice.toFixed(2)}</div>
              <input class="management-input mgmt-price-input" id="mgmtPrice_${pid}" inputmode="decimal" placeholder="Yeni fiyat" value="" />
              <button type="button" class="mgmt-action-btn save mgmt-save-btn" onclick="mgmtSavePrice('${pid}')" title="Kaydet">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 6L9 17l-5-5"/>
                </svg>
                <span class="mgmt-save-text">Kaydet</span>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    async function mgmtSavePrice(productId) {
      if (!db || !db.collection) {
        showToast('error', 'Hata', 'VeritabanÄ± baÄŸlantÄ±sÄ± hazÄ±r deÄŸil.');
        return;
      }
      const input = document.getElementById('mgmtPrice_' + productId);
      const raw = (input && input.value) ? String(input.value).replace(',', '.').trim() : '';
      const val = Number(raw);
      if (!raw || isNaN(val) || val < 0) {
        showToast('error', 'Hata', 'GeÃ§erli bir fiyat giriniz.');
        return;
      }

      const item = mgmtProducts.find((p) => String(p.productId) === String(productId));
      if (!item) {
        showToast('error', 'Hata', 'ÃœrÃ¼n bulunamadÄ±.');
        return;
      }

      try {
        await db.collection('products').doc(item.docId).update({
          price: val,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        item.price = val;
        showToast('success', 'BaÅŸarÄ±lÄ±', 'Fiyat kaydedildi.');
        mgmtRenderPriceList();
      } catch (e) {
        console.error('Fiyat kaydetme hatasÄ±:', e);
        showToast('error', 'Hata', 'Fiyat kaydedilemedi: ' + (e.message || 'Bilinmeyen hata'));
      }
    }

    // Mesaj GÃ¶nderme FonksiyonlarÄ±
    function showSendMessageModal() {
      document.getElementById('sendMessageModal').style.display = 'flex';
      document.getElementById('messageContentInput').value = '';
      document.getElementById('messageContentInput').focus();
    }

    function hideSendMessageModal() {
      document.getElementById('sendMessageModal').style.display = 'none';
    }

    async function sendBroadcastMessage() {
      const messageContent = document.getElementById('messageContentInput').value.trim();
      
      if (!messageContent || messageContent === '') {
        alert('LÃ¼tfen mesaj iÃ§eriÄŸi yazÄ±n');
        return;
      }

      const sendBtn = document.getElementById('sendMessageBtn');
      const sendBtnText = document.getElementById('sendMessageBtnText');
      const sendBtnSpinner = document.getElementById('sendMessageBtnSpinner');

      if (sendBtn) {
        sendBtn.disabled = true;
        if (sendBtnText) sendBtnText.textContent = 'GÃ¶nderiliyor...';
        if (sendBtnSpinner) sendBtnSpinner.style.display = 'block';
      }

      try {
        // Direkt Firebase'e mesaj kaydet (HTTPS Ã¼zerinden)
        const now = new Date();
        const messageDate = now.toLocaleDateString('tr-TR');
        const messageTime = now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        // Firebase'e direkt kaydet
        if (db) {
          await db.collection('broadcasts').add({
            message: messageContent,
            date: messageDate,
            time: messageTime,
            created_at: firebase.firestore.FieldValue.serverTimestamp()
          });
          
          showToast('success', 'BaÅŸarÄ±lÄ±', 'Mesaj baÅŸarÄ±yla gÃ¶nderildi!');
          hideSendMessageModal();
        } else {
          throw new Error('Firebase baÄŸlantÄ±sÄ± yok');
        }
      } catch (error) {
        console.error('Mesaj gÃ¶nderme hatasÄ±:', error);
        showToast('error', 'Hata', 'Mesaj gÃ¶nderilirken bir hata oluÅŸtu: ' + (error.message || 'Bilinmeyen hata'));
      } finally {
        if (sendBtn) {
          sendBtn.disabled = false;
          if (sendBtnText) sendBtnText.textContent = 'GÃ¶nder';
          if (sendBtnSpinner) sendBtnSpinner.style.display = 'none';
        }
      }
    }

    function renderStaffDetails() {
      const container = document.getElementById('staffContainer');
      if (!container) return;

      const reportSales = allSales.filter(sale => !sale.isExpense);
      const staffStats = {};
      
      reportSales.forEach(sale => {
        if (sale.items_array && Array.isArray(sale.items_array) && sale.items_array.length > 0) {
          const staffInThisSale = new Set();
          
          sale.items_array.forEach(item => {
            const itemStaffName = item.staff_name || sale.staff_name;
            
            if (!itemStaffName) return;
            
            staffInThisSale.add(itemStaffName);
            
            if (!staffStats[itemStaffName]) {
              staffStats[itemStaffName] = {
                name: itemStaffName,
                totalRevenue: 0,
                totalSales: 0,
                products: {},
                averageSale: 0,
                totalItemsSold: 0,
                totalGiftItems: 0
              };
            }
            
            const productName = item.product_name;
            const quantity = item.quantity || 0;
            const price = parseFloat(item.price || 0);
            const isGift = item.isGift || false;
            
            if (!isGift) {
              staffStats[itemStaffName].totalRevenue += (price * quantity);
            }
            
            if (!staffStats[itemStaffName].products[productName]) {
              staffStats[itemStaffName].products[productName] = {
                count: 0,
                revenue: 0
              };
            }
            
            staffStats[itemStaffName].products[productName].count += quantity;
            if (!isGift) {
              staffStats[itemStaffName].products[productName].revenue += (price * quantity);
            }
            
            staffStats[itemStaffName].totalItemsSold += quantity;
            if (isGift) {
              staffStats[itemStaffName].totalGiftItems += quantity;
            }
          });
          
          staffInThisSale.forEach(staffName => {
            if (staffStats[staffName]) {
              staffStats[staffName].totalSales += 1;
            }
          });
        } else if (sale.staff_name) {
          if (!staffStats[sale.staff_name]) {
            staffStats[sale.staff_name] = {
              name: sale.staff_name,
              totalRevenue: 0,
              totalSales: 0,
              products: {},
              averageSale: 0,
              totalItemsSold: 0,
              totalGiftItems: 0
            };
          }
          
          staffStats[sale.staff_name].totalRevenue += parseFloat(sale.total_amount);
          staffStats[sale.staff_name].totalSales += 1;
        }
      });
      
      Object.keys(staffStats).forEach(staffName => {
        const stats = staffStats[staffName];
        stats.averageSale = stats.totalSales > 0 ? stats.totalRevenue / stats.totalSales : 0;
      });
      
      const sortedStaff = Object.values(staffStats).sort((a, b) => b.totalRevenue - a.totalRevenue);
      
      if (sortedStaff.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">ğŸ‘¥</div>
            <h3>Personel satÄ±ÅŸ verisi bulunamadÄ±</h3>
            <p>HenÃ¼z personel satÄ±ÅŸ verisi yok</p>
          </div>
        `;
        return;
      }

      let html = `
        <div class="staff-container">
          <h2 class="staff-title">ğŸ‘¥ Personel DetaylarÄ±</h2>
          <div class="staff-grid">
            ${sortedStaff.map((staff, index) => {
              const topProducts = Object.entries(staff.products)
                .map(([name, data]) => [name, typeof data === 'object' ? data.count : data])
                .sort(([, a], [, b]) => b - a)
                .slice(0, 3);
              
              return `
                <div class="staff-card">
                  <div class="staff-header">
                    <div class="staff-avatar ${index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : ''}">
                      ${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : 'ğŸ‘¤'}
                    </div>
                    <div class="staff-info">
                      <h3 class="staff-name">${staff.name}</h3>
                      <p class="staff-sales-count">${staff.totalSales} satÄ±ÅŸ yaptÄ±</p>
                    </div>
                  </div>
                  
                  <div class="staff-stats-grid">
                    <div class="staff-stat-card green">
                      <p class="staff-stat-label">Toplam Ciro</p>
                      <p class="staff-stat-value">â‚º${staff.totalRevenue.toFixed(2)}</p>
                    </div>
                    <div class="staff-stat-card blue">
                      <p class="staff-stat-label">Ortalama SatÄ±ÅŸ</p>
                      <p class="staff-stat-value">â‚º${staff.averageSale.toFixed(2)}</p>
                    </div>
                    <div class="staff-stat-card purple">
                      <p class="staff-stat-label">Toplam SatÄ±ÅŸ</p>
                      <p class="staff-stat-value">${staff.totalSales}</p>
                    </div>
                    <div class="staff-stat-card orange">
                      <p class="staff-stat-label">Toplam ÃœrÃ¼n</p>
                      <p class="staff-stat-value">${staff.totalItemsSold || 0}</p>
                      ${staff.totalGiftItems > 0 ? `<p class="staff-stat-sub">(${staff.totalGiftItems} ikram)</p>` : ''}
                    </div>
                  </div>
                  
                  ${topProducts.length > 0 ? `
                    <div class="staff-top-products">
                      <h4 class="staff-top-products-title">En Ã‡ok SattÄ±ÄŸÄ± ÃœrÃ¼nler</h4>
                      <div class="staff-products-list">
                        ${topProducts.map(([productName, countOrData], idx) => {
                          const productData = typeof countOrData === 'object' ? countOrData : { count: countOrData, revenue: 0 };
                          const count = productData.count || 0;
                          const revenue = productData.revenue || 0;
                          
                          return `
                            <div class="staff-product-item">
                              <div class="staff-product-rank">${idx + 1}</div>
                              <div class="staff-product-info">
                                <span class="staff-product-name">${productName}</span>
                                ${revenue > 0 ? `<span class="staff-product-revenue">â‚º${revenue.toFixed(2)} kazandÄ±rdÄ±</span>` : ''}
                              </div>
                              <span class="staff-product-count">${count} adet</span>
                            </div>
                          `;
                        }).join('')}
                      </div>
                    </div>
                  ` : ''}
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;

      container.innerHTML = html;
    }

    // Modal dÄ±ÅŸÄ±na tÄ±klanÄ±nca kapat - sayfa yÃ¼klendiÄŸinde ekle
    function setupDateFilterModal() {
      document.addEventListener('click', function(event) {
        const modal = document.getElementById('dateFilterModal');
        const trigger = event.target.closest('.date-filter-trigger');
        const wrapper = event.target.closest('.date-filter-wrapper');
        
        if (modal && !wrapper) {
          modal.classList.remove('show');
        }
      });
    }

    // Analiz Modal FonksiyonlarÄ±
    function showAnalysisModal() {
      const modal = document.getElementById('analysisModal');
      if (!modal) return;
      
      modal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
      
      // Analizi baÅŸlat
      startAnalysis();
    }

    function closeAnalysisModal() {
      const modal = document.getElementById('analysisModal');
      if (!modal) return;
      
      modal.style.display = 'none';
      document.body.style.overflow = '';
      
      // Typing'i durdur
      if (typingInterval) {
        clearInterval(typingInterval);
        typingInterval = null;
      }
    }

    // GÃ¼nlÃ¼k Ciro Modal FonksiyonlarÄ±
    // Bu fonksiyon kaldÄ±rÄ±ldÄ± - Ä°lk showDailyRevenueModal fonksiyonu (satÄ±r 2229) kullanÄ±lÄ±yor
    // Ã‡Ã¼nkÃ¼ o fonksiyon daha detaylÄ± ve calculateSaleRevenue kullanÄ±yor

    // GÃ¼nlÃ¼k ciro hesaplama fonksiyonu - HER ZAMAN TÃœM ZAMANLARI GÃ–STER
    function calculateDailyRevenue() {
      // MasraflarÄ± filtrele
      let reportSales = allSales.filter(sale => 
        !sale.isExpense && sale.payment_method !== 'Masraf'
      );
      // Tarih filtresi uygulama - TÃœM ZAMANLARI gÃ¶ster
      // reportSales = filterSalesByDate(reportSales); // Bu satÄ±rÄ± kaldÄ±rdÄ±k
      
      // Tarih bazlÄ± gruplama
      const dailyRevenue = {};
      
      reportSales.forEach(sale => {
        if (!sale.sale_date || sale.sale_date === 'Bilinmeyen') return;
        
        const dateKey = sale.sale_date; // DD.MM.YYYY formatÄ±
        
        if (!dailyRevenue[dateKey]) {
          dailyRevenue[dateKey] = {
            date: dateKey,
            revenue: 0,
            salesCount: 0
          };
        }
        
        // total_amount kullanarak hesaplama yap
        const saleRevenue = parseFloat(sale.total_amount || 0);
        dailyRevenue[dateKey].revenue += saleRevenue;
        dailyRevenue[dateKey].salesCount += 1;
      });
      
      // Tarihe gÃ¶re sÄ±rala (en yeni en Ã¼stte)
      const sortedDates = Object.keys(dailyRevenue).sort((a, b) => {
        const [dayA, monthA, yearA] = a.split('.');
        const [dayB, monthB, yearB] = b.split('.');
        const dateA = new Date(yearA, monthA - 1, dayA);
        const dateB = new Date(yearB, monthB - 1, dayB);
        return dateB - dateA; // BÃ¼yÃ¼kten kÃ¼Ã§Ã¼ÄŸe
      });
      
      const result = sortedDates.map(dateKey => dailyRevenue[dateKey]);
      return result;
    }

    // GÃ¼nlÃ¼k ciro modal HTML oluÅŸturma
    function generateDailyRevenueModalHTML(dailyData) {
      if (!dailyData || dailyData.length === 0) {
        return `
          <div style="text-align: center; padding: 40px 20px; color: #64748b;">
            <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">ğŸ“Š</div>
            <div style="font-weight: 700; font-size: 16px; color: #475569; margin-bottom: 8px;">HenÃ¼z veri yok</div>
            <div style="font-size: 14px; color: #64748b;">HenÃ¼z satÄ±ÅŸ kaydÄ± bulunmuyor</div>
          </div>
        `;
      }
      
      const totalRevenue = dailyData.reduce((sum, day) => sum + day.revenue, 0);
      
      // Tarih formatÄ±nÄ± dÃ¼zenle (DD.MM.YYYY -> DD MMMM YYYY, GÃ¼n AdÄ±)
      const formatDate = (dateStr) => {
        const [day, month, year] = dateStr.split('.');
        const date = new Date(year, month - 1, day);
        const dayNames = ['Pazar', 'Pazartesi', 'SalÄ±', 'Ã‡arÅŸamba', 'PerÅŸembe', 'Cuma', 'Cumartesi'];
        const monthNames = ['Ocak', 'Åubat', 'Mart', 'Nisan', 'MayÄ±s', 'Haziran', 'Temmuz', 'AÄŸustos', 'EylÃ¼l', 'Ekim', 'KasÄ±m', 'AralÄ±k'];
        return {
          day: day,
          month: monthNames[parseInt(month) - 1],
          year: year,
          dayName: dayNames[date.getDay()]
        };
      };
      
      const rows = dailyData.map((day, index) => {
        const formatted = formatDate(day.date);
        const revenueFormatted = day.revenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        const isLast = index === dailyData.length - 1;
        
        return `
          <div style="display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; ${!isLast ? 'border-bottom: 1px solid #e5e7eb;' : ''} background: ${index % 2 === 0 ? '#ffffff' : '#f9fafb'};">
            <div style="flex: 1;">
              <div style="font-size: 15px; font-weight: 700; color: #1e293b; margin-bottom: 4px;">
                ${formatted.day} ${formatted.month} ${formatted.year}
              </div>
              <div style="font-size: 12px; color: #64748b; font-weight: 500;">
                ${formatted.dayName} â€¢ ${day.salesCount} satÄ±ÅŸ
              </div>
            </div>
            <div style="text-align: right; margin-left: 16px;">
              <div style="font-size: 17px; font-weight: 800; color: #10b981; letter-spacing: -0.3px;">
                â‚º${revenueFormatted}
              </div>
            </div>
          </div>
        `;
      }).join('');
      
      return `
        <div style="display: flex; flex-direction: column; height: 100%; padding: 20px; box-sizing: border-box; overflow: hidden;">
          <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 20px; border-radius: 16px; color: white; margin-bottom: 20px; flex-shrink: 0;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
              <h2 style="margin: 0; font-size: 20px; font-weight: 800; letter-spacing: -0.3px;">ğŸ“ˆ TÃ¼m Zamanlar - GÃ¼nlÃ¼k Ciro</h2>
              <button onclick="closeDailyRevenueModal()" style="background: rgba(255,255,255,0.2); border: none; border-radius: 8px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                <span style="font-size: 20px; color: white;">âœ•</span>
              </button>
            </div>
            <div style="font-size: 14px; opacity: 0.95; font-weight: 500;">
              Toplam: <span style="font-weight: 700; font-size: 16px;">â‚º${totalRevenue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.')}</span> â€¢ ${dailyData.length} gÃ¼n
            </div>
          </div>
          <div style="flex: 1; overflow-y: scroll; overflow-x: hidden; -webkit-overflow-scrolling: touch; border-radius: 12px; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.05); min-height: 0; position: relative;">
            ${rows}
          </div>
        </div>
      `;
    }

    let typingInterval = null;
    let currentAnalysisText = '';
    let currentIndex = 0;

    // Typing efekti ile metin yazdÄ±r
    function typeText(text, element, callback) {
      currentAnalysisText = text;
      currentIndex = 0;
      element.textContent = '';
      
      if (typingInterval) {
        clearInterval(typingInterval);
      }
      
      const indicator = document.getElementById('analysisTypingIndicator');
      if (indicator) indicator.style.display = 'flex';
      
      typingInterval = setInterval(() => {
        if (currentIndex < text.length) {
          element.textContent += text[currentIndex];
          currentIndex++;
          element.scrollTop = element.scrollHeight;
        } else {
          clearInterval(typingInterval);
          typingInterval = null;
          if (indicator) indicator.style.display = 'none';
          if (callback) callback();
        }
      }, 30); // Her karakter 30ms'de yazÄ±lsÄ±n
    }

    // Analiz yap
    async function startAnalysis() {
      const content = document.getElementById('analysisContent');
      if (!content) return;
      
      content.innerHTML = '';
      
      // DÃ¼n ve bugÃ¼n verilerini hesapla (gece 03:00'a gÃ¶re)
      const today = getTodayDateString();
      const yesterdayStr = getYesterdayDateString();
      
      // MasraflarÄ± hariÃ§ tut
      const todaySales = allSales.filter(s => 
        s.sale_date === today && 
        !s.isExpense && 
        s.payment_method !== 'Masraf'
      );
      const yesterdaySales = allSales.filter(s => 
        s.sale_date === yesterdayStr && 
        !s.isExpense && 
        s.payment_method !== 'Masraf'
      );
      
      const todayRevenue = todaySales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      const yesterdayRevenue = yesterdaySales.reduce((sum, s) => sum + parseFloat(s.total_amount || 0), 0);
      
      // ÃœrÃ¼n istatistikleri (fiyat bilgisi ile)
      const todayProductStats = {};
      const yesterdayProductStats = {};
      const productPrices = {}; // ÃœrÃ¼n adÄ± -> fiyat mapping
      
      todaySales.forEach(sale => {
        const items = sale.items_array || sale.items || [];
        items.forEach(item => {
          if (item && item.product_name && !item.isExpense) {
            const name = item.product_name;
            if (!todayProductStats[name]) {
              todayProductStats[name] = { count: 0, revenue: 0 };
            }
            const qty = item.quantity || 1;
            const price = parseFloat(item.price) || 0;
            todayProductStats[name].count += qty;
            todayProductStats[name].revenue += price * qty;
            
            // Fiyat bilgisini kaydet
            if (price > 0 && (!productPrices[name] || productPrices[name] === 0)) {
              productPrices[name] = price;
            }
          }
        });
      });
      
      yesterdaySales.forEach(sale => {
        const items = sale.items_array || sale.items || [];
        items.forEach(item => {
          if (item && item.product_name && !item.isExpense) {
            const name = item.product_name;
            if (!yesterdayProductStats[name]) {
              yesterdayProductStats[name] = { count: 0, revenue: 0 };
            }
            const qty = item.quantity || 1;
            const price = parseFloat(item.price) || 0;
            yesterdayProductStats[name].count += qty;
            yesterdayProductStats[name].revenue += price * qty;
            
            // Fiyat bilgisini kaydet
            if (price > 0 && (!productPrices[name] || productPrices[name] === 0)) {
              productPrices[name] = price;
            }
          }
        });
      });
      
      // Firebase'den Ã¼rÃ¼n fiyatlarÄ±nÄ± al (eÄŸer satÄ±ÅŸ verilerinde yoksa)
      if (db && db.collection) {
        try {
          const productsRef = db.collection('products');
          const productsSnapshot = await productsRef.get();
          if (productsSnapshot && productsSnapshot.forEach) {
            productsSnapshot.forEach((doc) => {
              const product = doc.data();
              const productName = product.name;
              const productPrice = parseFloat(product.price) || 0;
              if (productName && productPrice > 0) {
                if (!productPrices[productName] || productPrices[productName] === 0) {
                  productPrices[productName] = productPrice;
                }
              }
            });
          }
        } catch (error) {
          console.log('Firebase Ã¼rÃ¼n fiyatlarÄ± alÄ±namadÄ±, satÄ±ÅŸ verilerinden devam ediliyor:', error);
        }
      }
      
      // En Ã§ok satÄ±lan Ã¼rÃ¼nler (count'a gÃ¶re)
      const todayTopProducts = Object.entries(todayProductStats)
        .sort(([, a], [, b]) => b.count - a.count)
        .slice(0, 5);
      const yesterdayTopProducts = Object.entries(yesterdayProductStats)
        .sort(([, a], [, b]) => b.count - a.count)
        .slice(0, 5);
      
      // En az satÄ±lan Ã¼rÃ¼nler
      const todayLeastProducts = Object.entries(todayProductStats)
        .sort(([, a], [, b]) => a.count - b.count)
        .slice(0, 5);
      
      // TÃ¼m Ã¼rÃ¼nler (bugÃ¼n + dÃ¼n birleÅŸik)
      const allProducts = new Set([...Object.keys(todayProductStats), ...Object.keys(yesterdayProductStats)]);
      
      const revenueDiff = todayRevenue - yesterdayRevenue;
      const revenuePercent = yesterdayRevenue > 0 ? ((revenueDiff / yesterdayRevenue) * 100).toFixed(1) : 0;
      const salesDiff = todaySales.length - yesterdaySales.length;
      const todayAvg = todaySales.length > 0 ? todayRevenue / todaySales.length : 0;
      const yesterdayAvg = yesterdaySales.length > 0 ? yesterdayRevenue / yesterdaySales.length : 0;
      
      // AkÄ±llÄ± Ã¶neriler ve riskler sistemi
      const recommendations = [];
      const risks = [];
      
      // 1. En az satÄ±lan pahalÄ± Ã¼rÃ¼nler iÃ§in fiyat indirimi Ã¶nerisi
      const expensiveLowSales = todayLeastProducts
        .filter(([name, stats]) => {
          const price = productPrices[name] || 0;
          return price > 50 && stats.count <= 2; // 50 TL Ã¼zeri ve 2 veya daha az satÄ±ÅŸ
        })
        .sort(([nameA], [nameB]) => (productPrices[nameB] || 0) - (productPrices[nameA] || 0))
        .slice(0, 3);
      
      expensiveLowSales.forEach(([name, stats]) => {
        const currentPrice = productPrices[name] || 0;
        if (currentPrice > 0) {
          const suggestedPrice = Math.round(currentPrice * 0.85); // %15 indirim
          recommendations.push({
            type: 'price_reduction',
            product: name,
            currentPrice: currentPrice,
            suggestedPrice: suggestedPrice,
            reason: 'YÃ¼ksek fiyatlÄ± ancak dÃ¼ÅŸÃ¼k satÄ±ÅŸ hacimli Ã¼rÃ¼n',
            sales: stats.count
          });
        }
      });
      
      // 2. Ã‡ok satÄ±lan ama dÃ¼ÅŸÃ¼k fiyatlÄ± Ã¼rÃ¼nler iÃ§in fiyat artÄ±rma Ã¶nerisi
      const popularLowPrice = todayTopProducts
        .filter(([name, stats]) => {
          const price = productPrices[name] || 0;
          return price > 0 && price < 30 && stats.count >= 5; // 30 TL altÄ± ve 5+ satÄ±ÅŸ
        })
        .sort(([, a], [, b]) => b.count - a.count)
        .slice(0, 3);
      
      popularLowPrice.forEach(([name, stats]) => {
        const currentPrice = productPrices[name] || 0;
        if (currentPrice > 0) {
          const suggestedPrice = Math.round(currentPrice * 1.15); // %15 artÄ±ÅŸ
          recommendations.push({
            type: 'price_increase',
            product: name,
            currentPrice: currentPrice,
            suggestedPrice: suggestedPrice,
            reason: 'YÃ¼ksek talep gÃ¶ren ancak dÃ¼ÅŸÃ¼k fiyatlÄ± Ã¼rÃ¼n',
            sales: stats.count
          });
        }
      });
      
      // 3. KÃ¢rlÄ±lÄ±k analizi - yÃ¼ksek satÄ±ÅŸ ama dÃ¼ÅŸÃ¼k gelir
      const highVolumeLowRevenue = todayTopProducts
        .filter(([name, stats]) => {
          const price = productPrices[name] || 0;
          const avgRevenuePerSale = stats.count > 0 ? stats.revenue / stats.count : 0;
          return stats.count >= 8 && avgRevenuePerSale < price * 0.7; // Ã‡ok satÄ±ÅŸ ama dÃ¼ÅŸÃ¼k ortalama gelir
        });
      
      if (highVolumeLowRevenue.length > 0) {
        highVolumeLowRevenue.forEach(([name, stats]) => {
          recommendations.push({
            type: 'profitability',
            product: name,
            reason: 'YÃ¼ksek satÄ±ÅŸ hacmi ancak dÃ¼ÅŸÃ¼k kÃ¢r marjÄ± tespit edildi',
            sales: stats.count,
            avgRevenue: (stats.revenue / stats.count).toFixed(2)
          });
        });
      }
      
      // 4. Stok optimizasyonu - hiÃ§ satÄ±lmayan Ã¼rÃ¼nler
      const unsoldProducts = Array.from(allProducts)
        .filter(name => !todayProductStats[name] || todayProductStats[name].count === 0)
        .filter(name => productPrices[name] && productPrices[name] > 0)
        .slice(0, 3);
      
      if (unsoldProducts.length > 0) {
        unsoldProducts.forEach(name => {
          risks.push({
            type: 'unsold',
            product: name,
            reason: 'BugÃ¼n hiÃ§ satÄ±lmayan Ã¼rÃ¼n - stok kontrolÃ¼ gerekli',
            price: productPrices[name]
          });
        });
      }
      
      // 5. Trend analizi - dÃ¼n Ã§ok satÄ±lan ama bugÃ¼n az satÄ±lan
      const decliningProducts = yesterdayTopProducts
        .filter(([name]) => {
          const todayCount = todayProductStats[name]?.count || 0;
          const yesterdayCount = yesterdayProductStats[name]?.count || 0;
          return yesterdayCount >= 5 && todayCount < yesterdayCount * 0.5; // %50'den fazla dÃ¼ÅŸÃ¼ÅŸ
        })
        .slice(0, 3);
      
      if (decliningProducts.length > 0) {
        decliningProducts.forEach(([name]) => {
          risks.push({
            type: 'declining',
            product: name,
            reason: 'DÃ¼n popÃ¼ler olan ancak bugÃ¼n satÄ±ÅŸlarÄ± dÃ¼ÅŸen Ã¼rÃ¼n',
            yesterdaySales: yesterdayProductStats[name]?.count || 0,
            todaySales: todayProductStats[name]?.count || 0
          });
        });
      }
      
      // 6. Genel trend analizi
      if (revenueDiff < 0 && Math.abs(revenuePercent) > 10) {
        risks.push({
          type: 'revenue_decline',
          reason: `Ciroda %${Math.abs(revenuePercent)} dÃ¼ÅŸÃ¼ÅŸ tespit edildi. Acil aksiyon gerekli.`,
          percentage: Math.abs(revenuePercent)
        });
        recommendations.push({
          type: 'general',
          reason: 'MÃ¼ÅŸteri Ã§ekme kampanyalarÄ± ve promosyonlar dÃ¼ÅŸÃ¼nÃ¼lmeli'
        });
      } else if (revenueDiff > 0 && revenuePercent > 10) {
        recommendations.push({
          type: 'general',
          reason: `%${revenuePercent} ciro artÄ±ÅŸÄ± devam ettirilmeli. Mevcut strateji baÅŸarÄ±lÄ±.`
        });
      }
      
      if (salesDiff < -5) {
        risks.push({
          type: 'sales_decline',
          reason: 'SatÄ±ÅŸ sayÄ±sÄ±nda Ã¶nemli dÃ¼ÅŸÃ¼ÅŸ var. Personel performansÄ± ve mÃ¼ÅŸteri memnuniyeti gÃ¶zden geÃ§irilmeli.',
          decline: Math.abs(salesDiff)
        });
      }
      
      if (todayAvg < yesterdayAvg * 0.8) {
        risks.push({
          type: 'avg_decline',
          reason: 'Ortalama satÄ±ÅŸ deÄŸeri dÃ¼ÅŸÃ¼yor. YÃ¼ksek deÄŸerli Ã¼rÃ¼nlere yÃ¶nelik cross-selling stratejileri uygulanmalÄ±.',
          todayAvg: todayAvg.toFixed(2),
          yesterdayAvg: yesterdayAvg.toFixed(2)
        });
      }
      
      // 7. En Ã§ok satÄ±lan Ã¼rÃ¼n iÃ§in stok Ã¶nerisi
      if (todayTopProducts.length > 0 && todayTopProducts[0][1].count > 10) {
        recommendations.push({
          type: 'stock',
          product: todayTopProducts[0][0],
          reason: 'YÃ¼ksek talep gÃ¶ren Ã¼rÃ¼n - stok seviyesi kontrol edilmeli ve artÄ±rÄ±lmalÄ±',
          sales: todayTopProducts[0][1].count
        });
      }
      
      // Ã–nce yazÄ± metnini oluÅŸtur
      let analysisText = `SATIÅ ANALÄ°ZÄ° RAPORU\n\n`;
      analysisText += `Tarih: ${today}\n`;
      analysisText += `Analiz ZamanÄ±: ${new Date().toLocaleTimeString('tr-TR')}\n\n`;
      analysisText += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
      
      analysisText += `CÄ°RO KARÅILAÅTIRMASI\n\n`;
      analysisText += `DÃ¼n (${yesterdayStr}): â‚º${yesterdayRevenue.toFixed(2)}\n`;
      analysisText += `BugÃ¼n (${today}): â‚º${todayRevenue.toFixed(2)}\n\n`;
      
      if (revenueDiff > 0) {
        analysisText += `YÃ¼kseliÅŸ tespit edildi. BugÃ¼n dÃ¼nden â‚º${Math.abs(revenueDiff).toFixed(2)} daha fazla ciro elde edildi.\n`;
        analysisText += `ArtÄ±ÅŸ oranÄ±: %${Math.abs(revenuePercent)}\n\n`;
      } else if (revenueDiff < 0) {
        analysisText += `DÃ¼ÅŸÃ¼ÅŸ tespit edildi. BugÃ¼n dÃ¼nden â‚º${Math.abs(revenueDiff).toFixed(2)} daha az ciro elde edildi.\n`;
        analysisText += `DÃ¼ÅŸÃ¼ÅŸ oranÄ±: %${Math.abs(revenuePercent)}\n\n`;
      } else {
        analysisText += `Ciro deÄŸiÅŸikliÄŸi tespit edilmedi.\n\n`;
      }
      
      analysisText += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
      analysisText += `SATIÅ SAYISI\n\n`;
      analysisText += `DÃ¼n: ${yesterdaySales.length} satÄ±ÅŸ\n`;
      analysisText += `BugÃ¼n: ${todaySales.length} satÄ±ÅŸ\n\n`;
      
      if (salesDiff > 0) {
        analysisText += `BugÃ¼n ${salesDiff} satÄ±ÅŸ daha fazla yapÄ±ldÄ±.\n\n`;
      } else if (salesDiff < 0) {
        analysisText += `BugÃ¼n ${Math.abs(salesDiff)} satÄ±ÅŸ daha az yapÄ±ldÄ±.\n\n`;
      }
      
      if (todayTopProducts.length > 0) {
        analysisText += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
        analysisText += `EN Ã‡OK SATILAN ÃœRÃœNLER\n\n`;
        todayTopProducts.forEach(([name, stats], index) => {
          analysisText += `${index + 1}. ${name}: ${stats.count} adet\n`;
        });
        analysisText += `\n`;
      }
      
      analysisText += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n`;
      analysisText += `DetaylÄ± analiz tablolarÄ± aÅŸaÄŸÄ±da gÃ¶sterilmektedir.\n\n`;
      
      // HTML tablolarÄ±
      const htmlTables = `
        <div class="analysis-summary">
          <div class="analysis-card revenue-card">
            <div class="analysis-card-header">
              <span class="analysis-icon">ğŸ’°</span>
              <h3>Ciro Analizi</h3>
            </div>
            <div class="analysis-card-body">
              <div class="analysis-comparison">
                <div class="comparison-item">
                  <span class="comparison-label">DÃ¼n</span>
                  <span class="comparison-value">â‚º${yesterdayRevenue.toFixed(2)}</span>
                </div>
                <div class="comparison-arrow">â†’</div>
                <div class="comparison-item">
                  <span class="comparison-label">BugÃ¼n</span>
                  <span class="comparison-value ${revenueDiff >= 0 ? 'positive' : 'negative'}">â‚º${todayRevenue.toFixed(2)}</span>
                </div>
              </div>
              <div class="analysis-trend ${revenueDiff >= 0 ? 'trend-up' : 'trend-down'}">
                ${revenueDiff >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰'} ${revenueDiff >= 0 ? 'YÃ¼kseliÅŸ' : 'DÃ¼ÅŸÃ¼ÅŸ'}: %${Math.abs(revenuePercent)}
              </div>
            </div>
          </div>
          
          <div class="analysis-card sales-card">
            <div class="analysis-card-header">
              <span class="analysis-icon">ğŸ›’</span>
              <h3>SatÄ±ÅŸ SayÄ±sÄ±</h3>
            </div>
            <div class="analysis-card-body">
              <div class="analysis-comparison">
                <div class="comparison-item">
                  <span class="comparison-label">DÃ¼n</span>
                  <span class="comparison-value">${yesterdaySales.length}</span>
                </div>
                <div class="comparison-arrow">â†’</div>
                <div class="comparison-item">
                  <span class="comparison-label">BugÃ¼n</span>
                  <span class="comparison-value ${salesDiff >= 0 ? 'positive' : 'negative'}">${todaySales.length}</span>
                </div>
              </div>
            </div>
          </div>
          
          ${todayTopProducts.length > 0 ? `
          <div class="analysis-card products-card">
            <div class="analysis-card-header">
              <span class="analysis-icon">â­</span>
              <h3>En Ã‡ok SatÄ±lan</h3>
            </div>
            <div class="analysis-card-body">
              ${todayTopProducts.map(([name, stats], idx) => `
                <div class="product-item">
                  <span class="product-rank">${idx + 1}</span>
                  <span class="product-name">${name}</span>
                  <span class="product-count">${stats.count} adet</span>
                </div>
              `).join('')}
            </div>
          </div>
          ` : ''}
        </div>
        
        <div class="analysis-tables">
          <div class="analysis-table recommendations-table">
            <div class="table-header">
              <span class="table-icon">ğŸ’¡</span>
              <h3>Ã–neriler</h3>
            </div>
            <div class="table-body">
              ${recommendations.length > 0 ? recommendations.map(rec => {
                if (typeof rec === 'string') {
                  return `<div class="table-row"><span class="row-bullet">â€¢</span><span class="row-text">${rec}</span></div>`;
                }
                
                // Fiyat indirimi Ã¶nerisi
                if (rec.type === 'price_reduction') {
                  return `
                    <div class="table-row recommendation-price">
                      <span class="row-bullet">ğŸ’°</span>
                      <div class="row-content">
                        <div class="row-main-text">
                          <strong>${rec.product}</strong> iÃ§in fiyat indirimi Ã¶neriliyor
                        </div>
                        <div class="price-suggestion">
                          <span class="old-price">â‚º${rec.currentPrice.toFixed(2)}</span>
                          <span class="new-price">â‚º${rec.suggestedPrice.toFixed(2)}</span>
                          <span class="price-change">(%${Math.round((1 - rec.suggestedPrice/rec.currentPrice) * 100)} indirim)</span>
                        </div>
                        <div class="row-reason">${rec.reason} - Sadece ${rec.sales} satÄ±ÅŸ</div>
                      </div>
                    </div>
                  `;
                }
                
                // Fiyat artÄ±rma Ã¶nerisi
                if (rec.type === 'price_increase') {
                  return `
                    <div class="table-row recommendation-price">
                      <span class="row-bullet">ğŸ“ˆ</span>
                      <div class="row-content">
                        <div class="row-main-text">
                          <strong>${rec.product}</strong> iÃ§in fiyat artÄ±rÄ±mÄ± Ã¶neriliyor
                        </div>
                        <div class="price-suggestion">
                          <span class="old-price">â‚º${rec.currentPrice.toFixed(2)}</span>
                          <span class="new-price">â‚º${rec.suggestedPrice.toFixed(2)}</span>
                          <span class="price-change positive">(%${Math.round((rec.suggestedPrice/rec.currentPrice - 1) * 100)} artÄ±ÅŸ)</span>
                        </div>
                        <div class="row-reason">${rec.reason} - ${rec.sales} satÄ±ÅŸ ile yÃ¼ksek talep</div>
                      </div>
                    </div>
                  `;
                }
                
                // KÃ¢rlÄ±lÄ±k Ã¶nerisi
                if (rec.type === 'profitability') {
                  return `
                    <div class="table-row">
                      <span class="row-bullet">ğŸ’¼</span>
                      <div class="row-content">
                        <div class="row-main-text"><strong>${rec.product}</strong>: ${rec.reason}</div>
                        <div class="row-reason">${rec.sales} satÄ±ÅŸ, ortalama gelir: â‚º${rec.avgRevenue}</div>
                      </div>
                    </div>
                  `;
                }
                
                // Stok Ã¶nerisi
                if (rec.type === 'stock') {
                  return `
                    <div class="table-row">
                      <span class="row-bullet">ğŸ“¦</span>
                      <div class="row-content">
                        <div class="row-main-text"><strong>${rec.product}</strong>: ${rec.reason}</div>
                        <div class="row-reason">${rec.sales} satÄ±ÅŸ ile yÃ¼ksek talep</div>
                      </div>
                    </div>
                  `;
                }
                
                // Genel Ã¶neri
                return `
                  <div class="table-row">
                    <span class="row-bullet">ğŸ’¡</span>
                    <span class="row-text">${rec.reason}</span>
                  </div>
                `;
              }).join('') : '<div class="table-row"><span class="row-text">Åu an iÃ§in Ã¶zel Ã¶neri bulunmuyor.</span></div>'}
            </div>
          </div>
          
          <div class="analysis-table risks-table">
            <div class="table-header">
              <span class="table-icon">âš ï¸</span>
              <h3>Riskler</h3>
            </div>
            <div class="table-body">
              ${risks.length > 0 ? risks.map(risk => {
                if (typeof risk === 'string') {
                  return `<div class="table-row"><span class="row-bullet">âš ï¸</span><span class="row-text">${risk}</span></div>`;
                }
                
                // SatÄ±lmayan Ã¼rÃ¼n riski
                if (risk.type === 'unsold') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">âŒ</span>
                      <div class="row-content">
                        <div class="row-main-text"><strong>${risk.product}</strong>: ${risk.reason}</div>
                        <div class="row-reason">Mevcut fiyat: â‚º${risk.price.toFixed(2)}</div>
                      </div>
                    </div>
                  `;
                }
                
                // DÃ¼ÅŸen Ã¼rÃ¼n riski
                if (risk.type === 'declining') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">ğŸ“‰</span>
                      <div class="row-content">
                        <div class="row-main-text"><strong>${risk.product}</strong>: ${risk.reason}</div>
                        <div class="row-reason">DÃ¼n: ${risk.yesterdaySales} satÄ±ÅŸ â†’ BugÃ¼n: ${risk.todaySales} satÄ±ÅŸ</div>
                      </div>
                    </div>
                  `;
                }
                
                // Ciro dÃ¼ÅŸÃ¼ÅŸÃ¼
                if (risk.type === 'revenue_decline') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">ğŸ’°</span>
                      <span class="row-text">${risk.reason}</span>
                    </div>
                  `;
                }
                
                // SatÄ±ÅŸ dÃ¼ÅŸÃ¼ÅŸÃ¼
                if (risk.type === 'sales_decline') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">ğŸ›’</span>
                      <span class="row-text">${risk.reason}</span>
                    </div>
                  `;
                }
                
                // Ortalama dÃ¼ÅŸÃ¼ÅŸÃ¼
                if (risk.type === 'avg_decline') {
                  return `
                    <div class="table-row risk-item">
                      <span class="row-bullet">ğŸ“Š</span>
                      <div class="row-content">
                        <div class="row-main-text">${risk.reason}</div>
                        <div class="row-reason">DÃ¼n: â‚º${risk.yesterdayAvg} â†’ BugÃ¼n: â‚º${risk.todayAvg}</div>
                      </div>
                    </div>
                  `;
                }
                
                return `<div class="table-row"><span class="row-bullet">âš ï¸</span><span class="row-text">${risk.reason || risk}</span></div>`;
              }).join('') : '<div class="table-row"><span class="row-text">Tespit edilen risk bulunmuyor.</span></div>'}
            </div>
          </div>
        </div>
      `;
      
      // Ã–nce yazÄ±yÄ± typing efektiyle gÃ¶ster, sonra tablolarÄ± ekle
      typeTextThenShowTables(analysisText, htmlTables, content);
    }

    // Ã–nce yazÄ±yÄ± yaz, sonra tablolarÄ± gÃ¶ster
    function typeTextThenShowTables(text, htmlTables, element) {
      element.innerHTML = '<div class="analysis-text-content"></div>';
      const textContent = element.querySelector('.analysis-text-content');
      const indicator = document.getElementById('analysisTypingIndicator');
      if (indicator) indicator.style.display = 'flex';
      
      let currentIndex = 0;
      
      typingInterval = setInterval(() => {
        if (currentIndex < text.length) {
          textContent.textContent += text[currentIndex];
          currentIndex++;
          element.scrollTop = element.scrollHeight;
        } else {
          clearInterval(typingInterval);
          typingInterval = null;
          if (indicator) indicator.style.display = 'none';
          
          // YazÄ± bittikten sonra tablolarÄ± ekle
          setTimeout(() => {
            const tablesDiv = document.createElement('div');
            tablesDiv.innerHTML = htmlTables;
            element.appendChild(tablesDiv);
            element.scrollTop = 0;
          }, 300);
        }
      }, 25);
    }

    window.showChangePinModal = showChangePinModal;
    window.hideChangePinModal = hideChangePinModal;

    function setupChangePinModal() {
      const btn = document.getElementById('btnChangePin');
      const cancel = document.getElementById('changePinCancel');
      const submit = document.getElementById('changePinSubmit');
      const overlay = document.getElementById('changePinOverlay');
      if (btn) btn.addEventListener('click', showChangePinModal);
      if (cancel) cancel.addEventListener('click', hideChangePinModal);
      if (submit) submit.addEventListener('click', submitChangePin);
      if (overlay) overlay.addEventListener('click', function(e) { if (e.target === overlay) hideChangePinModal(); });
    }
    function setupSuccessPopup() {
      var okBtn = document.getElementById('successPopupOk');
      var overlay = document.getElementById('successPopupOverlay');
      if (okBtn) okBtn.addEventListener('click', hideSuccessPopup);
      if (overlay) overlay.addEventListener('click', function(e) { if (e.target === overlay) hideSuccessPopup(); });
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setupChangePinModal();
        setupSuccessPopup();
      });
    } else {
      setupChangePinModal();
      setupSuccessPopup();
    }

    // Global fonksiyonlar
    window.verifyPin = verifyPin;
    window.loadSales = loadSales;
    window.setActiveTab = setActiveTab;
    window.setReportDateFilter = setReportDateFilter;
    window.setCustomDateRange = setCustomDateRange;
    window.toggleDateFilterModal = toggleDateFilterModal;
    window.closeDateFilterModal = closeDateFilterModal;
    window.showDailyRevenueModal = showDailyRevenueModal;
    window.closeDailyRevenueModal = closeDailyRevenueModal;
    window.addDailyRevenueModal = addDailyRevenueModal;
    window.showAnalysisModal = showAnalysisModal;
    window.closeAnalysisModal = closeAnalysisModal;
    window.showDailyRevenueModal = showDailyRevenueModal;
    window.closeDailyRevenueModal = closeDailyRevenueModal;
    window.logout = function() {
      sessionStorage.removeItem('adminAuthenticated');
      isAuthenticated = false;
      if (realtimeUnsubscribe) {
        realtimeUnsubscribe();
        realtimeUnsubscribe = null;
      }
      if (tablesUnsubscribe) {
        tablesUnsubscribe();
        tablesUnsubscribe = null;
      }
      showLogin();
    };

    // Sayfa yÃ¼klendiÄŸinde modal event listener'Ä± ekle
    window.addEventListener('load', function() {
      setupDateFilterModal();
    });
  </script>
  <style>
    :root {
      --bg-page: #f3f4f6;
      --bg-container: #ffffff;
      --bg-subtle: #f9fafb;
      --border-subtle: #e5e7eb;
      --border-strong: #d1d5db;
      --primary: #f97316;       /* Tema rengi (tenant'tan gelecek) */
      --primary-soft: #fff7ed;
      --primary-strong: #ea580c;
      --accent: #2563eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.12);
      --radius-lg: 16px;
      --radius-md: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: radial-gradient(circle at top, #ffffff 0, #f3f4f6 55%, #e5e7eb 100%);
      min-height: 100vh;
      padding: 24px;
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    body.login-view {
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 1240px;
      background: var(--bg-container);
      border-radius: 20px;
      padding: 20px 22px 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
      animation: fadeIn 0.35s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Header kaldÄ±rÄ±ldÄ± - navbar kullanÄ±lÄ±yor */

    /* Login - Basit, profesyonel ve kurumsal */
    .pin-section {
      background: #ffffff;
      padding: 40px 36px;
      border-radius: 16px;
      text-align: center;
      border: 1px solid #e5e7eb;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
      max-width: 400px;
      margin: 0 auto;
      position: relative;
    }

    .login-header {
      margin-bottom: 28px;
    }

    .login-logo {
      width: 72px;
      height: 72px;
      margin: 0 auto 20px;
      border-radius: 50%;
      object-fit: cover;
      display: block;
      border: 1px solid #e5e7eb;
    }

    .pin-section h2 {
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 6px;
      color: #1f2937;
      letter-spacing: -0.3px;
    }

    .pin-section .login-subtitle {
      font-size: 14px;
      color: #6b7280;
      font-weight: 500;
      margin-bottom: 0;
    }

    .pin-form {
      text-align: left;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      color: #374151;
      margin-bottom: 8px;
    }

    .pin-input {
      padding: 12px 16px;
      font-size: 18px;
      border-radius: 10px;
      width: 100%;
      box-sizing: border-box;
      text-align: center;
      font-weight: 500;
      letter-spacing: 6px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #111827;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .pin-input:focus {
      outline: none;
      border-color: #4b5563;
      box-shadow: 0 0 0 3px rgba(75, 85, 99, 0.12);
    }

    .login-options {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 8px;
    }

    .login-remember {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #6b7280;
      cursor: pointer;
      user-select: none;
    }

    .login-remember input {
      width: 16px;
      height: 16px;
      accent-color: #4b5563;
      cursor: pointer;
    }

    .login-change-pin {
      font-size: 13px;
      color: #4b5563;
      text-decoration: none;
      font-weight: 500;
      cursor: pointer;
      background: none;
      border: none;
      padding: 0;
    }

    .login-change-pin:hover {
      color: #1f2937;
      text-decoration: underline;
    }

    .pin-btn {
      padding: 14px 24px;
      border-radius: 10px;
      border: none;
      background: #374151;
      color: #ffffff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
      transition: background 0.2s;
    }

    .pin-btn:hover {
      background: #1f2937;
    }

    .pin-btn:active {
      background: #111827;
    }

    .login-footer {
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid #e5e7eb;
    }

    .login-footer-text {
      font-size: 12px;
      color: #9ca3af;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .login-footer-text svg {
      width: 14px;
      height: 14px;
      color: #9ca3af;
    }

    /* Åifre deÄŸiÅŸtir modal */
    .change-pin-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .change-pin-overlay.show {
      display: flex;
    }

    .change-pin-modal {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      max-width: 360px;
      width: 100%;
      border: 1px solid #e5e7eb;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .change-pin-modal h3 {
      margin: 0 0 20px 0;
      font-size: 18px;
      font-weight: 600;
      color: #1f2937;
    }

    .change-pin-modal .input-group {
      margin-bottom: 16px;
    }

    .change-pin-modal .pin-input {
      letter-spacing: 4px;
    }

    .change-pin-modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .change-pin-modal-actions button {
      flex: 1;
      padding: 10px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }

    .change-pin-cancel {
      background: #f3f4f6;
      color: #374151;
    }

    .change-pin-cancel:hover {
      background: #e5e7eb;
    }

    .change-pin-submit {
      background: #374151;
      color: #fff;
    }

    .change-pin-submit:hover {
      background: #1f2937;
    }

    /* BaÅŸarÄ± popup - modern ve profesyonel */
    .success-popup-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.5);
      backdrop-filter: blur(6px);
      z-index: 10000;
      align-items: center;
      justify-content: center;
      padding: 24px;
      animation: successPopupFadeIn 0.25s ease-out;
    }
    .success-popup-overlay.show {
      display: flex;
    }
    @keyframes successPopupFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .success-popup-card {
      background: #fff;
      border-radius: 16px;
      padding: 32px 40px;
      max-width: 380px;
      width: 100%;
      text-align: center;
      box-shadow: 0 24px 48px rgba(0, 0, 0, 0.18), 0 0 0 1px rgba(0, 0, 0, 0.04);
      animation: successPopupScaleIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    @keyframes successPopupScaleIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }
    .success-popup-icon {
      width: 56px;
      height: 56px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 24px rgba(5, 150, 105, 0.35);
    }
    .success-popup-icon svg {
      width: 28px;
      height: 28px;
      color: #fff;
    }
    .success-popup-title {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      margin: 0 0 8px 0;
      letter-spacing: -0.3px;
    }
    .success-popup-subtitle {
      font-size: 14px;
      color: #6b7280;
      margin: 0 0 24px 0;
      line-height: 1.5;
    }
    .success-popup-btn {
      display: inline-block;
      padding: 12px 28px;
      background: #111827;
      color: #fff;
      font-size: 14px;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .success-popup-btn:hover {
      background: #1f2937;
    }

    @media (max-width: 600px) {
      .pin-section {
        padding: 32px 24px;
      }
      .pin-section h2 {
        font-size: 20px;
      }
    }

    /* Dashboard shell */
    .dashboard {
      display: none;
    }

    .dashboard.active {
      display: block;
    }

    /* Modern Navbar */
    .admin-navbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-bottom: 2px solid var(--primary, #f97316);
      padding: 12px 20px;
      margin: 0;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
      backdrop-filter: blur(10px);
    }

    .navbar-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 100%;
      margin: 0 auto;
    }

    .navbar-brand {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
    }

    .navbar-logo {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 900;
      font-size: 18px;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }

    .navbar-logo-img {
      width: 40px;
      height: 40px;
      object-fit: contain;
      flex-shrink: 0;
      border-radius: 12px;
    }

    .navbar-title-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .navbar-title {
      font-size: 18px;
      font-weight: 800;
      color: #1f2937;
      line-height: 1.2;
      margin: 0;
      letter-spacing: -0.3px;
    }

    .navbar-subtitle {
      font-size: 11px;
      font-weight: 500;
      color: #64748b;
      line-height: 1.2;
      margin: 0;
    }

    .navbar-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .navbar-actions-stack {
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
    }

    .navbar-actions-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* YÃ¶netim butonu (Gece DÃ¶nercisi) */
    .management-btn {
      width: 100%;
      min-width: 240px;
      justify-content: center;
      border-radius: 14px;
      padding: 12px 18px;
      font-size: 14px;
      font-weight: 800;
      border: 2px solid #0f172a;
      color: #ffffff;
      background: linear-gradient(135deg, #0f172a 0%, #1f2937 100%);
      display: inline-flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.22), 0 0 0 1px rgba(255, 255, 255, 0.08) inset;
    }

    .management-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 34px rgba(15, 23, 42, 0.26), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
    }

    .management-btn:active {
      transform: translateY(0);
    }

    /* YÃ¶netim overlay */
    .management-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 10050;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: rgba(2, 6, 23, 0.62);
      backdrop-filter: blur(6px);
    }

    .management-modal {
      width: 100%;
      max-width: 980px;
      max-height: 90vh;
      overflow: hidden;
      background: #ffffff;
      border-radius: 24px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.45);
      display: flex;
      flex-direction: column;
      animation: slideUp 0.25s ease;
    }

    .management-header {
      padding: 18px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #0f172a 0%, #1f2937 100%);
      color: #fff;
    }

    .management-header h2 {
      margin: 0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing: -0.2px;
    }

    .management-close {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      cursor: pointer;
      font-size: 24px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .management-close:hover {
      background: rgba(255, 255, 255, 0.18);
      transform: scale(1.03);
    }

    .management-body {
      padding: 18px 20px 22px 20px;
      overflow: auto;
    }

    .management-home-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
    }

    .management-card {
      border: 2px solid #e5e7eb;
      border-radius: 20px;
      padding: 18px;
      background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
      cursor: pointer;
      transition: all 0.25s ease;
      text-align: left;
    }

    .management-card:hover {
      border-color: #0f172a;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.14);
      transform: translateY(-1px);
    }

    .management-card-title {
      font-size: 16px;
      font-weight: 900;
      color: #0f172a;
      margin: 0 0 6px 0;
    }

    .management-card-desc {
      margin: 0;
      font-size: 13px;
      color: #475569;
      font-weight: 600;
      line-height: 1.4;
    }

    .management-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 18px;
      background: #ffffff;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }

    .management-toolbar .branch-toggle {
      display: flex;
      gap: 10px;
    }

    .branch-btn {
      padding: 10px 14px;
      border-radius: 14px;
      border: 2px solid #e5e7eb;
      background: #f8fafc;
      color: #0f172a;
      font-weight: 900;
      cursor: pointer;
      transition: all 0.2s;
    }

    .branch-btn.active {
      border-color: #0f172a;
      background: #0f172a;
      color: #fff;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.18);
    }

    .management-search {
      flex: 1;
      max-width: 420px;
      padding: 10px 14px;
      border-radius: 14px;
      border: 2px solid #e5e7eb;
      outline: none;
      font-weight: 700;
    }

    .management-search:focus {
      border-color: #0f172a;
      box-shadow: 0 0 0 4px rgba(15, 23, 42, 0.08);
    }

    .management-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .management-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 14px;
      border: 1px solid #e2e8f0;
      border-radius: 18px;
      background: #ffffff;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
    }

    /* Stok listesi: daha sade/ergonomik */
    #managementStock .management-toolbar {
      position: sticky;
      top: 0;
      z-index: 5;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    #managementStock .management-search {
      max-width: none;
      min-width: 220px;
      flex: 1 1 320px;
    }

    .management-row.stock-row {
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto;
      align-items: center;
      padding: 16px 16px;
      border: 1px solid #e2e8f0;
      border-radius: 20px;
      transition: box-shadow 0.18s ease, border-color 0.18s ease, transform 0.18s ease;
    }

    .management-row.stock-row:hover {
      border-color: rgba(15, 23, 42, 0.18);
      box-shadow: 0 14px 34px rgba(15, 23, 42, 0.10);
      transform: translateY(-1px);
    }

    .mgmt-stock-left {
      min-width: 240px;
    }

    .mgmt-stock-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 12px;
      flex-wrap: wrap;
    }

    .management-pill.is-zero {
      border-color: #fecaca;
      background: #fef2f2;
      color: #991b1b;
    }

    .mgmt-stock-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .mgmt-stock-input {
      width: 120px;
      border-width: 2px;
    }

    .mgmt-stock-input:focus {
      border-color: #0f172a;
      box-shadow: 0 0 0 4px rgba(15, 23, 42, 0.08);
    }

    .mgmt-stock-actions {
      display: flex;
      gap: 10px;
    }

    .management-row-title {
      font-weight: 900;
      color: #0f172a;
      font-size: 14px;
      line-height: 1.2;
    }

    .management-row-sub {
      font-size: 12px;
      color: #64748b;
      font-weight: 600;
      margin-top: 4px;
    }

    .management-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      border-radius: 14px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      font-weight: 900;
      color: #0f172a;
      text-align: center;
      min-width: 92px;
    }

    .management-input {
      width: 110px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid #e2e8f0;
      outline: none;
      font-weight: 900;
      text-align: center;
    }

    .management-input:focus {
      border-color: #0f172a;
      box-shadow: 0 0 0 4px rgba(15, 23, 42, 0.08);
    }

    .management-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      min-width: 210px;
    }

    .mgmt-action-btn {
      flex: 1;
      padding: 10px 12px;
      border-radius: 14px;
      border: 2px solid transparent;
      cursor: pointer;
      font-weight: 900;
      transition: all 0.2s;
    }

    .mgmt-action-btn.add {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #fff;
    }

    .mgmt-action-btn.sub {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: #fff;
    }

    .mgmt-action-btn.save {
      background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
      color: #fff;
    }

    .mgmt-back {
      padding: 10px 14px;
      border-radius: 14px;
      border: 2px solid #e5e7eb;
      background: #ffffff;
      font-weight: 900;
      cursor: pointer;
    }

    /* YÃ¶netim: kategori sekmeleri (Ã¶zellikle Fiyat) */
    .mgmt-tabs {
      display: flex;
      align-items: center;
      gap: 8px;
      overflow-x: auto;
      overflow-y: hidden;
      white-space: nowrap;
      padding-bottom: 2px;
      flex: 1 1 auto;
      min-width: 220px;
    }

    .mgmt-tab {
      padding: 9px 12px;
      border-radius: 999px;
      border: 2px solid #e5e7eb;
      background: #f8fafc;
      color: #0f172a;
      font-weight: 900;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.18s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      user-select: none;
    }

    .mgmt-tab:hover {
      border-color: rgba(15, 23, 42, 0.28);
      background: #ffffff;
    }

    .mgmt-tab.active {
      border-color: #0f172a;
      background: #0f172a;
      color: #ffffff;
      box-shadow: 0 12px 26px rgba(15, 23, 42, 0.18);
    }

    .mgmt-tab-count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 20px;
      padding: 0 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.08);
      color: #0f172a;
      font-size: 11px;
      font-weight: 900;
    }

    .mgmt-tab.active .mgmt-tab-count {
      background: rgba(255, 255, 255, 0.18);
      color: #ffffff;
    }

    /* Fiyat yÃ¶netimi: daha kompakt, daha Ã§ok Ã¼rÃ¼n */
    #managementPrice .management-toolbar {
      position: sticky;
      top: 0;
      z-index: 5;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    #managementPrice .management-search {
      max-width: none;
      min-width: 180px;
      flex: 1 1 220px;
    }

    .management-list.price-list {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .management-row.price-row {
      padding: 12px 12px;
      border-radius: 18px;
      border: 1px solid #e2e8f0;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .price-row .management-row-title {
      font-size: 13px;
      font-weight: 900;
      line-height: 1.25;
    }

    .mgmt-price-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .mgmt-price-controls .management-pill {
      min-width: 0;
      padding: 7px 10px;
      border-radius: 12px;
      font-size: 12px;
    }

    .mgmt-price-input {
      width: 110px;
      border-width: 2px;
      padding: 9px 10px;
      border-radius: 12px;
      font-weight: 900;
    }

    .mgmt-save-btn {
      padding: 9px 10px;
      border-radius: 12px;
      min-width: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      white-space: nowrap;
    }

    .mgmt-save-btn svg {
      width: 18px;
      height: 18px;
      flex: 0 0 auto;
    }

    @media (max-width: 360px) {
      .management-list.price-list {
        grid-template-columns: 1fr;
      }
    }

    @media (min-width: 980px) {
      .management-list.price-list {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }
    }

    @media (max-width: 900px) {
      .mgmt-save-btn .mgmt-save-text {
        display: none;
      }
    }

    @media (max-width: 900px) {
      .management-home-grid {
        grid-template-columns: 1fr;
      }
      .management-row {
        flex-direction: column;
        align-items: stretch;
      }
      .management-actions {
        min-width: 0;
      }
      .management-input {
        width: 100%;
      }

      .management-row.stock-row {
        grid-template-columns: 1fr;
      }

      .mgmt-stock-left {
        min-width: 0;
      }

      .mgmt-stock-right {
        justify-content: flex-start;
        align-items: stretch;
      }

      .mgmt-stock-controls {
        justify-content: flex-start;
      }

      .mgmt-stock-input {
        width: 100%;
      }

      .mgmt-stock-actions {
        width: 100%;
      }

      .mgmt-stock-actions .mgmt-action-btn {
        flex: 1;
      }
    }

    .refresh-btn,
    .logout-btn {
      border-radius: 12px;
      padding: 10px 18px;
      font-size: 13px;
      font-weight: 600;
      border: 2px solid transparent;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .refresh-btn {
      border-color: var(--primary, #f97316);
      color: var(--primary, #f97316);
      background: #ffffff;
    }

    .refresh-btn:hover {
      border-color: var(--primary-strong, #ea580c);
      background: var(--primary-soft, #fff7ed);
      box-shadow: 0 4px 16px rgba(249, 115, 22, 0.25);
      transform: translateY(-1px);
    }

    .logout-btn {
      border-color: var(--primary, #f97316);
      color: #ffffff;
      background: linear-gradient(135deg, var(--primary, #f97316) 0%, var(--primary-strong, #ea580c) 100%);
    }

    .logout-btn:hover {
      border-color: var(--primary-strong, #ea580c);
      background: linear-gradient(135deg, var(--primary-strong, #ea580c) 0%, #c2410c 100%);
      box-shadow: 0 4px 16px rgba(249, 115, 22, 0.35);
      transform: translateY(-1px);
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: #ffffff;
      padding: 14px 12px;
      border-radius: 16px;
      border: 2px solid #e5e7eb;
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: default;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.4) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12), 0 0 0 1px rgba(148, 163, 184, 0.1);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-card-green {
      border-color: #10b981;
      background: #ffffff;
    }

    .stat-card-green:hover {
      border-color: #059669;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.2), 0 0 0 1px rgba(16, 185, 129, 0.1);
    }

    .stat-card-red {
      border-color: #ef4444;
      background: #ffffff;
    }

    .stat-card-red:hover {
      border-color: #dc2626;
      box-shadow: 0 8px 24px rgba(239, 68, 68, 0.2), 0 0 0 1px rgba(239, 68, 68, 0.1);
    }

    .stat-card-purple {
      border-color: var(--primary, #f97316);
      background: #ffffff;
    }

    .stat-card-purple:hover {
      border-color: var(--primary-strong, #ea580c);
      box-shadow: 0 8px 24px rgba(249, 115, 22, 0.2), 0 0 0 1px rgba(249, 115, 22, 0.1);
    }

    .stat-card-pink {
      border-color: var(--primary, #f97316);
      background: #ffffff;
    }

    .stat-card-pink:hover {
      border-color: var(--primary-strong, #ea580c);
      box-shadow: 0 8px 24px rgba(249, 115, 22, 0.2), 0 0 0 1px rgba(249, 115, 22, 0.1);
    }

    .stat-icon {
      font-size: 24px;
      line-height: 1;
      filter: grayscale(0.2);
      transition: all 0.3s ease;
      flex-shrink: 0;
      min-width: 24px;
    }

    .stat-card:hover .stat-icon {
      filter: grayscale(0);
      transform: scale(1.1);
    }

    .stat-content {
      flex: 1;
      min-width: 0;
    }

    .stat-content {
      flex: 1;
      min-width: 0;
      overflow: hidden;
    }

    .stat-content h3 {
      font-size: 11px;
      font-weight: 600;
      color: #64748b;
      margin: 0 0 6px 0;
      letter-spacing: 0.1px;
      text-transform: uppercase;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.2;
    }

    .stat-card-green .stat-content h3 {
      color: #059669;
    }

    .stat-card-red .stat-content h3 {
      color: #dc2626;
    }

    .stat-card-purple .stat-content h3 {
      color: var(--primary-strong, #ea580c);
    }

    .stat-card-pink .stat-content h3 {
      color: var(--primary-strong, #ea580c);
    }

    .stat-value {
      font-size: 20px;
      font-weight: 800;
      color: #1f2937;
      line-height: 1.2;
      letter-spacing: -0.3px;
      white-space: nowrap;
    }

    .stat-card-green .stat-value {
      color: #047857;
    }

    .stat-card-red .stat-value {
      color: #b91c1c;
    }

    .stat-card-purple .stat-value {
      color: var(--primary, #f97316);
    }

    .stat-card-pink .stat-value {
      color: var(--primary, #f97316);
    }

    /* GÃ¼nlÃ¼k Ciro altÄ±nda Ã¶deme detaylarÄ± mini kartÄ± */
    .stat-card-wrapper {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .payment-breakdown-card {
      background: #f8fafc;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .payment-breakdown-item {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
    }

    .payment-breakdown-label {
      font-size: 12px;
      font-weight: 600;
      color: #64748b;
      white-space: nowrap;
    }

    .payment-breakdown-value {
      font-size: 14px;
      font-weight: 700;
      color: #1e293b;
      white-space: nowrap;
    }

    /* Tarih gruplarÄ± + satÄ±ÅŸ kartlarÄ± */
    #salesContainer {
      min-height: 220px;
    }

    .date-group {
      margin-bottom: 24px;
    }

    .date-header {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      border-radius: 16px;
      padding: 18px 20px;
      border: 2px solid #a7f3d0;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.08), 0 2px 4px rgba(16, 185, 129, 0.04);
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .date-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #10b981 0%, #059669 50%, #047857 100%);
      border-radius: 16px 16px 0 0;
    }

    .date-header:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.12), 0 4px 8px rgba(16, 185, 129, 0.06);
      border-color: #10b981;
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
    }

    .date-header > div {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      flex-direction: column;
    }

    .date-title-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
    }

    .date-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(16, 185, 129, 0.2);
      flex-shrink: 0;
    }

    .date-title {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
      letter-spacing: -0.02em;
      margin: 0;
      line-height: 1.3;
    }

    .date-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-top: 6px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .date-stats {
      display: flex !important;
      flex-direction: row !important;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
    }

    .date-stat-item {
      display: flex !important;
      flex-direction: row !important;
      align-items: center;
      gap: 8px;
      background: #ffffff;
      border-radius: 12px;
      padding: 10px 14px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(16, 185, 129, 0.1);
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .date-stat-item:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }

    .date-stat-label {
      font-size: 13px;
      color: #047857;
      font-weight: 600;
      text-transform: none;
      letter-spacing: 0;
      white-space: nowrap;
    }

    .date-stat-value {
      font-size: 18px;
      font-weight: 700;
      color: #059669;
      line-height: 1;
    }

    .date-stat-value.amount {
      color: #047857;
    }

    .sales-grid {
      display: grid;
      gap: 14px;
      margin-top: 10px;
    }

    .sale-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 14px 14px 12px;
      transition: box-shadow 0.12s ease, border-color 0.12s ease, transform 0.12s ease;
    }

    .sale-card:hover {
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
      border-color: var(--border-strong);
      transform: translateY(-1px);
    }

    .sale-header {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #f3f4f6;
      margin-bottom: 10px;
      align-items: flex-start;
    }

    .sale-info {
      flex: 1;
      min-width: 0;
    }

    .sale-id {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 2px;
    }

    .sale-time {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .sale-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .badge {
      padding: 4px 9px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 500;
      border: 1px solid transparent;
      background: #f3f4f6;
      color: var(--text-muted);
    }

    .badge-cash {
      background: #ecfdf3;
      color: #166534;
      border-color: #bbf7d0;
    }

    .badge-card {
      background: #eff6ff;
      color: #1d4ed8;
      border-color: #bfdbfe;
    }

    .badge-staff {
      background: #f3e8ff;
      color: #7c3aed;
      border-color: #e9d5ff;
    }

    .badge-table {
      background: #fef9c3;
      color: #854d0e;
      border-color: #fde68a;
    }

    .badge-expense {
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      color: #c62828;
      border-color: #ef5350;
    }

    /* Masraf KartÄ± Stilleri */
    .expense-card {
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
      border: 1px solid #ef5350;
      border-left: 4px solid #e53935;
      padding: 12px 16px;
    }

    .expense-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .expense-info {
      flex: 1;
      min-width: 0;
    }

    .expense-title {
      font-size: 15px;
      font-weight: 700;
      color: #c62828;
      margin-bottom: 4px;
    }

    .expense-time {
      color: #d32f2f;
      font-size: 11px;
      margin-bottom: 8px;
    }

    .expense-amount {
      text-align: right;
      flex-shrink: 0;
    }

    .expense-label {
      font-size: 10px;
      color: #d32f2f;
      font-weight: 700;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .expense-value {
      font-size: 18px;
      font-weight: 700;
      color: #c62828;
    }

    /* Ä°ptaller Listesi Stilleri */
    .cancels-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 20px 0;
    }

    .cancel-card {
      background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%);
      border: 2px solid #fecaca;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.1);
      transition: all 0.3s ease;
    }

    .cancel-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(239, 68, 68, 0.15);
      border-color: #fca5a5;
    }

    .cancel-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 2px solid #fee2e2;
    }

    .cancel-header-left {
      flex: 1;
    }

    .cancel-product-name {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
      margin-bottom: 8px;
    }

    .cancel-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 13px;
      color: #6b7280;
    }

    .cancel-meta-item {
      display: flex;
      align-items: center;
    }

    .cancel-meta-separator {
      color: #d1d5db;
      margin: 0 4px;
    }

    .cancel-header-right {
      text-align: right;
    }

    .cancel-amount {
      font-size: 22px;
      font-weight: 800;
      color: #dc2626;
      letter-spacing: -0.5px;
    }

    .cancel-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
      padding: 12px;
      background: #fef2f2;
      border-radius: 10px;
    }

    .cancel-detail-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .cancel-detail-label {
      font-size: 12px;
      font-weight: 600;
      color: #9ca3af;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .cancel-detail-value {
      font-size: 15px;
      font-weight: 700;
      color: #1f2937;
    }

    .cancel-reason {
      padding: 14px;
      background: #ffffff;
      border: 2px solid #fee2e2;
      border-radius: 12px;
      border-left: 4px solid #ef4444;
    }

    .cancel-reason-label {
      font-size: 12px;
      font-weight: 700;
      color: #991b1b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .cancel-reason-text {
      font-size: 15px;
      font-weight: 500;
      color: #374151;
      line-height: 1.6;
    }

    @media (max-width: 768px) {
      .cancel-header {
        flex-direction: column;
        gap: 12px;
      }

      .cancel-header-right {
        text-align: left;
        width: 100%;
      }

      .cancel-details {
        grid-template-columns: 1fr;
      }

      .cancel-product-name {
        font-size: 16px;
      }

      .cancel-amount {
        font-size: 20px;
      }
    }

    .sale-total {
      text-align: right;
      min-width: 120px;
    }

    .total-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .total-amount {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-main);
    }

    .sale-items {
      margin-top: 8px;
    }

    .items-label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .items-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .sale-item {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: #f3f4f6;
      font-size: 12px;
      color: var(--text-main);
    }

    .item-name {
      font-weight: 500;
    }

    .item-quantity {
      color: var(--text-muted);
      font-weight: 500;
    }

    .gift-badge {
      font-size: 10px;
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #047857;
      border: 1px solid #a7f3d0;
    }

    .sale-card-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid #f3f4f6;
    }

    .sale-action-btn {
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
    }

    .sale-edit-btn {
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .sale-edit-btn:hover {
      background: #dbeafe;
      border-color: #93c5fd;
    }

    .sale-delete-btn {
      background: #fef2f2;
      color: #dc2626;
      border: 1px solid #fecaca;
    }

    .sale-delete-btn:hover {
      background: #fee2e2;
      border-color: #f87171;
    }

    /* BoÅŸ & hata durumlarÄ± */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      border-radius: var(--radius-lg);
      background: #ffffff;
      border: 1px dashed var(--border-subtle);
    }

    .empty-icon {
      font-size: 56px;
      margin-bottom: 10px;
    }

    .empty-state h3 {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
    }

    .empty-state p {
      font-size: 14px;
      color: var(--text-muted);
    }

    .empty-message {
      text-align: center;
      padding: 20px;
      color: var(--text-muted);
      font-size: 14px;
      font-style: italic;
    }

    /* Masalar Stilleri */
    .tables-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .tables-section {
      background: #ffffff;
      border-radius: var(--radius-lg);
      padding: 12px;
      border: 1px solid var(--border-subtle);
      margin-bottom: 12px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--border-subtle);
    }

    .tables-grid {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 6px;
    }

    .tables-grid.package-grid {
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }

    .table-card {
      background: #ffffff;
      border: 2px solid var(--border-subtle);
      border-radius: 8px;
      padding: 6px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 0;
    }

    .table-amount-badge {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      color: #ffffff;
      font-size: 9px;
      font-weight: 700;
      text-align: center;
      padding: 2px 4px;
      z-index: 10;
      border-radius: 8px 8px 0 0;
    }

    .table-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    .table-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 4px;
    }

    .table-number {
      font-size: 16px;
      font-weight: 800;
      color: var(--text-main);
      line-height: 1;
    }

    .table-status {
      padding: 2px 5px;
      border-radius: 999px;
      font-size: 7px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .table-name {
      font-size: 9px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 4px;
      line-height: 1.2;
    }

    .table-details {
      margin-top: auto;
      padding-top: 4px;
      border-top: 1px solid var(--border-subtle);
      flex-shrink: 0;
    }

    .table-amount {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }

    .amount-label {
      font-size: 7px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .amount-value {
      font-size: 10px;
      font-weight: 700;
      color: #dc2626;
      line-height: 1;
    }

    .table-items-count {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 3px;
    }

    .items-label {
      font-size: 7px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .items-value {
      font-size: 9px;
      font-weight: 600;
      color: var(--text-main);
    }

    .table-items {
      margin-top: 3px;
      max-height: 50px;
      overflow-y: auto;
    }

    .table-items-title {
      font-size: 7px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-bottom: 2px;
    }

    .table-card.occupied .table-items-title {
      color: rgba(255, 255, 255, 0.8);
    }

    .table-card.occupied .table-item {
      background: rgba(255, 255, 255, 0.2);
      color: #ffffff;
    }

    .table-card.occupied .item-name,
    .table-card.occupied .item-quantity {
      color: #ffffff;
    }

    .table-card.occupied .table-item-more {
      color: rgba(255, 255, 255, 0.8);
    }

    /* Dolu Masalar - Modern Gradient TasarÄ±m */
    .table-card-occupied {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 50%, #991b1b 100%);
      border: none;
      padding: 0;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.25);
    }

    .table-card-occupied:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(220, 38, 38, 0.35);
    }

    .table-card-gradient {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      padding: 12px 8px;
      min-height: 100%;
    }

    .table-number-occupied {
      font-size: 24px;
      font-weight: 800;
      color: #ffffff;
      line-height: 1;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      letter-spacing: -0.5px;
    }

    .table-amount-occupied {
      font-size: 14px;
      font-weight: 700;
      color: #ffffff;
      line-height: 1;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      opacity: 0.95;
      margin-top: auto;
    }

    .table-items-list {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .table-item {
      display: flex;
      align-items: center;
      gap: 3px;
      padding: 2px 4px;
      background: #f3f4f6;
      border-radius: 4px;
      font-size: 7px;
    }

    .item-name {
      flex: 1;
      font-weight: 500;
      color: var(--text-main);
      font-size: 6px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .item-quantity {
      color: var(--text-muted);
      font-weight: 600;
      font-size: 6px;
    }

    .item-gift {
      font-size: 6px;
      font-weight: 700;
      padding: 1px 3px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #047857;
      border: 1px solid #a7f3d0;
      white-space: nowrap;
    }

    .table-item-more {
      font-size: 6px;
      color: var(--text-muted);
      font-style: italic;
      text-align: center;
      padding: 2px;
    }

    .error-card {
      text-align: center;
      padding: 32px 20px;
      background: #fef2f2;
      border-radius: var(--radius-lg);
      border: 1px solid #fecaca;
    }

    .error-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .error-card h3 {
      font-size: 18px;
      color: #b91c1c;
      margin-bottom: 6px;
      font-weight: 600;
    }

    .error-card p {
      color: var(--text-muted);
      margin-bottom: 14px;
      font-size: 14px;
    }

    .retry-btn {
      padding: 9px 20px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(90deg, #dc2626, #b91c1c);
      color: #ffffff;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(220, 38, 38, 0.25);
    }

    /* Admin Splash Screen */
    .admin-splash-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      overflow: hidden;
    }

    .splash-content {
      position: relative;
      z-index: 1;
      width: 100%;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .splash-logo {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 50%;
      margin-bottom: 32px;
      animation: logoFadeIn 0.8s ease-out forwards;
      opacity: 0;
    }

    .splash-main-text {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-weight: 800;
      font-size: clamp(4rem, 12vw, 8rem);
      line-height: 0.9;
      letter-spacing: 0.15em;
      color: #0a0a0a;
      margin: 0;
      padding: 0;
      text-align: center;
      text-transform: uppercase;
      animation: mainTextReveal 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      opacity: 0;
    }

    .splash-decorative-line {
      width: 0%;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #d1d5db 50%, transparent 100%);
      margin: 32px auto 40px;
      max-width: 400px;
      animation: lineExpand 1s ease-out forwards;
      animation-delay: 0.5s;
      opacity: 0;
    }

    .splash-subtitle-text {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size: clamp(0.875rem, 1.5vw, 1.125rem);
      font-weight: 400;
      color: #6b7280;
      margin: 0;
      padding: 0;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      text-align: center;
      opacity: 0.7;
      animation: subtitleFadeIn 0.8s ease-out forwards;
      animation-delay: 0.3s;
      opacity: 0;
    }

    @keyframes logoFadeIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes mainTextReveal {
      0% {
        opacity: 0;
        transform: translateY(40px) scale(0.95);
        letter-spacing: 0.3em;
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
        letter-spacing: 0.15em;
      }
    }

    @keyframes subtitleFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes lineExpand {
      from {
        width: 0%;
        opacity: 0;
      }
      to {
        width: 100%;
        opacity: 1;
      }
    }

    /* Dekoratif arka plan elementleri */
    .admin-splash-screen::before {
      content: '';
      position: absolute;
      top: 20%;
      left: 10%;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(236, 72, 153, 0.03) 0%, transparent 70%);
      border-radius: 50%;
      filter: blur(40px);
      pointer-events: none;
    }

    .admin-splash-screen::after {
      content: '';
      position: absolute;
      bottom: 20%;
      right: 10%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(236, 72, 153, 0.02) 0%, transparent 70%);
      border-radius: 50%;
      filter: blur(60px);
      pointer-events: none;
    }

    /* Sekme butonlarÄ± */
    .tab-buttons-container {
      width: 100%;
      padding: 0 16px;
      margin-bottom: 20px;
    }

    .tab-buttons {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      grid-template-rows: repeat(2, auto);
      gap: 12px;
      margin: 20px 0 24px;
    }

    @media (min-width: 768px) {
      .tab-buttons {
        grid-template-columns: repeat(3, minmax(0, 1fr));
        grid-template-rows: repeat(2, auto);
      }
    }

    .tab-btn {
      padding: 16px 8px;
      border-radius: 16px;
      border: 2px solid #e5e7eb;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      font-size: 12px;
      font-weight: 600;
      color: #64748b;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      min-height: 72px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .tab-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(255, 255, 255, 0.4) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .tab-btn span {
      white-space: nowrap;
      text-overflow: ellipsis;
      max-width: 100%;
      overflow: hidden;
    }

    .tab-btn-icon {
      font-size: 24px;
      line-height: 1;
      filter: grayscale(0.3);
      transition: all 0.3s ease;
    }

    .tab-btn-text {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.2px;
      transition: all 0.3s ease;
    }

    .tab-btn-indicator {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary, #f97316) 0%, var(--primary-strong, #ea580c) 100%);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 0 0 16px 16px;
    }

    .tab-btn:hover {
      border-color: #cbd5e1;
      background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12), 0 0 0 1px rgba(148, 163, 184, 0.1);
      transform: translateY(-2px);
      color: #475569;
    }

    .tab-btn:hover::before {
      opacity: 1;
    }

    .tab-btn:hover .tab-btn-icon {
      filter: grayscale(0);
      transform: scale(1.1);
    }

    .tab-btn.active {
      border-color: var(--primary, #f97316);
      background: linear-gradient(135deg, var(--primary-soft, #fff7ed) 0%, #ffedd5 100%);
      color: var(--primary-strong, #ea580c);
      box-shadow: 0 8px 24px rgba(249, 115, 22, 0.2), 0 0 0 1px rgba(249, 115, 22, 0.1);
      transform: translateY(-2px);
    }

    .tab-btn.active::before {
      opacity: 0;
    }

    .tab-btn.active .tab-btn-icon {
      filter: grayscale(0);
      transform: scale(1.15);
    }

    .tab-btn.active .tab-btn-text {
      color: var(--primary-strong, #ea580c);
      font-weight: 700;
    }

    .tab-btn.active .tab-btn-indicator {
      transform: scaleX(1);
      background: linear-gradient(90deg, var(--primary, #f97316) 0%, var(--primary-strong, #ea580c) 100%);
    }

    /* Raporlar */
    .reports-container {
      padding: 10px 0 6px;
    }

    .reports-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .reports-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-main);
      white-space: nowrap;
      flex-shrink: 0;
    }

    .analyze-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px 20px;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      color: #1f2937;
      border: 2px solid var(--primary, #f97316);
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 8px rgba(249, 115, 22, 0.15);
      position: relative;
      overflow: hidden;
    }

    .analyze-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      transition: left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 0;
    }

    .analyze-btn span {
      position: relative;
      z-index: 1;
      transition: color 0.3s ease;
    }

    .analyze-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(236, 72, 153, 0.3);
      border-color: #db2777;
    }

    .analyze-btn:hover::before {
      left: 0;
    }

    .analyze-btn:hover span {
      color: #ffffff;
    }

    .analyze-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(236, 72, 153, 0.2);
    }

    .date-filter-wrapper {
      position: relative;
    }

    .date-filter-trigger {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      font-size: 12px;
      background: #ffffff;
      cursor: pointer;
      color: var(--text-muted);
    }

    .date-filter-arrow {
      font-size: 10px;
    }

    /* GÃ¼nlÃ¼k Ciro DetaylarÄ± Modal */
    /* GÃ¼nlÃ¼k Ciro DetaylarÄ± Modal - Mobil Uyumlu */
    .daily-revenue-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10000;
      align-items: flex-end;
      justify-content: center;
      padding: 0;
    }

    .daily-revenue-modal.show {
      display: flex;
    }

    .daily-revenue-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(2px);
    }

    .daily-revenue-modal-content {
      position: relative;
      background: white;
      border-radius: 20px 20px 0 0;
      width: 100%;
      max-width: 100%;
      max-height: 95vh;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      animation: modalSlideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes modalSlideUp {
      from {
        opacity: 0;
        transform: translateY(100%);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .daily-revenue-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 16px 12px 16px;
      border-bottom: 1px solid #e5e7eb;
      background: #ffffff;
      flex-shrink: 0;
    }

    .daily-revenue-modal-header h2 {
      margin: 0;
      font-size: 16px;
      font-weight: 700;
      color: #1e293b;
    }

    .daily-revenue-modal-close {
      background: #f3f4f6;
      border: none;
      color: #374151;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .daily-revenue-modal-close:hover {
      background: #e5e7eb;
    }

    .daily-revenue-modal-close:active {
      transform: scale(0.95);
    }

    .daily-revenue-modal-body {
      padding: 0;
      overflow-y: auto;
      flex: 1;
      -webkit-overflow-scrolling: touch;
    }

    /* Mobil iÃ§in optimize edilmiÅŸ scrollbar */
    .daily-revenue-modal-body::-webkit-scrollbar {
      width: 4px;
    }

    .daily-revenue-modal-body::-webkit-scrollbar-track {
      background: #f9fafb;
    }

    .daily-revenue-modal-body::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 2px;
    }

    .daily-revenue-modal-body::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }

    .date-filter-modal {
      position: absolute;
      right: 0;
      top: calc(100% + 6px);
      min-width: 200px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.18);
      border: 1px solid var(--border-subtle);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-6px);
      transition: all 0.15s ease;
      z-index: 20;
    }

    .date-filter-modal.show {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .date-filter-modal-content {
      padding: 6px;
    }

    .date-filter-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 8px;
      font-size: 13px;
      color: var(--text-muted);
      cursor: pointer;
    }

    .date-filter-option:hover {
      background: var(--bg-subtle);
    }

    .date-filter-option.active {
      background: var(--primary-soft);
      color: var(--primary-strong);
      font-weight: 500;
    }

    .date-filter-divider {
      height: 1px;
      background: var(--border-subtle);
      margin: 4px 0;
    }

    .custom-date-range-section {
      padding: 10px;
      background: var(--bg-subtle);
      border-radius: 8px;
      margin-top: 4px;
    }

    .custom-date-inputs {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
    }

    .custom-date-input-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .custom-date-input-group label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
    }

    .custom-date-input {
      padding: 6px 8px;
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      font-size: 12px;
      background: #ffffff;
      color: var(--text-main);
    }

    .custom-date-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-soft);
    }

    .custom-date-apply-btn {
      width: 100%;
      padding: 8px;
      background: var(--primary);
      color: #ffffff;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .custom-date-apply-btn:hover {
      background: var(--primary-strong);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(220, 38, 38, 0.2);
    }

    /* SeÃ§ilen Zaman Dilimi Ciro ve Masraf Container */
    .period-revenue-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
      margin-bottom: 28px;
    }

    /* Trendyol / Yemeksepeti / Migros Yemek kartlarÄ± iÃ§in */
    .platform-revenue-container {
      grid-template-columns: repeat(3, 1fr);
    }

    @media (max-width: 1100px) {
      .platform-revenue-container {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 560px) {
      .platform-revenue-container {
        grid-template-columns: 1fr;
      }
    }

    /* Masraf kartÄ±nÄ±n altÄ±na Zahiyat kartÄ± (B/W kurumsal) */
    .period-expense-stack {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .period-zahiyat-card {
      position: relative;
      border-radius: 20px;
      padding: 22px 22px;
      background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
      border: 2px solid #0f172a;
      box-shadow: 0 14px 34px rgba(15, 23, 42, 0.14);
      overflow: hidden;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      color: #0f172a;
    }

    .period-zahiyat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 44px rgba(15, 23, 42, 0.18);
    }

    .period-zahiyat-accent {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #0f172a 0%, #334155 50%, #0f172a 100%);
      opacity: 0.9;
    }

    .period-zahiyat-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(15, 23, 42, 0.18);
      background: rgba(15, 23, 42, 0.04);
      font-size: 11px;
      font-weight: 900;
      letter-spacing: 0.8px;
      text-transform: uppercase;
      color: #0f172a;
    }

    .period-zahiyat-meta {
      margin-top: 6px;
      font-size: 11px;
      font-weight: 700;
      color: #64748b;
    }

    .period-zahiyat-amount {
      margin-top: 14px;
      font-size: 30px;
      font-weight: 950;
      letter-spacing: -1px;
      color: #0f172a;
      line-height: 1;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
    }

    /* Zahiyat modal */
    .zahiyat-modal-overlay {
      position: fixed;
      inset: 0;
      z-index: 20050;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      background: rgba(2, 6, 23, 0.62);
      backdrop-filter: blur(8px);
    }

    .zahiyat-modal {
      width: 100%;
      max-width: 980px;
      max-height: 90vh;
      overflow: hidden;
      border-radius: 24px;
      background: #ffffff;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 30px 90px rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      animation: slideUp 0.22s ease;
    }

    .zahiyat-modal-header {
      padding: 16px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: linear-gradient(135deg, #0f172a 0%, #111827 100%);
      color: #ffffff;
    }

    .zahiyat-modal-title {
      margin: 0;
      font-size: 16px;
      font-weight: 950;
      letter-spacing: -0.2px;
    }

    .zahiyat-modal-subtitle {
      margin: 4px 0 0 0;
      font-size: 12px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.78);
    }

    .zahiyat-modal-close {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.22);
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      cursor: pointer;
      font-size: 24px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.15s ease, background 0.15s ease;
      flex: 0 0 auto;
    }

    .zahiyat-modal-close:hover {
      transform: scale(1.03);
      background: rgba(255, 255, 255, 0.18);
    }

    .zahiyat-modal-body {
      padding: 14px 16px 18px 16px;
      overflow: auto;
    }

    .zahiyat-modal-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 14px;
      border: 2px solid #e5e7eb;
      border-radius: 18px;
      background: #ffffff;
      margin-bottom: 12px;
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      z-index: 5;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    .zahiyat-modal-pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      font-weight: 900;
      color: #0f172a;
      font-size: 12px;
      white-space: nowrap;
    }

    .zahiyat-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .zahiyat-item-card {
      border: 1px solid #e2e8f0;
      border-radius: 18px;
      background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.04);
      padding: 14px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .zahiyat-item-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
    }

    .zahiyat-item-person {
      font-weight: 950;
      color: #0f172a;
      font-size: 14px;
      line-height: 1.2;
    }

    .zahiyat-item-meta {
      margin-top: 4px;
      font-size: 12px;
      font-weight: 700;
      color: #64748b;
    }

    .zahiyat-item-amount {
      font-weight: 950;
      color: #0f172a;
      font-size: 14px;
      white-space: nowrap;
      text-align: right;
    }

    .zahiyat-products {
      border-top: 1px solid rgba(15, 23, 42, 0.08);
      padding-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .zahiyat-product-line {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      font-size: 12px;
      font-weight: 800;
      color: #0f172a;
    }

    .zahiyat-product-sub {
      font-size: 11px;
      font-weight: 700;
      color: #64748b;
      margin-top: 2px;
    }

    @media (min-width: 900px) {
      .zahiyat-list {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    /* SeÃ§ilen Zaman Dilimi Ciro KartÄ± */
    .period-revenue-card,
    .period-expense-card {
      position: relative;
      background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 10px 40px rgba(16, 185, 129, 0.3), 0 4px 16px rgba(16, 185, 129, 0.2);
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .period-expense-card {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
      box-shadow: 0 10px 40px rgba(239, 68, 68, 0.3), 0 4px 16px rgba(239, 68, 68, 0.2);
    }

    .period-revenue-card:hover,
    .period-expense-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 16px 48px rgba(16, 185, 129, 0.4), 0 8px 24px rgba(16, 185, 129, 0.3);
    }

    .period-expense-card:hover {
      box-shadow: 0 16px 48px rgba(239, 68, 68, 0.4), 0 8px 24px rgba(239, 68, 68, 0.3);
    }

    .period-card-background {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.2) 0%, transparent 50%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .period-revenue-card:hover .period-card-background,
    .period-expense-card:hover .period-card-background {
      opacity: 1;
    }

    .period-card-icon {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .period-card-icon svg {
      width: 28px;
      height: 28px;
      color: rgba(255, 255, 255, 0.9);
    }

    .period-revenue-card:hover .period-card-icon,
    .period-expense-card:hover .period-card-icon {
      transform: scale(1.1) rotate(5deg);
      background: rgba(255, 255, 255, 0.25);
    }

    .period-card-decoration {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 200px;
      height: 200px;
      opacity: 0.3;
      pointer-events: none;
    }

    .period-card-decoration svg {
      width: 100%;
      height: 100%;
    }

    .period-revenue-content {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .period-revenue-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.95);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .period-label-icon {
      font-size: 16px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }

    /* Analiz Modal */
    .analysis-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .analysis-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(8px);
    }

    .analysis-modal-content {
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      width: 100%;
      max-width: 900px;
      max-height: 85vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .analysis-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 24px 28px;
      border-bottom: 2px solid #ec4899;
      background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);
    }

    .analysis-modal-title {
      font-size: 22px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }

    .analysis-modal-close {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: none;
      background: #ffffff;
      color: #6b7280;
      font-size: 24px;
      font-weight: 300;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      line-height: 1;
    }

    .analysis-modal-close:hover {
      background: #f3f4f6;
      color: #1f2937;
      transform: rotate(90deg);
    }

    .analysis-modal-body {
      padding: 28px;
      overflow-y: auto;
      flex: 1;
      background: #ffffff;
    }

    .analysis-content {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 14px;
      line-height: 1.6;
    }

    /* GÃ¼nlÃ¼k Ciro Modal Stilleri */
    .daily-revenue-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }

    .daily-revenue-modal-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: transparent;
    }

    .daily-revenue-modal-content {
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      width: 100%;
      max-width: 500px;
      max-height: 90vh;
      height: 90vh;
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Mobil iÃ§in responsive */
    @media (max-width: 768px) {
      .daily-revenue-modal {
        padding: 0;
        align-items: flex-end;
      }

      .daily-revenue-modal-content {
        max-width: 100%;
        max-height: 95vh;
        height: 95vh;
        border-radius: 20px 20px 0 0;
        animation: slideUpMobile 0.3s ease-out;
      }

      @keyframes slideUpMobile {
        from {
          opacity: 0;
          transform: translateY(100%);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    }
      color: #1f2937;
      min-height: 200px;
    }

    .analysis-text-content {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      font-size: 14px;
      line-height: 1.8;
      color: #1f2937;
      white-space: pre-wrap;
      word-wrap: break-word;
      margin-bottom: 24px;
      padding: 20px;
      background: #f9fafb;
      border-radius: 12px;
      border-left: 4px solid var(--primary, #f97316);
    }

    .analysis-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .analysis-card {
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .analysis-card:hover {
      border-color: var(--primary, #f97316);
      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.1);
      transform: translateY(-2px);
    }

    .analysis-card-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #f3f4f6;
    }

    .analysis-icon {
      font-size: 20px;
    }

    .analysis-card-header h3 {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }

    .analysis-card-body {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .analysis-comparison {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .comparison-item {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .comparison-label {
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
    }

    .comparison-value {
      font-size: 18px;
      font-weight: 700;
      color: #1f2937;
    }

    .comparison-value.positive {
      color: #10b981;
    }

    .comparison-value.negative {
      color: #ef4444;
    }

    .comparison-arrow {
      font-size: 20px;
      color: #9ca3af;
      font-weight: 300;
    }

    .analysis-trend {
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      text-align: center;
    }

    .analysis-trend.trend-up {
      background: #ecfdf5;
      color: #059669;
    }

    .analysis-trend.trend-down {
      background: #fef2f2;
      color: #dc2626;
    }

    .product-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px;
      background: #f9fafb;
      border-radius: 10px;
    }

    .product-rank {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 13px;
    }

    .product-name {
      flex: 1;
      font-weight: 600;
      color: #1f2937;
    }

    .product-count {
      font-size: 13px;
      color: #6b7280;
      font-weight: 500;
    }

    .analysis-tables {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .analysis-table {
      background: #ffffff;
      border: 2px solid #e5e7eb;
      border-radius: 16px;
      overflow: hidden;
    }

    .table-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 16px 20px;
      background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
      border-bottom: 2px solid #e5e7eb;
    }

    .table-icon {
      font-size: 18px;
    }

    .table-header h3 {
      font-size: 16px;
      font-weight: 700;
      color: #1f2937;
      margin: 0;
    }

    .recommendations-table .table-header {
      border-bottom-color: #10b981;
    }

    .risks-table .table-header {
      border-bottom-color: #ef4444;
    }

    .table-body {
      padding: 16px 20px;
    }

    .table-row {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid #f3f4f6;
    }

    .table-row:last-child {
      border-bottom: none;
    }

    .row-bullet {
      color: #ec4899;
      font-weight: 700;
      font-size: 16px;
      line-height: 1.4;
    }

    .row-text {
      flex: 1;
      font-size: 14px;
      line-height: 1.6;
      color: #374151;
    }

    .row-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .row-main-text {
      font-size: 14px;
      line-height: 1.5;
      color: #1f2937;
      font-weight: 500;
    }

    .row-reason {
      font-size: 12px;
      color: #6b7280;
      line-height: 1.4;
    }

    .recommendation-price {
      background: #f0fdf4;
      border-left: 3px solid #10b981;
      padding-left: 16px;
    }

    .risk-item {
      background: #fef2f2;
      border-left: 3px solid #ef4444;
      padding-left: 16px;
    }

    .price-suggestion {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .old-price {
      font-size: 14px;
      color: #9ca3af;
      text-decoration: line-through;
      font-weight: 500;
    }

    .new-price {
      font-size: 16px;
      color: #10b981;
      font-weight: 700;
    }

    .price-change {
      font-size: 12px;
      color: #6b7280;
      font-weight: 500;
    }

    .price-change.positive {
      color: #10b981;
    }

    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 16px;
      padding: 12px;
      background: #f9fafb;
      border-radius: 8px;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ec4899;
      animation: typingDot 1.4s infinite;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typingDot {
      0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.7;
      }
      30% {
        transform: translateY(-10px);
        opacity: 1;
      }
    }

    .period-revenue-period {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.85);
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .period-revenue-amount {
      font-size: 36px;
      font-weight: 900;
      color: #ffffff;
      line-height: 1.1;
      text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2);
      letter-spacing: -0.02em;
      margin-top: 4px;
    }

    /* Raporlama BaÅŸlÄ±k Ä°yileÅŸtirmeleri */
    .reports-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      gap: 16px;
    }

    .reports-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-main);
      margin: 0;
      line-height: 1.2;
    }

    .reports-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
      font-weight: 500;
    }

    .reports-container-modern {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 18px;
    }

    .report-group {
      position: relative;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 20px;
      padding: 20px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.06);
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .report-group:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .report-group-rising {
      background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 50%, #ffffff 100%);
      border-color: rgba(16, 185, 129, 0.15);
    }

    .report-group-rising::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #10b981 0%, #059669 50%, #047857 100%);
    }

    .report-group-falling {
      background: linear-gradient(135deg, #ffffff 0%, #fffbeb 50%, #ffffff 100%);
      border-color: rgba(245, 158, 11, 0.15);
    }

    .report-group-falling::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
    }

    .report-group-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
      padding-bottom: 14px;
      border-bottom: 2px solid #f1f5f9;
    }

    .report-group-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      font-weight: 700;
      color: #0f172a;
      letter-spacing: -0.02em;
    }

    .report-group-rising .report-group-title {
      color: #059669;
    }

    .report-group-falling .report-group-title {
      color: #d97706;
    }

    .chart-icon {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .chart-icon-rising {
      color: #10b981;
    }

    .chart-icon-falling {
      color: #f59e0b;
    }

    .report-group-chart {
      width: 120px;
      height: 40px;
      flex-shrink: 0;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }

    .report-group:hover .report-group-chart {
      opacity: 1;
    }

    .chart-svg {
      width: 100%;
      height: 100%;
    }

    .report-group-cards {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
    }

    .reports-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      margin-bottom: 18px;
    }

    .report-card {
      position: relative;
      background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 14px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
    }

    .report-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      pointer-events: none;
    }

    .report-card::after {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .report-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
    }

    .report-card:hover::after {
      opacity: 1;
    }

    .report-card-top-sold {
      background: linear-gradient(135deg, #ffffff 0%, #f0fdf4 100%);
      border-color: rgba(16, 185, 129, 0.2);
    }

    .report-card-top-sold::before {
      background: linear-gradient(90deg, #10b981 0%, #059669 50%, #047857 100%);
    }

    .report-card-top-sold:hover {
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.15), 0 4px 8px rgba(16, 185, 129, 0.1);
    }

    .report-card-least-sold {
      background: linear-gradient(135deg, #ffffff 0%, #f9fafb 100%);
      border-color: rgba(107, 114, 128, 0.2);
    }

    .report-card-least-sold::before {
      background: linear-gradient(90deg, #6b7280 0%, #4b5563 50%, #374151 100%);
    }

    .report-card-least-sold:hover {
      box-shadow: 0 8px 24px rgba(107, 114, 128, 0.15), 0 4px 8px rgba(107, 114, 128, 0.1);
    }

    .report-card-top-earning {
      background: linear-gradient(135deg, #ffffff 0%, #eff6ff 100%);
      border-color: rgba(59, 130, 246, 0.2);
    }

    .report-card-top-earning::before {
      background: linear-gradient(90deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
    }

    .report-card-top-earning:hover {
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.15), 0 4px 8px rgba(59, 130, 246, 0.1);
    }

    .report-card-least-earning {
      background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%);
      border-color: rgba(245, 158, 11, 0.2);
    }

    .report-card-least-earning::before {
      background: linear-gradient(90deg, #f59e0b 0%, #d97706 50%, #b45309 100%);
    }

    .report-card-least-earning:hover {
      box-shadow: 0 8px 24px rgba(245, 158, 11, 0.15), 0 4px 8px rgba(245, 158, 11, 0.1);
    }

    .report-card-title {
      font-size: 12px;
      font-weight: 700;
      margin: 0;
      color: #1f2937;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .report-card-title::before {
      content: '';
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: currentColor;
    }

    .report-card-top-sold .report-card-title {
      color: #059669;
    }

    .report-card-least-sold .report-card-title {
      color: #4b5563;
    }

    .report-card-top-earning .report-card-title {
      color: #2563eb;
    }

    .report-card-least-earning .report-card-title {
      color: #d97706;
    }

    .product-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .product-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 14px;
      border-radius: 12px;
      background: #ffffff;
      border: 1.5px solid #f1f5f9;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .product-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: #e2e8f0;
      transition: width 0.25s ease;
    }

    .product-item:hover {
      background: #f8fafc;
      border-color: #e2e8f0;
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
    }

    .product-item:hover::before {
      width: 4px;
    }

    .report-card-top-sold .product-item:hover::before {
      background: linear-gradient(180deg, #10b981 0%, #059669 100%);
    }

    .report-card-top-earning .product-item:hover::before {
      background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
    }

    .report-card-least-sold .product-item:hover::before {
      background: linear-gradient(180deg, #6b7280 0%, #4b5563 100%);
    }

    .report-card-least-earning .product-item:hover::before {
      background: linear-gradient(180deg, #f59e0b 0%, #d97706 100%);
    }

    .product-rank {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      color: #475569;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      border: 2px solid #ffffff;
      flex-shrink: 0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.25s ease;
    }

    .product-item:hover .product-rank {
      transform: scale(1.05);
    }

    .report-card-top-sold .product-item:first-child .product-rank {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: #ffffff;
      border-color: #10b981;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .report-card-top-earning .product-item:first-child .product-rank {
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: #ffffff;
      border-color: #3b82f6;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }

    .report-card-least-sold .product-item:first-child .product-rank {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      color: #ffffff;
      border-color: #6b7280;
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }

    .report-card-least-earning .product-item:first-child .product-rank {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: #ffffff;
      border-color: #f59e0b;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
    }

    .product-info {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .product-name {
      font-size: 14px;
      font-weight: 600;
      color: #0f172a;
      line-height: 1.5;
      word-break: break-word;
      letter-spacing: -0.01em;
    }

    .product-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .product-quantity {
      font-size: 12px;
      color: #64748b;
      font-weight: 500;
      background: #f1f5f9;
      padding: 4px 8px;
      border-radius: 6px;
    }

    .product-total {
      font-size: 15px;
      font-weight: 700;
      color: #059669;
      letter-spacing: -0.02em;
    }

    .product-total-emphasis {
      font-size: 16px;
      font-weight: 800;
      color: #2563eb;
      text-shadow: 0 1px 2px rgba(37, 99, 235, 0.1);
    }

    .report-card-top-earning .product-total {
      color: #2563eb;
    }

    .report-card-top-earning .product-total-emphasis {
      color: #1d4ed8;
    }

    .report-card-least-earning .product-total {
      color: #d97706;
    }

    .report-card-least-sold .product-total {
      color: #475569;
    }

    .no-data {
      text-align: center;
      font-size: 13px;
      color: var(--text-muted);
      padding: 10px 0;
    }

    .payment-methods {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .payment-method-item {
      padding: 10px 10px 8px;
      border-radius: 10px;
      background: var(--bg-subtle);
    }

    .payment-method-header {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: var(--text-main);
      margin-bottom: 4px;
    }

    .payment-method-count {
      font-size: 12px;
      color: var(--text-muted);
    }

    .payment-progress-bar {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-bottom: 4px;
    }

    .payment-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #6366f1, var(--primary, #f97316));
      transition: width 0.2s ease;
    }

    .payment-total {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Personel kartlarÄ± */
    .staff-container {
      padding: 10px 0 6px;
    }

    .staff-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 16px;
    }

    .staff-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 16px;
    }

    .staff-card {
      background: #ffffff;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 16px 16px 14px;
    }

    .staff-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid #f3f4f6;
      margin-bottom: 10px;
    }

    .staff-avatar {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fee2e2;
      font-size: 22px;
    }

    .staff-avatar.gold { background: #fef3c7; }
    .staff-avatar.silver { background: #e5e7eb; }
    .staff-avatar.bronze { background: #ffedd5; }

    .staff-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-main);
    }

    .staff-sales-count {
      font-size: 12px;
      color: var(--text-muted);
    }

    .staff-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }

    .staff-stat-card {
      border-radius: 10px;
      padding: 10px 10px 8px;
      background: var(--bg-subtle);
      border: 1px solid var(--border-subtle);
    }

    .staff-stat-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 2px;
    }

    .staff-stat-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-main);
    }

    .staff-stat-sub {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .staff-top-products-title {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-main);
      margin-bottom: 6px;
    }

    .staff-products-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .staff-product-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 8px;
      border-radius: 10px;
      background: #f9fafb;
    }

    .staff-product-rank {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes toastSlideIn {
      from {
        transform: translateX(400px) scale(0.9);
        opacity: 0;
      }
      to {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
    }

    @keyframes toastSlideOut {
      from {
        transform: translateX(0) scale(1);
        opacity: 1;
      }
      to {
        transform: translateX(400px) scale(0.9);
        opacity: 0;
      }
    }

    .staff-product-info {
      flex: 1;
    }

    .staff-product-name {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-main);
    }

    .staff-product-revenue {
      font-size: 11px;
      color: var(--text-muted);
    }

    .staff-product-count {
      font-size: 12px;
      font-weight: 600;
      color: var(--primary-strong);
    }

    /* Responsive */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 14px;
        border-radius: 16px;
      }

      .dashboard-header {
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
      }

      .admin-navbar {
        padding: 10px 16px;
      }

      .navbar-content {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .navbar-brand {
        justify-content: center;
        text-align: center;
      }

      .navbar-title-group {
        align-items: center;
      }

      .navbar-actions {
        justify-content: center;
        width: 100%;
      }

      .dashboard-header > div {
        justify-content: stretch;
      }

      .refresh-btn,
      .logout-btn {
        flex: 1;
        justify-content: center;
      }

      .stats-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .payment-breakdown-card {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
      }

      .payment-breakdown-item {
        justify-content: space-between;
      }

      .reports-header {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }

      .analysis-modal-content {
        max-width: 95%;
        max-height: 90vh;
      }

      .analysis-summary {
        grid-template-columns: 1fr;
      }

      .analysis-tables {
        grid-template-columns: 1fr;
      }

      .reports-title {
        font-size: 20px;
      }

      .reports-subtitle {
        font-size: 12px;
      }

      .period-revenue-container {
        grid-template-columns: 1fr;
        gap: 14px;
        margin-bottom: 20px;
      }

      .period-revenue-card,
      .period-expense-card {
        padding: 20px 18px;
        border-radius: 18px;
      }

      .period-card-icon {
        width: 48px;
        height: 48px;
        top: 16px;
        right: 16px;
        border-radius: 14px;
      }

      .period-card-icon svg {
        width: 24px;
        height: 24px;
      }

      .period-revenue-label {
        font-size: 10px;
        gap: 6px;
      }

      .period-label-icon {
        font-size: 14px;
      }

      .period-revenue-period {
        font-size: 12px;
      }

      .period-revenue-amount {
        font-size: 28px;
      }

      .period-card-decoration {
        width: 150px;
        height: 150px;
      }

      .custom-date-inputs {
        gap: 6px;
      }

      .custom-date-input {
        font-size: 11px;
        padding: 5px 6px;
      }

      .tab-buttons {
        gap: 8px;
        grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
        grid-template-rows: repeat(2, auto) !important;
      }

      .tab-buttons-container {
        padding: 0 12px;
      }

      /* DetaylÄ± raporlama: 4 kutu tek ekrana daha rahat sÄ±ÄŸsÄ±n */
      .reports-container .stats-grid {
        display: none;
      }

      .reports-container-modern {
        gap: 12px;
      }

      .report-group {
        padding: 16px 14px;
        border-radius: 16px;
      }

      .report-group-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 14px;
        padding-bottom: 12px;
      }

      .report-group-title {
        font-size: 13px;
      }

      .chart-icon {
        width: 20px;
        height: 20px;
      }

      .report-group-chart {
        width: 100px;
        height: 35px;
        align-self: flex-end;
      }

      .report-group-cards {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .reports-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px;
      }

      .report-card {
        padding: 14px 12px;
        gap: 12px;
        border-radius: 14px;
      }

      .report-card-title {
        font-size: 10px;
        margin-bottom: 4px;
      }

      .product-item {
        padding: 10px;
        gap: 10px;
      }

      .product-rank {
        width: 22px;
        height: 22px;
        font-size: 11px;
      }

      .product-name {
        font-size: 13px;
      }

      .product-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }

      .product-quantity {
        font-size: 11px;
      }

      .product-total {
        font-size: 13px;
      }

      .product-total-emphasis {
        font-size: 14px;
      }

      .reports-grid {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      .sale-header {
        flex-direction: column;
      }

      .sale-total {
        text-align: left;
      }

      .reports-header {
        flex-direction: column;
        align-items: stretch;
      }

      .date-filter-wrapper {
        align-self: stretch;
      }

      .date-filter-trigger {
        width: 100%;
        justify-content: space-between;
      }

      /* ÃœrÃ¼n DetaylÄ± Rapor Tablosu - Mobil Optimizasyon */
      .report-card > div:last-child {
        max-height: calc(100vh - 350px) !important;
      }
      
      /* Saat BazlÄ± Grafik - Mobil Optimizasyon */
      .report-card .hourly-chart-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .report-card .hourly-chart-container > div {
        min-width: 600px;
      }
      
      /* Masalar responsive */
      .tables-grid {
        grid-template-columns: repeat(5, 1fr);
        gap: 4px;
      }

      .tables-grid.package-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 4px;
      }

      .table-card {
        padding: 4px;
      }

      .table-number {
        font-size: 14px;
      }

      .table-number-occupied {
        font-size: 18px;
      }

      .table-amount-occupied {
        font-size: 11px;
      }

      .table-card-gradient {
        padding: 8px 6px;
      }

      .date-header {
        padding: 14px 16px;
        border-radius: 12px;
      }

      .date-header > div {
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 12px;
      }

      .date-title-wrapper {
        width: 100%;
      }

      .date-icon {
        width: 36px;
        height: 36px;
        font-size: 16px;
      }

      .date-title {
        font-size: 15px;
      }

      .date-subtitle {
        font-size: 12px;
        flex-wrap: wrap;
      }

      .date-stats {
        display: flex !important;
        flex-direction: row !important;
        width: auto;
        justify-content: flex-end;
        gap: 10px;
        flex-shrink: 0;
      }

      .date-stat-item {
        align-items: center;
        flex: 0 0 auto;
        flex-direction: row !important;
        padding: 8px 12px;
        border-radius: 10px;
        display: flex !important;
      }

      .date-stat-value {
        font-size: 16px;
      }

      .date-stat-label {
        font-size: 12px;
      }

      .date-stat-value {
        font-size: 16px;
      }

      .table-status {
        font-size: 6px;
        padding: 1px 3px;
      }

      .table-name {
        font-size: 8px;
      }

      .amount-value {
        font-size: 9px;
      }

      .items-value {
        font-size: 8px;
      }
    }
  </style>
</head>
<body>
  <div id="loader" class="admin-splash-screen">
    <div class="splash-content">
      <img src="lacrimosa.jpg" alt="PATRON Logo" class="splash-logo" onerror="this.style.display='none';">
      <h1 class="splash-main-text" id="splashBusinessName">PATRON</h1>
      <div class="splash-decorative-line"></div>
      <p class="splash-subtitle-text">Admin Dashboard</p>
    </div>
  </div>

  <div class="container">
    <div id="loginSection" class="pin-section">
      <div class="login-header">
        <img src="lacrimosa.jpg" alt="PATRON Logo" class="login-logo" onerror="this.style.display='none';">
        <h2>Admin GiriÅŸi</h2>
        <p class="login-subtitle" id="loginBusinessName">PATRON</p>
      </div>
      
      <div class="pin-form">
        <div class="input-group">
          <label class="input-label">GÃ¼venlik PIN'i</label>
          <input type="password" id="pinInput" class="pin-input" placeholder="â€¢â€¢â€¢â€¢" maxlength="10" autofocus>
        </div>
        <div class="login-options">
          <label class="login-remember">
            <input type="checkbox" id="rememberMe" name="rememberMe">
            Beni hatÄ±rla
          </label>
          <button type="button" class="login-change-pin" id="btnChangePin">Åifreyi deÄŸiÅŸtir</button>
        </div>
        <button onclick="verifyPin()" class="pin-btn">
          GiriÅŸ Yap
        </button>
      </div>
      
      <div class="login-footer">
        <p class="login-footer-text">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"/>
          </svg>
          GÃ¼venli BaÄŸlantÄ±
        </p>
      </div>
    </div>

    <!-- Åifre deÄŸiÅŸtir modal -->
    <div id="changePinOverlay" class="change-pin-overlay">
      <div class="change-pin-modal">
        <h3>Åifreyi deÄŸiÅŸtir</h3>
        <p style="font-size: 13px; color: #6b7280; margin: 0 0 16px 0;">Yeni PIN hem Firebase'e kaydedilir hem de â€œBeni hatÄ±rlaâ€ ile kullanÄ±lÄ±r.</p>
        <div class="input-group">
          <label class="input-label">Mevcut PIN</label>
          <input type="password" id="changePinCurrent" class="pin-input" placeholder="â€¢â€¢â€¢â€¢" maxlength="10">
        </div>
        <div class="input-group">
          <label class="input-label">Yeni PIN</label>
          <input type="password" id="changePinNew" class="pin-input" placeholder="â€¢â€¢â€¢â€¢" maxlength="10">
        </div>
        <div class="change-pin-modal-actions">
          <button type="button" class="change-pin-cancel" id="changePinCancel">Ä°ptal</button>
          <button type="button" class="change-pin-submit" id="changePinSubmit">Kaydet</button>
        </div>
      </div>
    </div>

    <!-- BaÅŸarÄ± popup (ÅŸifre deÄŸiÅŸti) -->
    <div id="successPopupOverlay" class="success-popup-overlay">
      <div class="success-popup-card">
        <div class="success-popup-icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 13l4 4L19 7"/>
          </svg>
        </div>
        <h3 class="success-popup-title" id="successPopupTitle">Åifreniz BaÅŸarÄ±yla DeÄŸiÅŸtirildi</h3>
        <p class="success-popup-subtitle" id="successPopupSubtitle">Bir sonraki giriÅŸte yeni PIN geÃ§erli olacak.</p>
        <button type="button" class="success-popup-btn" id="successPopupOk">Tamam</button>
      </div>
    </div>

    <div id="dashboard" class="dashboard">
      <!-- Modern Navbar -->
      <nav class="admin-navbar">
        <div class="navbar-content">
          <div class="navbar-brand">
            <img src="lacrimosa.jpg" alt="PATRON Logo" class="navbar-logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="navbar-logo" style="display: none;">M</div>
            <div class="navbar-title-group">
              <h1 class="navbar-title" id="navbarBusinessName">Lacrimosa Admin Dashboard</h1>
              <p class="navbar-subtitle">AnlÄ±k SatÄ±ÅŸ DetaylarÄ± ve Ä°statistikler</p>
            </div>
          </div>
          <div class="navbar-actions navbar-actions-stack">
            <div class="navbar-actions-row">
              <button onclick="loadSales()" class="refresh-btn">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"/>
                </svg>
                <span>Yenile</span>
              </button>
              <button onclick="logout()" class="logout-btn">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75"/>
                </svg>
                <span>Ã‡Ä±kÄ±ÅŸ</span>
              </button>
            </div>

            <button onclick="openManagementOverlay()" class="management-btn" id="managementBtn">
              <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m-6-9H6a2.25 2.25 0 00-2.25 2.25V18A2.25 2.25 0 006 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6.75z"/>
              </svg>
              <span>YÃ¶netim</span>
            </button>
          </div>
        </div>
      </nav>
      
      <!-- Tab ButonlarÄ± - En Ãœstte Modern ve Kurumsal -->
      <div class="tab-buttons-container">
        <div class="tab-buttons">
          <button class="tab-btn active" data-tab="sales" onclick="setActiveTab('sales')">
            <div class="tab-btn-icon">ğŸ“‹</div>
            <div class="tab-btn-text">SatÄ±ÅŸ GeÃ§miÅŸi</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="reports" onclick="setActiveTab('reports')">
            <div class="tab-btn-icon">ğŸ“Š</div>
            <div class="tab-btn-text">DetaylÄ± Raporlama</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="staff" onclick="setActiveTab('staff')">
            <div class="tab-btn-icon">ğŸ‘¥</div>
            <div class="tab-btn-text">Personel DetaylarÄ±</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="tables" onclick="setActiveTab('tables')">
            <div class="tab-btn-icon">ğŸª‘</div>
            <div class="tab-btn-text">Masalar</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="cancels" onclick="setActiveTab('cancels')">
            <div class="tab-btn-icon">âŒ</div>
            <div class="tab-btn-text">Ä°ptaller</div>
            <div class="tab-btn-indicator"></div>
          </button>
          <button class="tab-btn" data-tab="send-message" onclick="showSendMessageModal()">
            <div class="tab-btn-icon">ğŸ“¢</div>
            <div class="tab-btn-text">Mesaj GÃ¶nder</div>
            <div class="tab-btn-indicator"></div>
          </button>
        </div>
      </div>
      
      <div class="stats-grid" id="statsGrid"></div>
      
      <div id="salesContainer" style="min-height: 200px;"></div>
      <div id="reportsContainer" style="min-height: 200px; display: none;"></div>
      <div id="staffContainer" style="min-height: 200px; display: none;"></div>
      <div id="tablesContainer" style="min-height: 200px; display: none;"></div>
      <div id="cancelsContainer" style="min-height: 200px; display: none;"></div>
    </div>
  </div>

  <!-- SatÄ±ÅŸ Silme Onay Modal -->
  <div id="deleteSaleConfirmOverlay" style="display: none; position: fixed; inset: 0; background: rgba(15,23,42,0.6); z-index: 10050; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(6px);" onclick="if(event.target === this) closeDeleteConfirm()">
    <div style="background: #fff; border-radius: 20px; max-width: 400px; width: 100%; box-shadow: 0 25px 60px rgba(0,0,0,0.25); overflow: hidden; animation: modalSlide 0.25s ease;">
      <div style="padding: 28px 24px; text-align: center;">
        <div style="width: 56px; height: 56px; margin: 0 auto 16px; background: #fef2f2; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
          <svg width="28" height="28" fill="none" stroke="#dc2626" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
        </div>
        <h3 style="margin: 0 0 8px; font-size: 20px; font-weight: 800; color: #0f172a;">Emin misiniz?</h3>
        <p style="margin: 0; font-size: 15px; color: #64748b; line-height: 1.5;">Bu satÄ±ÅŸ kalÄ±cÄ± olarak silinecektir. Bu iÅŸlem geri alÄ±namaz.</p>
      </div>
      <div style="display: flex; gap: 12px; padding: 20px 24px; background: #f8fafc; border-top: 1px solid #e2e8f0;">
        <button type="button" onclick="closeDeleteConfirm()" style="flex:1; padding: 14px 20px; border: 2px solid #e2e8f0; border-radius: 12px; background: #fff; font-weight: 700; font-size: 15px; color: #475569; cursor: pointer;">Ä°ptal</button>
        <button type="button" id="deleteSaleConfirmBtn" onclick="confirmDeleteSale()" style="flex:1; padding: 14px 20px; border: none; border-radius: 12px; background: #dc2626; color: #fff; font-weight: 700; font-size: 15px; cursor: pointer;">Sil</button>
      </div>
    </div>
  </div>

  <!-- SatÄ±ÅŸ DÃ¼zenleme Modal -->
  <div id="editSaleOverlay" style="display: none; position: fixed; inset: 0; background: rgba(15,23,42,0.6); z-index: 10050; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(6px); overflow-y: auto;" onclick="if(event.target === this) closeEditSaleModal()">
    <div style="background: #fff; border-radius: 20px; max-width: 480px; width: 100%; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 25px 60px rgba(0,0,0,0.25); overflow: hidden; animation: modalSlide 0.25s ease;">
      <div style="padding: 24px; border-bottom: 1px solid #e2e8f0;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 style="margin: 0; font-size: 20px; font-weight: 800; color: #0f172a;">SatÄ±ÅŸÄ± DÃ¼zenle</h2>
          <button type="button" onclick="closeEditSaleModal()" style="width: 40px; height: 40px; border: none; background: #f1f5f9; border-radius: 10px; cursor: pointer; font-size: 20px; color: #64748b;">Ã—</button>
        </div>
      </div>
      <div style="flex: 1; overflow-y: auto; padding: 24px;">
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 700; color: #475569;">Ã–deme YÃ¶ntemi</label>
          <select id="editSalePaymentMethod" style="width: 100%; padding: 12px 14px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 15px; font-weight: 600;">
            <option value="Nakit">ğŸ’µ Nakit</option>
            <option value="Kredi KartÄ±">ğŸ’³ Kart</option>
          </select>
        </div>
        <div style="margin-bottom: 8px; font-size: 13px; font-weight: 700; color: #475569;">ÃœrÃ¼nler</div>
        <div id="editSaleItemsList" style="display: flex; flex-direction: column; gap: 10px;"></div>
        <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
          <span style="font-size: 16px; font-weight: 700; color: #0f172a;">Toplam</span>
          <span id="editSaleTotalDisplay" style="font-size: 20px; font-weight: 800; color: #0f172a;">â‚º0.00</span>
        </div>
      </div>
      <div style="padding: 20px 24px; border-top: 1px solid #e2e8f0; background: #f8fafc; display: flex; gap: 12px;">
        <button type="button" onclick="closeEditSaleModal()" style="flex:1; padding: 14px; border: 2px solid #e2e8f0; border-radius: 12px; background: #fff; font-weight: 700; color: #475569; cursor: pointer;">Ä°ptal</button>
        <button type="button" id="editSaleSaveBtn" onclick="saveEditSale()" style="flex:1; padding: 14px; border: none; border-radius: 12px; background: #0f172a; color: #fff; font-weight: 700; cursor: pointer;">Kaydet</button>
      </div>
    </div>
  </div>

  <!-- Masraf Detay Modal (DetaylÄ± Raporlama - baÅŸlÄ±ÄŸa gÃ¶re masraflar) -->
  <div id="expenseDetailOverlay" style="display: none; position: fixed; inset: 0; background: rgba(15,23,42,0.6); z-index: 10050; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(6px); overflow-y: auto;" onclick="if(event.target === this) closeExpenseDetailModal()">
    <div style="background: #fff; border-radius: 20px; max-width: 520px; width: 100%; max-height: 90vh; display: flex; flex-direction: column; box-shadow: 0 25px 60px rgba(0,0,0,0.25); overflow: hidden;">
      <div style="padding: 24px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
        <div>
          <h2 style="margin: 0; font-size: 20px; font-weight: 800; color: #0f172a;">Masraf DetaylarÄ±</h2>
          <p id="expenseDetailPeriodInfo" style="margin: 4px 0 0; font-size: 13px; color: #64748b; font-weight: 600;"></p>
        </div>
        <button type="button" onclick="closeExpenseDetailModal()" style="width: 40px; height: 40px; border: none; background: #f1f5f9; border-radius: 10px; cursor: pointer; font-size: 20px; color: #64748b;">Ã—</button>
      </div>
      <div id="expenseDetailBody" style="flex: 1; overflow-y: auto; padding: 24px;"></div>
      <div style="padding: 16px 24px; border-top: 1px solid #e2e8f0; background: #f8fafc; display: flex; justify-content: space-between; align-items: center;">
        <span style="font-size: 15px; font-weight: 700; color: #0f172a;">Toplam Masraf</span>
        <span id="expenseDetailTotal" style="font-size: 20px; font-weight: 800; color: #dc2626;">â‚º0.00</span>
      </div>
    </div>
  </div>

  <!-- YÃ¶netim Overlay (Stok / Fiyat) -->
  <div id="managementOverlay" class="management-overlay" onclick="if(event.target === this) closeManagementOverlay()">
    <div class="management-modal" onclick="event.stopPropagation()">
      <div class="management-header">
        <h2>ğŸ¢ YÃ¶netim</h2>
        <button class="management-close" onclick="closeManagementOverlay()" title="Kapat">Ã—</button>
      </div>
      <div class="management-body">
        <div id="managementHome">
          <div class="management-home-grid">
            <button class="management-card" onclick="openManagementSection('stock')">
              <div class="management-card-title">1 - Stok</div>
              <p class="management-card-desc">Åube seÃ§in ve tÃ¼m Ã¼rÃ¼nler iÃ§in stok ekle/Ã§Ä±kar iÅŸlemlerini yÃ¶netin.</p>
            </button>
            <button class="management-card" onclick="openManagementSection('price')">
              <div class="management-card-title">2 - Fiyat</div>
              <p class="management-card-desc">VeritabanÄ±ndaki Ã¼rÃ¼n fiyatlarÄ±nÄ± listeleyin, dÃ¼zenleyin ve kaydedin.</p>
            </button>
          </div>
        </div>

        <div id="managementStock" style="display:none;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;">
            <button class="mgmt-back" onclick="openManagementSection('home')">â† Geri</button>
            <div style="font-weight:900; color:#0f172a;">Stok YÃ¶netimi</div>
          </div>

          <div class="management-toolbar">
            <div class="branch-toggle" id="mgmtBranchToggle">
              <button class="branch-btn" id="branchBtn_SANCAK" onclick="mgmtSelectBranch('SANCAK')">SANCAK</button>
              <button class="branch-btn" id="branchBtn_SEKER" onclick="mgmtSelectBranch('SEKER')">ÅEKER</button>
            </div>
            <input class="management-search" id="mgmtStockSearch" placeholder="ÃœrÃ¼n araâ€¦" oninput="mgmtRenderStockList()" />
          </div>

          <div id="mgmtStockHint" style="margin: 0 0 10px 0; font-size: 13px; font-weight: 700; color: #64748b;"></div>
          <div id="mgmtStockList" class="management-list"></div>
        </div>

        <div id="managementPrice" style="display:none;">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px;">
            <button class="mgmt-back" onclick="openManagementSection('home')">â† Geri</button>
            <div style="font-weight:900; color:#0f172a;">Fiyat YÃ¶netimi</div>
          </div>

          <div class="management-toolbar">
            <div class="mgmt-tabs" id="mgmtPriceCategoryTabs"></div>
            <input class="management-search" id="mgmtPriceSearch" placeholder="ÃœrÃ¼n araâ€¦" oninput="mgmtRenderPriceList()" />
          </div>

          <div id="mgmtPriceHint" style="margin: 0 0 10px 0; font-size: 13px; font-weight: 700; color: #64748b;"></div>
          <div id="mgmtPriceList" class="management-list price-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mesaj GÃ¶nderme Modal -->
  <div id="sendMessageModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 10000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(4px);" onclick="if(event.target === this) hideSendMessageModal()">
    <div style="background: white; border-radius: 24px; width: 100%; max-width: 500px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 25px 70px rgba(0,0,0,0.4); animation: slideUp 0.3s ease;">
      <div style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h2 style="margin: 0; font-size: 22px; font-weight: 900;">ğŸ“¢ Mesaj GÃ¶nder</h2>
          <button onclick="hideSendMessageModal()" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: bold; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,255,255,0.3)';" onmouseout="this.style.background='rgba(255,255,255,0.2)';">Ã—</button>
        </div>
      </div>
      <div style="padding: 24px;">
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; font-size: 15px; color: #374151; font-weight: 700;">Mesaj Ä°Ã§eriÄŸi <span style="color: #ef4444;">*</span>:</label>
          <textarea id="messageContentInput" placeholder="TÃ¼m mobil personellere ve kasaya gÃ¶nderilecek mesajÄ± yazÄ±n..." style="width: 100%; min-height: 150px; padding: 14px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; font-family: inherit; resize: vertical; outline: none;" onfocus="this.style.borderColor='#3b82f6';" onblur="this.style.borderColor='#e5e7eb';"></textarea>
        </div>
        <div style="background: #dbeafe; border: 2px solid #93c5fd; border-radius: 12px; padding: 16px; margin-bottom: 24px;">
          <p style="margin: 0; font-size: 13px; color: #1e40af; font-weight: 600; line-height: 1.6;">
            â„¹ï¸ Bu mesaj tÃ¼m mobil personellere ve masaÃ¼stÃ¼ uygulamaya anlÄ±k olarak gÃ¶nderilecektir.
          </p>
        </div>
      </div>
      <div style="border-top: 1px solid #e5e7eb; padding: 20px; display: flex; justify-content: flex-end; gap: 12px; background: #f9fafb;">
        <button onclick="hideSendMessageModal()" style="padding: 14px 28px; background: #f3f4f6; color: #374151; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">Ä°ptal</button>
        <button id="sendMessageBtn" onclick="sendBroadcastMessage()" style="padding: 14px 28px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3); display: flex; align-items: center; justify-content: center; gap: 8px; min-width: 140px;" onmouseover="if(!this.disabled) { this.style.transform='scale(1.02)'; this.style.boxShadow='0 6px 16px rgba(59, 130, 246, 0.4)'; }" onmouseout="if(!this.disabled) { this.style.transform='scale(1)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)'; }">
          <span id="sendMessageBtnText">GÃ¶nder</span>
          <svg id="sendMessageBtnSpinner" style="display: none; width: 18px; height: 18px; animation: spin 1s linear infinite;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Analiz Modal -->
  <div id="analysisModal" class="analysis-modal" style="display: none;">
    <div class="analysis-modal-overlay" onclick="closeAnalysisModal()"></div>
    <div class="analysis-modal-content">
      <div class="analysis-modal-header">
        <h2 class="analysis-modal-title">ğŸ” SatÄ±ÅŸ Analizi</h2>
        <button class="analysis-modal-close" onclick="closeAnalysisModal()">Ã—</button>
      </div>
      <div class="analysis-modal-body">
        <div id="analysisContent" class="analysis-content"></div>
        <div id="analysisTypingIndicator" class="typing-indicator" style="display: none;">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
    </div>
  </div>

  <!-- GÃ¼nlÃ¼k Ciro Modal -->
  <div id="dailyRevenueModal" class="daily-revenue-modal" style="display: none;">
    <div class="daily-revenue-modal-overlay" onclick="closeDailyRevenueModal()"></div>
    <div class="daily-revenue-modal-content">
      <div id="dailyRevenueModalContent" style="display: flex; flex-direction: column; height: 100%; overflow: hidden;"></div>
    </div>
  </div>
</body>
</html>
